<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[IT Monkey Life]]></title>
  <link href="http://ITMonkeyLife.github.io/Blog/atom.xml" rel="self"/>
  <link href="http://ITMonkeyLife.github.io/Blog/"/>
  <updated>2016-06-17T14:24:45+08:00</updated>
  <id>http://ITMonkeyLife.github.io/Blog/</id>
  <author>
    <name><![CDATA[Rick]]></name>
    <email><![CDATA[382542165@qq.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Swift 3.0 ABI]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2016/06/15/swift-3-dot-0-abi/"/>
    <updated>2016-06-15T16:02:03+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2016/06/15/swift-3-dot-0-abi</id>
    <content type="html"><![CDATA[<p>
<span id="abi"></span><h1><a class="toc-backref" href="#id1">The Swift ABI</a><a class="headerlink" href="#the-swift-abi" title="Permalink to this headline"></a></h1>
<div class="contents topic" id="contents">

<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#the-swift-abi" id="id1">The Swift ABI</a><ul>
<li><a class="reference internal" href="#hard-constraints-on-resilience" id="id2">Hard Constraints on Resilience</a></li>
<li><a class="reference internal" href="#type-layout" id="id3">Type Layout</a><ul>
<li><a class="reference internal" href="#fragile-struct-and-tuple-layout" id="id4">Fragile Struct and Tuple Layout</a></li>
<li><a class="reference internal" href="#class-layout" id="id5">Class Layout</a></li>
<li><a class="reference internal" href="#fragile-enum-layout" id="id6">Fragile Enum Layout</a><ul>
<li><a class="reference internal" href="#empty-enums" id="id7">Empty Enums</a></li>
<li><a class="reference internal" href="#single-case-enums" id="id8">Single-Case Enums</a></li>
<li><a class="reference internal" href="#c-like-enums" id="id9">C-Like Enums</a></li>
<li><a class="reference internal" href="#single-payload-enums" id="id10">Single-Payload Enums</a></li>
<li><a class="reference internal" href="#multi-payload-enums" id="id11">Multi-Payload Enums</a></li>
</ul>
</li>
<li><a class="reference internal" href="#existential-container-layout" id="id12">Existential Container Layout</a><ul>
<li><a class="reference internal" href="#opaque-existential-containers" id="id13">Opaque Existential Containers</a></li>
<li><a class="reference internal" href="#class-existential-containers" id="id14">Class Existential Containers</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#type-metadata" id="id15">Type Metadata</a><ul>
<li><a class="reference internal" href="#common-metadata-layout" id="id16">Common Metadata Layout</a></li>
<li><a class="reference internal" href="#struct-metadata" id="id17">Struct Metadata</a></li>
<li><a class="reference internal" href="#enum-metadata" id="id18">Enum Metadata</a></li>
<li><a class="reference internal" href="#tuple-metadata" id="id19">Tuple Metadata</a></li>
<li><a class="reference internal" href="#function-metadata" id="id20">Function Metadata</a></li>
<li><a class="reference internal" href="#protocol-metadata" id="id21">Protocol Metadata</a></li>
<li><a class="reference internal" href="#metatype-metadata" id="id22">Metatype Metadata</a></li>
<li><a class="reference internal" href="#class-metadata" id="id23">Class Metadata</a></li>
<li><a class="reference internal" href="#generic-parameter-vector" id="id24">Generic Parameter Vector</a></li>
<li><a class="reference internal" href="#nominal-type-descriptor" id="id25">Nominal Type Descriptor</a></li>
<li><a class="reference internal" href="#protocol-descriptor" id="id26">Protocol Descriptor</a></li>
</ul>
</li>
<li><a class="reference internal" href="#heap-objects" id="id27">Heap Objects</a><ul>
<li><a class="reference internal" href="#heap-metadata" id="id28">Heap Metadata</a></li>
<li><a class="reference internal" href="#heap-object-header" id="id29">Heap Object Header</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mangling" id="id30">Mangling</a><ul>
<li><a class="reference internal" href="#globals" id="id31">Globals</a></li>
<li><a class="reference internal" href="#direct-and-indirect-symbols" id="id32">Direct and Indirect Symbols</a></li>
<li><a class="reference internal" href="#declaration-contexts" id="id33">Declaration Contexts</a></li>
<li><a class="reference internal" href="#types" id="id34">Types</a></li>
<li><a class="reference internal" href="#generics" id="id35">Generics</a></li>
<li><a class="reference internal" href="#value-witnesses" id="id36">Value Witnesses</a></li>
<li><a class="reference internal" href="#identifiers" id="id37">Identifiers</a></li>
<li><a class="reference internal" href="#substitutions" id="id38">Substitutions</a></li>
<li><a class="reference internal" href="#predefined-substitutions" id="id39">Predefined Substitutions</a></li>
<li><a class="reference internal" href="#indexes" id="id40">Indexes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="hard-constraints-on-resilience">
<h2><a class="toc-backref" href="#id2">Hard Constraints on Resilience</a><a class="headerlink" href="#hard-constraints-on-resilience" title="Permalink to this headline"></a></h2>
<p>The root of a class hierarchy must remain stable, at pain of
invalidating the metaclass hierarchy.  Note that a Swift class without an
explicit base class is implicitly rooted in the SwiftObject
Objective-C class.</p>
</div>
<div class="section" id="type-layout">
<h2><a class="toc-backref" href="#id3">Type Layout</a><a class="headerlink" href="#type-layout" title="Permalink to this headline"></a></h2>
<div class="section" id="fragile-struct-and-tuple-layout">
<h3><a class="toc-backref" href="#id4">Fragile Struct and Tuple Layout</a><a class="headerlink" href="#fragile-struct-and-tuple-layout" title="Permalink to this headline"></a></h3>
<p>Structs and tuples currently share the same layout algorithm, noted as the
&#8220;Universal&#8221; layout algorithm in the compiler implementation. The algorithm
is as follows:</p>
<ul class="simple">
<li>Start with a <strong>size</strong> of <strong>0</strong> and an <strong>alignment</strong> of <strong>1</strong>.</li>
<li>Iterate through the fields, in element order for tuples, or in <code class="docutils literal"><span class="pre">var</span></code>
declaration order for structs. For each field:<ul>
<li>Update <strong>size</strong> by rounding up to the <strong>alignment of the field</strong>, that is,
increasing it to the least value greater or equal to <strong>size</strong> and evenly
divisible by the <strong>alignment of the field</strong>.</li>
<li>Assign the <strong>offset of the field</strong> to the current value of <strong>size</strong>.</li>
<li>Update <strong>size</strong> by adding the <strong>size of the field</strong>.</li>
<li>Update <strong>alignment</strong> to the max of <strong>alignment</strong> and the
<strong>alignment of the field</strong>.</li>
</ul>
</li>
<li>The final <strong>size</strong> and <strong>alignment</strong> are the size and alignment of the
aggregate. The <strong>stride</strong> of the type is the final <strong>size</strong> rounded up to
<strong>alignment</strong>.</li>
</ul>
<p>Note that this differs from C or LLVM&#8217;s normal layout rules in that <em>size</em>
and <em>stride</em> are distinct; whereas C layout requires that an embedded struct&#8217;s
size be padded out to its alignment and that nothing be laid out there,
Swift layout allows an outer struct to lay out fields in the inner struct&#8217;s
tail padding, alignment permitting. Unlike C, zero-sized structs and tuples
are also allowed, and take up no storage in enclosing aggregates. The Swift
compiler emits LLVM packed struct types with manual padding to get the
necessary control over the binary layout. Some examples:</p>
<div class="highlight-swift"><div class="highlight"><pre>// LLVM &lt;{ i64, i8 }&gt;
struct S {
  var x: Int
  var y: UInt8
}

// LLVM &lt;{ i8, [7 x i8], &lt;{ i64, i8 }&gt;, i8 }&gt;
struct S2 {
  var x: UInt8
  var s: S
  var y: UInt8
}

// LLVM &lt;{}&gt;
struct Empty {}

// LLVM &lt;{ i64, i64 }&gt;
struct ContainsEmpty {
  var x: Int
  var y: Empty
  var z: Int
}
</pre></div>
</div>
</div>
<div class="section" id="class-layout">
<h3><a class="toc-backref" href="#id5">Class Layout</a><a class="headerlink" href="#class-layout" title="Permalink to this headline"></a></h3>
<p>Swift relies on the following assumptions about the Objective-C runtime,
which are therefore now part of the Objective-C ABI:</p>
<ul class="simple">
<li>32-bit platforms never have tagged pointers.  ObjC pointer types are
either nil or an object pointer.</li>
<li>On x86-64, a tagged pointer either sets the lowest bit of the pointer
or the highest bit of the pointer.  Therefore, both of these bits are
zero if and only if the value is not a tagged pointer.</li>
<li>On ARM64, a tagged pointer always sets the highest bit of the pointer.</li>
<li>32-bit platforms never perform any isa masking.  <code class="docutils literal"><span class="pre">object_getClass</span></code>
is always equivalent to <code class="docutils literal"><span class="pre">*(Class*)object</span></code>.</li>
<li>64-bit platforms perform isa masking only if the runtime exports a
symbol <code class="docutils literal"><span class="pre">uintptr_t</span> <span class="pre">objc_debug_isa_class_mask;</span></code>.  If this symbol
is exported, <code class="docutils literal"><span class="pre">object_getClass</span></code> on a non-tagged pointer is always
equivalent to <code class="docutils literal"><span class="pre">(Class)(objc_debug_isa_class_mask</span> <span class="pre">&amp;</span> <span class="pre">*(uintptr_t*)object)</span></code>.</li>
<li>The superclass field of a class object is always stored immediately
after the isa field.  Its value is either nil or a pointer to the
class object for the superclass; it never has other bits set.</li>
</ul>
<p>The following assumptions are part of the Swift ABI:</p>
<ul class="simple">
<li>Swift class pointers are never tagged pointers.</li>
</ul>
<p>TODO</p>
</div>
<div class="section" id="fragile-enum-layout">
<h3><a class="toc-backref" href="#id6">Fragile Enum Layout</a><a class="headerlink" href="#fragile-enum-layout" title="Permalink to this headline"></a></h3>
<p>In laying out enum types, the ABI attempts to avoid requiring additional
storage to store the tag for the enum case. The ABI chooses one of five
strategies based on the layout of the enum:</p>
<div class="section" id="empty-enums">
<h4><a class="toc-backref" href="#id7">Empty Enums</a><a class="headerlink" href="#empty-enums" title="Permalink to this headline"></a></h4>
<p>In the degenerate case of an enum with no cases, the enum is an empty type.</p>
<div class="highlight-swift"><div class="highlight"><pre><span class="n">enum</span><span class="w"> </span><span class="n">Empty</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// =&gt; empty type</span>
</pre></div>
</div>
</div>
<div class="section" id="single-case-enums">
<h4><a class="toc-backref" href="#id8">Single-Case Enums</a><a class="headerlink" href="#single-case-enums" title="Permalink to this headline"></a></h4>
<p>In the degenerate case of an enum with a single case, there is no
discriminator needed, and the enum type has the exact same layout as its
case&#8217;s data type, or is empty if the case has no data type.</p>
<div class="highlight-swift"><div class="highlight"><pre><span class="n">enum</span><span class="w"> </span><span class="n">EmptyCase</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">case</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="p">}</span><span class="w">             </span><span class="c1">// =&gt; empty type</span>
<span class="n">enum</span><span class="w"> </span><span class="n">DataCase</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">case</span><span class="w"> </span><span class="no">Y</span><span class="p">(</span><span class="n">Int</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// =&gt; LLVM &lt;{ i64, double }&gt;</span>
</pre></div>
</div>
</div>
<!-- more-->
<div class="section" id="c-like-enums">
<h4><a class="toc-backref" href="#id9">C-Like Enums</a><a class="headerlink" href="#c-like-enums" title="Permalink to this headline"></a></h4>
<p>If none of the cases has a data type (a &#8220;C-like&#8221; enum), then the enum
is laid out as an integer tag with the minimal number of bits to contain
all of the cases. The machine-level layout of the type then follows LLVM&#8217;s
data layout rules for integer types on the target platform. The cases are
assigned tag values in declaration order.</p>
<div class="highlight-swift"><div class="highlight"><pre><span class="n">enum</span><span class="w"> </span><span class="n">EnumLike2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// =&gt; LLVM i1</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">A</span><span class="w">         </span><span class="c1">// =&gt; i1 0</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">B</span><span class="w">         </span><span class="c1">// =&gt; i1 1</span>
<span class="p">}</span>

<span class="n">enum</span><span class="w"> </span><span class="n">EnumLike8</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// =&gt; LLVM i3</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">A</span><span class="w">         </span><span class="c1">// =&gt; i3 0</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">B</span><span class="w">         </span><span class="c1">// =&gt; i3 1</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">C</span><span class="w">         </span><span class="c1">// =&gt; i3 2</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">D</span><span class="w">         </span><span class="c1">// etc.</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">E</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">F</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">G</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">H</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Discriminator values after the one used for the last case become <em>extra
inhabitants</em> of the enum type (see <a class="reference internal" href="#single-payload-enums">Single-Payload Enums</a>).</p>
</div>
<div class="section" id="single-payload-enums">
<h4><a class="toc-backref" href="#id10">Single-Payload Enums</a><a class="headerlink" href="#single-payload-enums" title="Permalink to this headline"></a></h4>
<p>If an enum has a single case with a data type and one or more no-data cases
(a &#8220;single-payload&#8221; enum), then the case with data type is represented using
the data type&#8217;s binary representation, with added zero bits for tag if
necessary. If the data type&#8217;s binary representation
has <strong>extra inhabitants</strong>, that is, bit patterns with the size and alignment of
the type but which do not form valid values of that type, they are used to
represent the no-data cases, with extra inhabitants in order of ascending
numeric value matching no-data cases in declaration order. If the type
has <em>spare bits</em> (see <a class="reference internal" href="#multi-payload-enums">Multi-Payload Enums</a>), they are used to form extra
inhabitants. The enum value is then represented as an integer with the storage
size in bits of the data type. Extra inhabitants of the payload type not used
by the enum type become extra inhabitants of the enum type itself.</p>
<div class="highlight-swift"><div class="highlight"><pre>enum CharOrSectionMarker { =&gt; LLVM i32
  case Paragraph            =&gt; i32 0x0020_0000
  case Char(UnicodeScalar)  =&gt; i32 (zext i21 %Char to i32)
  case Chapter              =&gt; i32 0x0020_0001
}

CharOrSectionMarker.Char(&#39;\x00&#39;) =&gt; i32 0x0000_0000
CharOrSectionMarker.Char(&#39;\u10FFFF&#39;) =&gt; i32 0x0010_FFFF

enum CharOrSectionMarkerOrFootnoteMarker { =&gt; LLVM i32
  case CharOrSectionMarker(CharOrSectionMarker) =&gt; i32 %CharOrSectionMarker
  case Asterisk                                 =&gt; i32 0x0020_0002
  case Dagger                                   =&gt; i32 0x0020_0003
  case DoubleDagger                             =&gt; i32 0x0020_0004
}
</pre></div>
</div>
<p>If the data type has no extra inhabitants, or there are not enough extra
inhabitants to represent all of the no-data cases, then a tag bit is added
to the enum&#8217;s representation. The tag bit is set for the no-data cases, which
are then assigned values in the data area of the enum in declaration order.</p>
<div class="highlight-swift"><div class="highlight"><pre><span class="n">enum</span><span class="w"> </span><span class="n">IntOrInfinity</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LLVM</span><span class="w"> </span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">i64</span><span class="p">,</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">NegInfinity</span><span class="w">    </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">i64</span><span class="p">,</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="no">Int</span><span class="p">(</span><span class="n">Int</span><span class="p">)</span><span class="w">       </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">i64</span><span class="p">,</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">%</span><span class="n">Int</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">PosInfinity</span><span class="w">    </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">i64</span><span class="p">,</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">    </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">IntOrInfinity</span><span class="p">.</span><span class="no">Int</span><span class="p">(</span><span class="w">    </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">i64</span><span class="p">,</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">     </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span>
<span class="n">IntOrInfinity</span><span class="p">.</span><span class="no">Int</span><span class="p">(</span><span class="mi">20721</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">i64</span><span class="p">,</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">20721</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="multi-payload-enums">
<h4><a class="toc-backref" href="#id11">Multi-Payload Enums</a><a class="headerlink" href="#multi-payload-enums" title="Permalink to this headline"></a></h4>
<p>If an enum has more than one case with data type, then a tag is necessary to
discriminate the data types. The ABI will first try to find common
<strong>spare bits</strong>, that is, bits in the data types&#8217; binary representations which are
either fixed-zero or ignored by valid values of all of the data types. The tag
will be scattered into these spare bits as much as possible. Currently only
spare bits of primitive integer types, such as the high bits of an <code class="docutils literal"><span class="pre">i21</span></code>
type, are considered. The enum data is represented as an integer with the
storage size in bits of the largest data type.</p>
<div class="highlight-swift"><div class="highlight"><pre><span class="n">enum</span><span class="w"> </span><span class="n">TerminalChar</span><span class="w"> </span><span class="p">{</span><span class="w">             </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LLVM</span><span class="w"> </span><span class="n">i32</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="no">Plain</span><span class="p">(</span><span class="n">UnicodeScalar</span><span class="p">)</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i32</span><span class="w">     </span><span class="p">(</span><span class="n">zext</span><span class="w"> </span><span class="n">i21</span><span class="w"> </span><span class="o">%</span><span class="n">Plain</span><span class="w">     </span><span class="n">to</span><span class="w"> </span><span class="n">i32</span><span class="p">)</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="no">Bold</span><span class="p">(</span><span class="n">UnicodeScalar</span><span class="p">)</span><span class="w">      </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i32</span><span class="w"> </span><span class="p">(</span><span class="n">or</span><span class="w"> </span><span class="p">(</span><span class="n">zext</span><span class="w"> </span><span class="n">i21</span><span class="w"> </span><span class="o">%</span><span class="n">Bold</span><span class="w">      </span><span class="n">to</span><span class="w"> </span><span class="n">i32</span><span class="p">),</span><span class="w"> </span><span class="mh">0x0020</span><span class="n">_0000</span><span class="p">)</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="no">Underline</span><span class="p">(</span><span class="n">UnicodeScalar</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i32</span><span class="w"> </span><span class="p">(</span><span class="n">or</span><span class="w"> </span><span class="p">(</span><span class="n">zext</span><span class="w"> </span><span class="n">i21</span><span class="w"> </span><span class="o">%</span><span class="n">Underline</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">i32</span><span class="p">),</span><span class="w"> </span><span class="mh">0x0040</span><span class="n">_0000</span><span class="p">)</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="no">Blink</span><span class="p">(</span><span class="n">UnicodeScalar</span><span class="p">)</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i32</span><span class="w"> </span><span class="p">(</span><span class="n">or</span><span class="w"> </span><span class="p">(</span><span class="n">zext</span><span class="w"> </span><span class="n">i21</span><span class="w"> </span><span class="o">%</span><span class="n">Blink</span><span class="w">     </span><span class="n">to</span><span class="w"> </span><span class="n">i32</span><span class="p">),</span><span class="w"> </span><span class="mh">0x0060</span><span class="n">_0000</span><span class="p">)</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">Empty</span><span class="w">                    </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i32</span><span class="w"> </span><span class="mh">0x0080</span><span class="n">_0000</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="n">Cursor</span><span class="w">                   </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i32</span><span class="w"> </span><span class="mh">0x0080</span><span class="n">_0001</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If there are not enough spare bits to contain the tag, then additional bits are
added to the representation to contain the tag. Tag values are
assigned to data cases in declaration order. If there are no-data cases, they
are collected under a common tag, and assigned values in the data area of the
enum in declaration order.</p>
<div class="highlight-swift"><div class="highlight"><pre><span class="kd">class </span><span class="nc">Bignum</span><span class="w"> </span><span class="p">{}</span>

<span class="n">enum</span><span class="w"> </span><span class="n">IntDoubleOrBignum</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LLVM</span><span class="w"> </span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">i64</span><span class="p">,</span><span class="w"> </span><span class="n">i2</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="no">Int</span><span class="p">(</span><span class="n">Int</span><span class="p">)</span><span class="w">           </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">i64</span><span class="p">,</span><span class="w"> </span><span class="n">i2</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">           </span><span class="o">%</span><span class="n">Int</span><span class="p">,</span><span class="w">            </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="no">Double</span><span class="p">(</span><span class="n">Double</span><span class="p">)</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">i64</span><span class="p">,</span><span class="w"> </span><span class="n">i2</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="n">bitcast</span><span class="w">  </span><span class="o">%</span><span class="n">Double</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">i64</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="n">case</span><span class="w"> </span><span class="no">Bignum</span><span class="p">(</span><span class="n">Bignum</span><span class="p">)</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="n">i64</span><span class="p">,</span><span class="w"> </span><span class="n">i2</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="n">ptrtoint</span><span class="w"> </span><span class="o">%</span><span class="n">Bignum</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">i64</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="existential-container-layout">
<h3><a class="toc-backref" href="#id12">Existential Container Layout</a><a class="headerlink" href="#existential-container-layout" title="Permalink to this headline"></a></h3>
<p>Values of protocol type, protocol composition type, or &#8220;any&#8221; type
(<code class="docutils literal"><span class="pre">protocol&lt;&gt;</span></code>) are laid out using <strong>existential containers</strong> (so-called
because these types are &#8220;existential types&#8221; in type theory).</p>
<div class="section" id="opaque-existential-containers">
<h4><a class="toc-backref" href="#id13">Opaque Existential Containers</a><a class="headerlink" href="#opaque-existential-containers" title="Permalink to this headline"></a></h4>
<p>If there is no class constraint on a protocol or protocol composition type,
the existential container has to accommodate a value of arbitrary size and
alignment. It does this using a <strong>fixed-size buffer</strong>, which is three pointers
in size and pointer-aligned. This either directly contains the value, if its
size and alignment are both less than or equal to the fixed-size buffer&#8217;s, or
contains a pointer to a side allocation owned by the existential container.
The type of the contained value is identified by its <cite>type metadata</cite> record,
and witness tables for all of the required protocol conformances are included.
The layout is as if declared in the following C struct:</p>
<div class="highlight-swift"><div class="highlight"><pre><span class="kd">struct </span><span class="nc">OpaqueExistentialContainer</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">void</span><span class="w"> </span><span class="o">*</span><span class="n">fixedSizeBuffer</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="w">  </span><span class="n">Metadata</span><span class="w"> </span><span class="o">*</span><span class="n">type</span><span class="p">;</span>
<span class="w">  </span><span class="n">WitnessTable</span><span class="w"> </span><span class="o">*</span><span class="n">witnessTables</span><span class="p">[</span><span class="n">NUM_WITNESS_TABLES</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="class-existential-containers">
<h4><a class="toc-backref" href="#id14">Class Existential Containers</a><a class="headerlink" href="#class-existential-containers" title="Permalink to this headline"></a></h4>
<p>If one or more of the protocols in a protocol or protocol composition type
have a class constraint, then only class values can be stored in the existential
container, and a more efficient representation is used. Class instances are
always a single pointer in size, so a fixed-size buffer and potential side
allocation is not needed, and class instances always have a reference to their
own type metadata, so the separate metadata record is not needed. The
layout is thus as if declared in the following C struct:</p>
<div class="highlight-swift"><div class="highlight"><pre><span class="kd">struct </span><span class="nc">ClassExistentialContainer</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">HeapObject</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">;</span>
<span class="w">  </span><span class="n">WitnessTable</span><span class="w"> </span><span class="o">*</span><span class="n">witnessTables</span><span class="p">[</span><span class="n">NUM_WITNESS_TABLES</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Note that if no witness tables are needed, such as for the &#8220;any class&#8221; type
<code class="docutils literal"><span class="pre">protocol&lt;class&gt;</span></code> or an Objective-C protocol type, then the only element of
the layout is the heap object pointer. This is ABI-compatible with <code class="docutils literal"><span class="pre">id</span></code>
and <code class="docutils literal"><span class="pre">id</span> <span class="pre">&lt;Protocol&gt;</span></code> types in Objective-C.</p>
</div>
</div>
</div>
<div class="section" id="type-metadata">
<h2><a class="toc-backref" href="#id15">Type Metadata</a><a class="headerlink" href="#type-metadata" title="Permalink to this headline"></a></h2>
<p>The Swift runtime keeps a <strong>metadata record</strong> for every type used in a program,
including every instantiation of generic types. These metadata records can
be used by (TODO: reflection and) debugger tools to discover information about
types. For non-generic nominal types, these metadata records are generated
statically by the compiler. For instances of generic types, and for intrinsic
types such as tuples, functions, protocol compositions, etc., metadata records
are lazily created by the runtime as required. Every type has a unique metadata
record; two <strong>metadata pointer</strong> values are equal iff the types are equivalent.</p>
<p>In the layout descriptions below, offsets are given relative to the
metadata pointer as an index into an array of pointers. On a 32-bit platform,
<strong>offset 1</strong> means an offset of 4 bytes, and on 64-bit platforms, it means
an offset of 8 bytes.</p>
<div class="section" id="common-metadata-layout">
<h3><a class="toc-backref" href="#id16">Common Metadata Layout</a><a class="headerlink" href="#common-metadata-layout" title="Permalink to this headline"></a></h3>
<p>All metadata records share a common header, with the following fields:</p>
<ul>
<li><p class="first">The <strong>value witness table</strong> pointer references a vtable of functions
that implement the value semantics of the type, providing fundamental
operations such as allocating, copying, and destroying values of the type.
The value witness table also records the size, alignment, stride, and other
fundamental properties of the type. The value witness table pointer is at
<strong>offset -1</strong> from the metadata pointer, that is, the pointer-sized word
<strong>immediately before</strong> the pointer&#8217;s referenced address.</p>
</li>
<li><p class="first">The <strong>kind</strong> field is a pointer-sized integer that describes the kind of type
the metadata describes. This field is at <strong>offset 0</strong> from the metadata
pointer.</p>
<p>The current kind values are as follows:</p>
<ul class="simple">
<li><a class="reference internal" href="#struct-metadata">Struct metadata</a> has a kind of <strong>1</strong>.</li>
<li><a class="reference internal" href="#enum-metadata">Enum metadata</a> has a kind of <strong>2</strong>.</li>
<li><strong>Opaque metadata</strong> has a kind of <strong>8</strong>. This is used for compiler
<code class="docutils literal"><span class="pre">Builtin</span></code> primitives that have no additional runtime information.</li>
<li><a class="reference internal" href="#tuple-metadata">Tuple metadata</a> has a kind of <strong>9</strong>.</li>
<li><a class="reference internal" href="#function-metadata">Function metadata</a> has a kind of <strong>10</strong>.</li>
<li><a class="reference internal" href="#protocol-metadata">Protocol metadata</a> has a kind of <strong>12</strong>. This is used for
protocol types, for protocol compositions, and for the &#8220;any&#8221; type
<code class="docutils literal"><span class="pre">protocol&lt;&gt;</span></code>.</li>
<li><a class="reference internal" href="#metatype-metadata">Metatype metadata</a> has a kind of <strong>13</strong>.</li>
<li><a class="reference internal" href="#class-metadata">Class metadata</a>, instead of a kind, has an <em>isa pointer</em> in its kind slot,
pointing to the class&#8217;s metaclass record. This isa pointer is guaranteed
to have an integer value larger than <strong>4096</strong> and so can be discriminated
from non-class kind values.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="struct-metadata">
<h3><a class="toc-backref" href="#id17">Struct Metadata</a><a class="headerlink" href="#struct-metadata" title="Permalink to this headline"></a></h3>
<p>In addition to the <a class="reference internal" href="#common-metadata-layout">common metadata layout</a> fields, struct metadata records
contain the following fields:</p>
<ul>
<li><p class="first">The <a class="reference internal" href="#nominal-type-descriptor">nominal type descriptor</a> is referenced at <strong>offset 1</strong>.</p>
</li>
<li><p class="first">A reference to the <strong>parent</strong> metadata record is stored at <strong>offset 2</strong>. For
structs that are members of an enclosing nominal type, this is a reference
to the enclosing type&#8217;s metadata. For top-level structs, this is null.</p>
<p>TODO: The parent pointer is currently always null.</p>
</li>
<li><p class="first">A vector of <strong>field offsets</strong> begins at <strong>offset 3</strong>. For each field of the
struct, in <code class="docutils literal"><span class="pre">var</span></code> declaration order, the field&#8217;s offset in bytes from the
beginning of the struct is stored as a pointer-sized integer.</p>
</li>
<li><p class="first">If the struct is generic, then the
<a class="reference internal" href="#generic-parameter-vector">generic parameter vector</a> begins at <strong>offset 3+n</strong>, where <strong>n</strong> is the
number of fields in the struct.</p>
</li>
</ul>
</div>
<div class="section" id="enum-metadata">
<h3><a class="toc-backref" href="#id18">Enum Metadata</a><a class="headerlink" href="#enum-metadata" title="Permalink to this headline"></a></h3>
<p>In addition to the <a class="reference internal" href="#common-metadata-layout">common metadata layout</a> fields, enum metadata records
contain the following fields:</p>
<ul>
<li><p class="first">The <a class="reference internal" href="#nominal-type-descriptor">nominal type descriptor</a> is referenced at <strong>offset 1</strong>.</p>
</li>
<li><p class="first">A reference to the <strong>parent</strong> metadata record is stored at <strong>offset 2</strong>. For
enums that are members of an enclosing nominal type, this is a reference to
the enclosing type&#8217;s metadata. For top-level enums, this is null.</p>
<p>TODO: The parent pointer is currently always null.</p>
</li>
<li><p class="first">If the enum is generic, then the
<a class="reference internal" href="#generic-parameter-vector">generic parameter vector</a> begins at <strong>offset 3</strong>.</p>
</li>
</ul>
</div>
<div class="section" id="tuple-metadata">
<h3><a class="toc-backref" href="#id19">Tuple Metadata</a><a class="headerlink" href="#tuple-metadata" title="Permalink to this headline"></a></h3>
<p>In addition to the <a class="reference internal" href="#common-metadata-layout">common metadata layout</a> fields, tuple metadata records
contain the following fields:</p>
<ul>
<li><p class="first">The <strong>number of elements</strong> in the tuple is a pointer-sized integer at
<strong>offset 1</strong>.</p>
</li>
<li><p class="first">The <strong>labels string</strong> is a pointer to a list of consecutive null-terminated
label names for the tuple at <strong>offset 2</strong>. Each label name is given as a
null-terminated, UTF-8-encoded string in sequence. If the tuple has no
labels, this is a null pointer.</p>
<p>TODO: The labels string pointer is currently always null, and labels are
not factored into tuple metadata uniquing.</p>
</li>
<li><p class="first">The <strong>element vector</strong> begins at <strong>offset 3</strong> and consists of a vector of
type-offset pairs. The metadata for the <em>n</em>th element&#8217;s type is a pointer
at <strong>offset 3+2*n</strong>. The offset in bytes from the beginning of the tuple to
the beginning of the <em>n</em>th element is at <strong>offset 3+2*n+1</strong>.</p>
</li>
</ul>
</div>
<div class="section" id="function-metadata">
<h3><a class="toc-backref" href="#id20">Function Metadata</a><a class="headerlink" href="#function-metadata" title="Permalink to this headline"></a></h3>
<p>In addition to the <a class="reference internal" href="#common-metadata-layout">common metadata layout</a> fields, function metadata records
contain the following fields:</p>
<ul>
<li><p class="first">The number of arguments to the function is stored at <strong>offset 1</strong>.</p>
</li>
<li><p class="first">A reference to the <strong>result type</strong> metadata record is stored at
<strong>offset 2</strong>. If the function has multiple returns, this references a
<a class="reference internal" href="#tuple-metadata">tuple metadata</a> record.</p>
</li>
<li><p class="first">The <strong>argument vector</strong> begins at <strong>offset 3</strong> and consists of pointers to
metadata records of the function&#8217;s arguments.</p>
<p>If the function takes any <strong>inout</strong> arguments, a pointer to each argument&#8217;s
metadata record will be appended separately, the lowest bit being set if it is
<strong>inout</strong>. Because of pointer alignment, the lowest bit will always be free to
hold this tag.</p>
<p>If the function takes no <strong>inout</strong> arguments, there will be only one pointer in
the vector for the following cases:</p>
<ul class="simple">
<li>0 arguments: a <a class="reference internal" href="#tuple-metadata">tuple metadata</a> record for the empty tuple</li>
<li>1 argument: the first and only argument&#8217;s metadata record</li>
<li>&gt;1 argument: a <a class="reference internal" href="#tuple-metadata">tuple metadata</a> record containing the arguments</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="protocol-metadata">
<h3><a class="toc-backref" href="#id21">Protocol Metadata</a><a class="headerlink" href="#protocol-metadata" title="Permalink to this headline"></a></h3>
<p>In addition to the <a class="reference internal" href="#common-metadata-layout">common metadata layout</a> fields, protocol metadata records
contain the following fields:</p>
<ul>
<li><p class="first">A <strong>layout flags</strong> word is stored at <strong>offset 1</strong>. The bits of this word
describe the <a class="reference internal" href="#existential-container-layout">existential container layout</a> used to represent
values of the type. The word is laid out as follows:</p>
<ul class="simple">
<li>The <strong>number of witness tables</strong> is stored in the least significant 31 bits.
Values of the protocol type contain this number of witness table pointers
in their layout.</li>
<li>The <strong>class constraint</strong> is stored at bit 31. This bit is set if the type
is <strong>not</strong> class-constrained, meaning that struct, enum, or class values
can be stored in the type. If not set, then only class values can be stored
in the type, and the type uses a more efficient layout.</li>
</ul>
<p>Note that the field is pointer-sized, even though only the lowest 32 bits are
currently inhabited on all platforms. These values can be derived from the
<a class="reference internal" href="#protocol-descriptor">protocol descriptor</a> records, but are pre-calculated for convenience.</p>
</li>
<li><p class="first">The <strong>number of protocols</strong> that make up the protocol composition is stored at
<strong>offset 2</strong>. For the &#8220;any&#8221; types <code class="docutils literal"><span class="pre">protocol&lt;&gt;</span></code> or <code class="docutils literal"><span class="pre">protocol&lt;class&gt;</span></code>, this
is zero. For a single-protocol type <code class="docutils literal"><span class="pre">P</span></code>, this is one. For a protocol
composition type <code class="docutils literal"><span class="pre">protocol&lt;P,</span> <span class="pre">Q,</span> <span class="pre">...&gt;</span></code>, this is the number of protocols.</p>
</li>
<li><p class="first">The <strong>protocol descriptor vector</strong> begins at <strong>offset 3</strong>. This is an inline
array of pointers to the <a class="reference internal" href="#protocol-descriptor">protocol descriptor</a> for every protocol in the
composition, or the single protocol descriptor for a protocol type. For
an &#8220;any&#8221; type, there is no protocol descriptor vector.</p>
</li>
</ul>
</div>
<div class="section" id="metatype-metadata">
<h3><a class="toc-backref" href="#id22">Metatype Metadata</a><a class="headerlink" href="#metatype-metadata" title="Permalink to this headline"></a></h3>
<p>In addition to the <a class="reference internal" href="#common-metadata-layout">common metadata layout</a> fields, metatype metadata records
contain the following fields:</p>
<ul class="simple">
<li>A reference to the metadata record for the <strong>instance type</strong> that the metatype
represents is stored at <strong>offset 1</strong>.</li>
</ul>
</div>
<div class="section" id="class-metadata">
<h3><a class="toc-backref" href="#id23">Class Metadata</a><a class="headerlink" href="#class-metadata" title="Permalink to this headline"></a></h3>
<p>Class metadata is designed to interoperate with Objective-C; all class metadata
records are also valid Objective-C <code class="docutils literal"><span class="pre">Class</span></code> objects. Class metadata pointers
are used as the values of class metatypes, so a derived class&#8217;s metadata
record also serves as a valid class metatype value for all of its ancestor
classes.</p>
<ul>
<li><p class="first">The <strong>destructor pointer</strong> is stored at <strong>offset -2</strong> from the metadata
pointer, behind the value witness table. This function is invoked by Swift&#8217;s
deallocator when the class instance is destroyed.</p>
</li>
<li><p class="first">The <strong>isa pointer</strong> pointing to the class&#8217;s Objective-C-compatible metaclass
record is stored at <strong>offset 0</strong>, in place of an integer kind discriminator.</p>
</li>
<li><p class="first">The <strong>super pointer</strong> pointing to the metadata record for the superclass is
stored at <strong>offset 1</strong>. If the class is a root class, it is null.</p>
</li>
<li><p class="first">Two words are reserved for use by the Objective-C runtime at <strong>offset 2</strong>
and <strong>offset 3</strong>.</p>
</li>
<li><p class="first">The <strong>rodata pointer</strong> is stored at <strong>offset 4</strong>; it points to an Objective-C
compatible rodata record for the class. This pointer value includes a tag.
The <strong>low bit is always set to 1</strong> for Swift classes and always set to 0 for
Objective-C classes.</p>
</li>
<li><p class="first">The <strong>class flags</strong> are a 32-bit field at <strong>offset 5</strong>.</p>
</li>
<li><p class="first">The <strong>instance address point</strong> is a 32-bit field following the class flags.
A pointer to an instance of this class points this number of bytes after the
beginning of the instance.</p>
</li>
<li><p class="first">The <strong>instance size</strong> is a 32-bit field following the instance address point.
This is the number of bytes of storage present in every object of this type.</p>
</li>
<li><p class="first">The <strong>instance alignment mask</strong> is a 16-bit field following the instance size.
This is a set of low bits which must not be set in a pointer to an instance
of this class.</p>
</li>
<li><p class="first">The <strong>runtime-reserved field</strong> is a 16-bit field following the instance
alignment mask.  The compiler initializes this to zero.</p>
</li>
<li><p class="first">The <strong>class object size</strong> is a 32-bit field following the runtime-reserved
field.  This is the total number of bytes of storage in the class metadata
object.</p>
</li>
<li><p class="first">The <strong>class object address point</strong> is a 32-bit field following the class
object size.  This is the number of bytes of storage in the class metadata
object.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#nominal-type-descriptor">nominal type descriptor</a> for the most-derived class type is referenced
at an offset immediately following the class object address point. This is
<strong>offset 8</strong> on a 64-bit platform or <strong>offset 11</strong> on a 32-bit platform.</p>
</li>
<li><p class="first">For each Swift class in the class&#8217;s inheritance hierarchy, in order starting
from the root class and working down to the most derived class, the following
fields are present:</p>
<ul>
<li><p class="first">First, a reference to the <strong>parent</strong> metadata record is stored.
For classes that are members of an enclosing nominal type, this is a
reference to the enclosing type&#8217;s metadata. For top-level classes, this is
null.</p>
<p>TODO: The parent pointer is currently always null.</p>
</li>
<li><p class="first">If the class is generic, its <a class="reference internal" href="#generic-parameter-vector">generic parameter vector</a> is stored inline.</p>
</li>
<li><p class="first">The <strong>vtable</strong> is stored inline and contains a function pointer to the
implementation of every method of the class in declaration order.</p>
</li>
<li><p class="first">If the layout of a class instance is dependent on its generic parameters,
then a <strong>field offset vector</strong> is stored inline, containing offsets in
bytes from an instance pointer to each field of the class in declaration
order. (For classes with fixed layout, the field offsets are accessible
statically from global variables, similar to Objective-C ivar offsets.)</p>
</li>
</ul>
<p>Note that none of these fields are present for Objective-C base classes in
the inheritance hierarchy.</p>
</li>
</ul>
</div>
<div class="section" id="generic-parameter-vector">
<h3><a class="toc-backref" href="#id24">Generic Parameter Vector</a><a class="headerlink" href="#generic-parameter-vector" title="Permalink to this headline"></a></h3>
<p>Metadata records for instances of generic types contain information about their
generic parameters. For each parameter of the type, a reference to the metadata
record for the type argument is stored.  After all of the type argument
metadata references, for each type parameter, if there are protocol
requirements on that type parameter, a reference to the witness table for each
protocol it is required to conform to is stored in declaration order.</p>
<p>For example, given a generic type with the parameters <code class="docutils literal"><span class="pre">&lt;T,</span> <span class="pre">U,</span> <span class="pre">V&gt;</span></code>, its
generic parameter record will consist of references to the metadata records
for <code class="docutils literal"><span class="pre">T</span></code>, <code class="docutils literal"><span class="pre">U</span></code>, and <code class="docutils literal"><span class="pre">V</span></code> in succession, as if laid out in a C struct:</p>
<div class="highlight-swift"><div class="highlight"><pre><span class="kd">struct </span><span class="nc">GenericParameterVector</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">TypeMetadata</span><span class="w"> </span><span class="o">*</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">V</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>If we add protocol requirements to the parameters, for example,
<code class="docutils literal"><span class="pre">&lt;T:</span> <span class="pre">Runcible,</span> <span class="pre">U:</span> <span class="pre">protocol&lt;Fungible,</span> <span class="pre">Ansible&gt;,</span> <span class="pre">V&gt;</span></code>, then the type&#8217;s generic
parameter vector contains witness tables for those protocols, as if laid out:</p>
<div class="highlight-swift"><div class="highlight"><pre><span class="kd">struct </span><span class="nc">GenericParameterVector</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">TypeMetadata</span><span class="w"> </span><span class="o">*</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">V</span><span class="p">;</span>
<span class="w">  </span><span class="n">RuncibleWitnessTable</span><span class="w"> </span><span class="o">*</span><span class="n">T_Runcible</span><span class="p">;</span>
<span class="w">  </span><span class="n">FungibleWitnessTable</span><span class="w"> </span><span class="o">*</span><span class="n">U_Fungible</span><span class="p">;</span>
<span class="w">  </span><span class="n">AnsibleWitnessTable</span><span class="w"> </span><span class="o">*</span><span class="n">U_Ansible</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="nominal-type-descriptor">
<h3><a class="toc-backref" href="#id25">Nominal Type Descriptor</a><a class="headerlink" href="#nominal-type-descriptor" title="Permalink to this headline"></a></h3>
<p>The metadata records for class, struct, and enum types contain a pointer to a
<strong>nominal type descriptor</strong>, which contains basic information about the nominal
type such as its name, members, and metadata layout. For a generic type, one
nominal type descriptor is shared for all instantiations of the type. The
layout is as follows:</p>
<ul class="simple">
<li>The <strong>kind</strong> of type is stored at <strong>offset 0</strong>, which is as follows:<ul>
<li><strong>0</strong> for a class,</li>
<li><strong>1</strong> for a struct, or</li>
<li><strong>2</strong> for an enum.</li>
</ul>
</li>
<li>The mangled <strong>name</strong> is referenced as a null-terminated C string at
<strong>offset 1</strong>. This name includes no bound generic parameters.</li>
<li>The following four fields depend on the kind of nominal type.<ul>
<li>For a struct or class:<ul>
<li>The <strong>number of fields</strong> is stored at <strong>offset 2</strong>. This is the length
of the field offset vector in the metadata record, if any.</li>
<li>The <strong>offset to the field offset vector</strong> is stored at <strong>offset 3</strong>.
This is the offset in pointer-sized words of the field offset vector for
the type in the metadata record. If no field offset vector is stored
in the metadata record, this is zero.</li>
<li>The <strong>field names</strong> are referenced as a doubly-null-terminated list of
C strings at <strong>offset 4</strong>. The order of names corresponds to the order
of fields in the field offset vector.</li>
<li>The <strong>field type accessor</strong> is a function pointer at <strong>offset 5</strong>. If
non-null, the function takes a pointer to an instance of type metadata
for the nominal type, and returns a pointer to an array of type metadata
references for the types of the fields of that instance. The order matches
that of the field offset vector and field name list.</li>
</ul>
</li>
<li>For an enum:<ul>
<li>The <strong>number of payload cases</strong> and <strong>payload size offset</strong> are stored
at <strong>offset 2</strong>. The least significant 24 bits are the number of payload
cases, and the most significant 8 bits are the offset of the payload
size in the type metadata, if present.</li>
<li>The <strong>number of no-payload cases</strong> is stored at <strong>offset 3</strong>.</li>
<li>The <strong>case names</strong> are referenced as a doubly-null-terminated list of
C strings at <strong>offset 4</strong>. The names are ordered such that payload cases
come first, followed by no-payload cases. Within each half of the list,
the order of names corresponds to the order of cases in the enum
declaration.</li>
<li>The <strong>case type accessor</strong> is a function pointer at <strong>offset 5</strong>. If
non-null, the function takes a pointer to an instance of type metadata
for the enum, and returns a pointer to an array of type metadata
references for the types of the cases of that instance. The order matches
that of the case name list. This function is similar to the field type
accessor for a struct, except also the least significant bit of each
element in the result is set if the enum case is an <strong>indirect case</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>If the nominal type is generic, a pointer to the <strong>metadata pattern</strong> that
is used to form instances of the type is stored at <strong>offset 6</strong>. The pointer
is null if the type is not generic.</li>
<li>The <strong>generic parameter descriptor</strong> begins at <strong>offset 7</strong>. This describes
the layout of the generic parameter vector in the metadata record:<ul>
<li>The <strong>offset of the generic parameter vector</strong> is stored at <strong>offset 7</strong>.
This is the offset in pointer-sized words of the generic parameter vector
inside the metadata record. If the type is not generic, this is zero.</li>
<li>The <strong>number of type parameters</strong> is stored at <strong>offset 8</strong>. This count
includes associated types of type parameters with protocol constraints.</li>
<li>The <strong>number of type parameters</strong> is stored at <strong>offset 9</strong>. This count
includes only the primary formal type parameters.</li>
<li>For each type parameter <strong>n</strong>, the following fields are stored:<ul>
<li>The <strong>number of witnesses</strong> for the type parameter is stored at
<strong>offset 10+n</strong>. This is the number of witness table pointers that are
stored for the type parameter in the generic parameter vector.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Note that there is no nominal type descriptor for protocols or protocol types.
See the <a class="reference internal" href="#protocol-descriptor">protocol descriptor</a> description below.</p>
</div>
<div class="section" id="protocol-descriptor">
<h3><a class="toc-backref" href="#id26">Protocol Descriptor</a><a class="headerlink" href="#protocol-descriptor" title="Permalink to this headline"></a></h3>
<p><cite>Protocol metadata</cite> contains references to zero, one, or more <strong>protocol
descriptors</strong> that describe the protocols values of the type are required to
conform to. The protocol descriptor is laid out to be compatible with
Objective-C <code class="docutils literal"><span class="pre">Protocol</span></code> objects. The layout is as follows:</p>
<ul class="simple">
<li>An <strong>isa</strong> placeholder is stored at <strong>offset 0</strong>. This field is populated by
the Objective-C runtime.</li>
<li>The mangled <strong>name</strong> is referenced as a null-terminated C string at
<strong>offset 1</strong>.</li>
<li>If the protocol inherits one or more other protocols, a pointer to the
<strong>inherited protocols list</strong> is stored at <strong>offset 2</strong>. The list starts with
the number of inherited protocols as a pointer-sized integer, and is followed
by that many protocol descriptor pointers. If the protocol inherits no other
protocols, this pointer is null.</li>
<li>For an ObjC-compatible protocol, its <strong>required instance methods</strong> are stored
at <strong>offset 3</strong> as an ObjC-compatible method list. This is null for native
Swift protocols.</li>
<li>For an ObjC-compatible protocol, its <strong>required class methods</strong> are stored
at <strong>offset 4</strong> as an ObjC-compatible method list. This is null for native
Swift protocols.</li>
<li>For an ObjC-compatible protocol, its <strong>optional instance methods</strong> are stored
at <strong>offset 5</strong> as an ObjC-compatible method list. This is null for native
Swift protocols.</li>
<li>For an ObjC-compatible protocol, its <strong>optional class methods</strong> are stored
at <strong>offset 6</strong> as an ObjC-compatible method list. This is null for native
Swift protocols.</li>
<li>For an ObjC-compatible protocol, its <strong>instance properties</strong> are stored
at <strong>offset 7</strong> as an ObjC-compatible property list. This is null for native
Swift protocols.</li>
<li>The <strong>size</strong> of the protocol descriptor record is stored as a 32-bit integer
at <strong>offset 8</strong>. This is currently 72 on 64-bit platforms and 40 on 32-bit
platforms.</li>
<li><strong>Flags</strong> are stored as a 32-bit integer after the size. The following bits
are currently used (counting from least significant bit zero):<ul>
<li><strong>Bit 0</strong> is the <strong>Swift bit</strong>. It is set for all protocols defined in
Swift and unset for protocols defined in Objective-C.</li>
<li><strong>Bit 1</strong> is the <strong>class constraint bit</strong>. It is set if the protocol is
<strong>not</strong> class-constrained, meaning that any struct, enum, or class type
may conform to the protocol. It is unset if only classes can conform to
the protocol. (The inverted meaning is for compatibility with Objective-C
protocol records, in which the bit is never set. Objective-C protocols can
only be conformed to by classes.)</li>
<li><strong>Bit 2</strong> is the <strong>witness table bit</strong>. It is set if dispatch to the
protocol&#8217;s methods is done through a witness table, which is either passed
as an extra parameter to generic functions or included in the <a class="reference internal" href="#existential-container-layout">existential
container layout</a> of protocol types. It is unset if dispatch is done
through <code class="docutils literal"><span class="pre">objc_msgSend</span></code> and requires no additional information to accompany
a value of conforming type.</li>
<li><strong>Bit 31</strong> is set by the Objective-C runtime when it has done its
initialization of the protocol record. It is unused by the Swift runtime.</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="heap-objects">
<h2><a class="toc-backref" href="#id27">Heap Objects</a><a class="headerlink" href="#heap-objects" title="Permalink to this headline"></a></h2>
<div class="section" id="heap-metadata">
<h3><a class="toc-backref" href="#id28">Heap Metadata</a><a class="headerlink" href="#heap-metadata" title="Permalink to this headline"></a></h3>
</div>
<div class="section" id="heap-object-header">
<h3><a class="toc-backref" href="#id29">Heap Object Header</a><a class="headerlink" href="#heap-object-header" title="Permalink to this headline"></a></h3>
</div>
</div>
<div class="section" id="mangling">
<h2><a class="toc-backref" href="#id30">Mangling</a><a class="headerlink" href="#mangling" title="Permalink to this headline"></a></h2>
<div class="highlight-swift"><div class="highlight"><pre>mangled-name ::= &#39;_T&#39; global
</pre></div>
</div>
<p>All Swift-mangled names begin with this prefix.</p>
<div class="section" id="globals">
<h3><a class="toc-backref" href="#id31">Globals</a><a class="headerlink" href="#globals" title="Permalink to this headline"></a></h3>
<div class="highlight-swift"><div class="highlight"><pre>global ::= &#39;t&#39; type                    // standalone type (for DWARF)
global ::= &#39;M&#39; type                    // type metadata (address point)
                                       // -- type starts with [BCOSTV]
global ::= &#39;Mf&#39; type                   // &#39;full&#39; type metadata (start of object)
global ::= &#39;MP&#39; type                   // type metadata pattern
global ::= &#39;Ma&#39; type                   // type metadata access function
global ::= &#39;ML&#39; type                   // type metadata lazy cache variable
global ::= &#39;Mm&#39; type                   // class metaclass
global ::= &#39;Mn&#39; nominal-type           // nominal type descriptor
global ::= &#39;Mp&#39; protocol               // protocol descriptor
global ::= &#39;PA&#39; .*                     // partial application forwarder
global ::= &#39;PAo&#39; .*                    // ObjC partial application forwarder
global ::= &#39;w&#39; value-witness-kind type // value witness
global ::= &#39;Wa&#39; protocol-conformance   // protocol witness table accessor
global ::= &#39;WG&#39; protocol-conformance   // generic protocol witness table
global ::= &#39;WI&#39; protocol-conformance   // generic protocol witness table instantiation function
global ::= &#39;Wl&#39; type protocol-conformance // lazy protocol witness table accessor
global ::= &#39;WL&#39; protocol-conformance   // lazy protocol witness table cache variable
global ::= &#39;Wo&#39; entity                 // witness table offset
global ::= &#39;WP&#39; protocol-conformance   // protocol witness table
global ::= &#39;Wt&#39; protocol-conformance identifier // associated type metadata accessor
global ::= &#39;WT&#39; protocol-conformance identifier nominal-type // associated type witness table accessor
global ::= &#39;Wv&#39; directness entity      // field offset
global ::= &#39;WV&#39; type                   // value witness table
global ::= entity                      // some identifiable thing
global ::= &#39;TO&#39; global                 // ObjC-as-swift thunk
global ::= &#39;To&#39; global                 // swift-as-ObjC thunk
global ::= &#39;TD&#39; global                 // dynamic dispatch thunk
global ::= &#39;Td&#39; global                 // direct method reference thunk
global ::= &#39;TR&#39; reabstract-signature   // reabstraction thunk helper function
global ::= &#39;Tr&#39; reabstract-signature   // reabstraction thunk

global ::= &#39;TS&#39; specializationinfo &#39;_&#39; mangled-name
specializationinfo ::= &#39;g&#39; passid (type protocol-conformance* &#39;_&#39;)+            // Generic specialization info.
specializationinfo ::= &#39;f&#39; passid (funcspecializationarginfo &#39;_&#39;)+             // Function signature specialization kind
passid ::= integer                                                             // The id of the pass that generated this specialization.
funcsigspecializationarginfo ::= &#39;cl&#39; closurename type*                        // Closure specialized with closed over types in argument order.
funcsigspecializationarginfo ::= &#39;n&#39;                                           // Unmodified argument
funcsigspecializationarginfo ::= &#39;cp&#39; funcsigspecializationconstantproppayload // Constant propagated argument
funcsigspecializationarginfo ::= &#39;d&#39;                                           // Dead argument
funcsigspecializationarginfo ::= &#39;g&#39; &#39;s&#39;?                                      // Owned =&gt; Guaranteed and Exploded if &#39;s&#39; present.
funcsigspecializationarginfo ::= &#39;s&#39;                                           // Exploded
funcsigspecializationarginfo ::= &#39;k&#39;                                           // Exploded
funcsigspecializationconstantpropinfo ::= &#39;fr&#39; mangled-name
funcsigspecializationconstantpropinfo ::= &#39;g&#39; mangled-name
funcsigspecializationconstantpropinfo ::= &#39;i&#39; 64-bit-integer
funcsigspecializationconstantpropinfo ::= &#39;fl&#39; float-as-64-bit-integer
funcsigspecializationconstantpropinfo ::= &#39;se&#39; stringencoding &#39;v&#39; md5hash

global ::= &#39;TV&#39; global                 // vtable override thunk
global ::= &#39;TW&#39; protocol-conformance entity
                                       // protocol witness thunk
entity ::= nominal-type                // named type declaration
entity ::= static? entity-kind context entity-name
entity-kind ::= &#39;F&#39;                    // function (ctor, accessor, etc.)
entity-kind ::= &#39;v&#39;                    // variable (let/var)
entity-kind ::= &#39;i&#39;                    // subscript (&#39;i&#39;ndex) itself (not the individual accessors)
entity-kind ::= &#39;I&#39;                    // initializer
entity-name ::= decl-name type         // named declaration
entity-name ::= &#39;A&#39; index              // default argument generator
entity-name ::= &#39;a&#39; addressor-kind decl-name type     // mutable addressor
entity-name ::= &#39;C&#39; type               // allocating constructor
entity-name ::= &#39;c&#39; type               // non-allocating constructor
entity-name ::= &#39;D&#39;                    // deallocating destructor; untyped
entity-name ::= &#39;d&#39;                    // non-deallocating destructor; untyped
entity-name ::= &#39;g&#39; decl-name type     // getter
entity-name ::= &#39;i&#39;                    // non-local variable initializer
entity-name ::= &#39;l&#39; addressor-kind decl-name type     // non-mutable addressor
entity-name ::= &#39;m&#39; decl-name type     // materializeForSet
entity-name ::= &#39;s&#39; decl-name type     // setter
entity-name ::= &#39;U&#39; index type         // explicit anonymous closure expression
entity-name ::= &#39;u&#39; index type         // implicit anonymous closure
entity-name ::= &#39;w&#39; decl-name type     // willSet
entity-name ::= &#39;W&#39; decl-name type     // didSet
static ::= &#39;Z&#39;                         // entity is a static member of a type
decl-name ::= identifier
decl-name ::= local-decl-name
decl-name ::= private-decl-name
local-decl-name ::= &#39;L&#39; index identifier  // locally-discriminated declaration
private-decl-name ::= &#39;P&#39; identifier identifier  // file-discriminated declaration
reabstract-signature ::= (&#39;G&#39; generic-signature)? type type
addressor-kind ::= &#39;u&#39;                 // unsafe addressor (no owner)
addressor-kind ::= &#39;O&#39;                 // owning addressor (non-native owner)
addressor-kind ::= &#39;o&#39;                 // owning addressor (native owner)
addressor-kind ::= &#39;p&#39;                 // pinning addressor (native owner)
</pre></div>
</div>
<p>An <code class="docutils literal"><span class="pre">entity</span></code> starts with a <code class="docutils literal"><span class="pre">nominal-type-kind</span></code> (<code class="docutils literal"><span class="pre">[COPV]</span></code>), a
substitution (<code class="docutils literal"><span class="pre">[Ss]</span></code>) of a nominal type, or an <code class="docutils literal"><span class="pre">entity-kind</span></code>
(<code class="docutils literal"><span class="pre">[FIiv]</span></code>).</p>
<p>An <code class="docutils literal"><span class="pre">entity-name</span></code> starts with <code class="docutils literal"><span class="pre">[AaCcDggis]</span></code> or a <code class="docutils literal"><span class="pre">decl-name</span></code>.
A <code class="docutils literal"><span class="pre">decl-name</span></code> starts with <code class="docutils literal"><span class="pre">[LP]</span></code> or an <code class="docutils literal"><span class="pre">identifier</span></code> (<code class="docutils literal"><span class="pre">[0-9oX]</span></code>).</p>
<p>A <code class="docutils literal"><span class="pre">context</span></code> starts with either an <code class="docutils literal"><span class="pre">entity</span></code>, an <code class="docutils literal"><span class="pre">extension</span></code> (which starts
with <code class="docutils literal"><span class="pre">[Ee]</span></code>), or a <code class="docutils literal"><span class="pre">module</span></code>, which might be an <code class="docutils literal"><span class="pre">identifier</span></code> (<code class="docutils literal"><span class="pre">[0-9oX]</span></code>)
or a substitution of a module (<code class="docutils literal"><span class="pre">[Ss]</span></code>).</p>
<p>A global mangling starts with an <code class="docutils literal"><span class="pre">entity</span></code> or <code class="docutils literal"><span class="pre">[MTWw]</span></code>.</p>
<p>If a partial application forwarder is for a static symbol, its name will
start with the sequence <code class="docutils literal"><span class="pre">_TPA_</span></code> followed by the mangled symbol name of the
forwarder&#8217;s destination.</p>
<p>A generic specialization mangling consists of a header, specifying the types
and conformances used to specialize the generic function, followed by the
full mangled name of the original unspecialized generic symbol.</p>
<p>The first identifier in a <code class="docutils literal"><span class="pre">&lt;private-decl-name&gt;</span></code> is a string that represents
the file the original declaration came from. It should be considered unique
within the enclosing module. The second identifier is the name of the entity.</p>
<p>Not all declarations marked <code class="docutils literal"><span class="pre">private</span></code> declarations will use the
<code class="docutils literal"><span class="pre">&lt;private-decl-name&gt;</span></code> mangling; if the entity&#8217;s context is enough to uniquely
identify the entity, the simple <code class="docutils literal"><span class="pre">identifier</span></code> form is preferred.</p>
<p>The types in a <code class="docutils literal"><span class="pre">&lt;reabstract-signature&gt;</span></code> are always non-polymorphic
<code class="docutils literal"><span class="pre">&lt;impl-function-type&gt;</span></code> types.</p>
</div>
<div class="section" id="direct-and-indirect-symbols">
<h3><a class="toc-backref" href="#id32">Direct and Indirect Symbols</a><a class="headerlink" href="#direct-and-indirect-symbols" title="Permalink to this headline"></a></h3>
<div class="highlight-swift"><div class="highlight"><pre>directness ::= &#39;d&#39;                         // direct
directness ::= &#39;i&#39;                         // indirect
</pre></div>
</div>
<p>A direct symbol resolves directly to the address of an object.  An
indirect symbol resolves to the address of a pointer to the object.
They are distinct manglings to make a certain class of bugs
immediately obvious.</p>
<p>The terminology is slightly overloaded when discussing offsets.  A
direct offset resolves to a variable holding the true offset.  An
indirect offset resolves to a variable holding an offset to be applied
to type metadata to get the address of the true offset.  (Offset
variables are required when the object being accessed lies within a
resilient structure.  When the layout of the object may depend on
generic arguments, these offsets must be kept in metadata.  Indirect
field offsets are therefore required when accessing fields in generic
types where the metadata itself has unknown layout.)</p>
</div>
<div class="section" id="declaration-contexts">
<h3><a class="toc-backref" href="#id33">Declaration Contexts</a><a class="headerlink" href="#declaration-contexts" title="Permalink to this headline"></a></h3>
<div class="highlight-swift"><div class="highlight"><pre>context ::= module
context ::= extension
context ::= entity
module ::= substitution                    // other substitution
module ::= identifier                      // module name
module ::= known-module                    // abbreviation
extension ::= &#39;E&#39; module entity
extension ::= &#39;e&#39; module generic-signature entity
</pre></div>
</div>
<p>These manglings identify the enclosing context in which an entity was declared,
such as its enclosing module, function, or nominal type.</p>
<p>An <code class="docutils literal"><span class="pre">extension</span></code> mangling is used whenever an entity&#8217;s declaration context is
an extension <em>and</em> the entity being extended is in a different module. In this
case the extension&#8217;s module is mangled first, followed by the entity being
extended. If the extension and the extended entity are in the same module, the
plain <code class="docutils literal"><span class="pre">entity</span></code> mangling is preferred. If the extension is constrained, the
constraints on the extension are mangled in its generic signature.</p>
<p>When mangling the context of a local entity within a constructor or
destructor, the non-allocating or non-deallocating variant is used.</p>
</div>
<div class="section" id="types">
<h3><a class="toc-backref" href="#id34">Types</a><a class="headerlink" href="#types" title="Permalink to this headline"></a></h3>
<div class="highlight-swift"><div class="highlight"><pre>type ::= &#39;Bb&#39;                              // Builtin.BridgeObject
type ::= &#39;BB&#39;                              // Builtin.UnsafeValueBuffer
type ::= &#39;Bf&#39; natural &#39;_&#39;                  // Builtin.Float&lt;n&gt;
type ::= &#39;Bi&#39; natural &#39;_&#39;                  // Builtin.Int&lt;n&gt;
type ::= &#39;BO&#39;                              // Builtin.UnknownObject
type ::= &#39;Bo&#39;                              // Builtin.NativeObject
type ::= &#39;Bp&#39;                              // Builtin.RawPointer
type ::= &#39;Bv&#39; natural type                 // Builtin.Vec&lt;n&gt;x&lt;type&gt;
type ::= &#39;Bw&#39;                              // Builtin.Word
type ::= nominal-type
type ::= associated-type
type ::= &#39;a&#39; context identifier            // Type alias (DWARF only)
type ::= &#39;b&#39; type type                     // objc block function type
type ::= &#39;c&#39; type type                     // C function pointer type
type ::= &#39;F&#39; throws-annotation? type type  // function type
type ::= &#39;f&#39; throws-annotation? type type  // uncurried function type
type ::= &#39;G&#39; type &lt;type&gt;+ &#39;_&#39;              // generic type application
type ::= &#39;K&#39; type type                     // @auto_closure function type
type ::= &#39;M&#39; type                          // metatype without representation
type ::= &#39;XM&#39; metatype-repr type           // metatype with representation
type ::= &#39;P&#39; protocol-list &#39;_&#39;             // protocol type
type ::= &#39;PM&#39; type                         // existential metatype without representation
type ::= &#39;XPM&#39; metatype-repr type          // existential metatype with representation
type ::= archetype
type ::= &#39;R&#39; type                          // inout
type ::= &#39;T&#39; tuple-element* &#39;_&#39;            // tuple
type ::= &#39;t&#39; tuple-element* &#39;_&#39;            // variadic tuple
type ::= &#39;Xo&#39; type                         // @unowned type
type ::= &#39;Xu&#39; type                         // @unowned(unsafe) type
type ::= &#39;Xw&#39; type                         // @weak type
type ::= &#39;XF&#39; impl-function-type           // function implementation type
type ::= &#39;Xf&#39; type type                    // @thin function type
type ::= &#39;Xb&#39; type                         // SIL @box type
nominal-type ::= known-nominal-type
nominal-type ::= substitution
nominal-type ::= nominal-type-kind declaration-name
nominal-type-kind ::= &#39;C&#39;                  // class
nominal-type-kind ::= &#39;O&#39;                  // enum
nominal-type-kind ::= &#39;V&#39;                  // struct
declaration-name ::= context decl-name
archetype ::= &#39;Q&#39; index                    // archetype with depth=0, idx=N
archetype ::= &#39;Qd&#39; index index             // archetype with depth=M+1, idx=N
archetype ::= associated-type
archetype ::= qualified-archetype
associated-type ::= substitution
associated-type ::= &#39;Q&#39; protocol-context     // self type of protocol
associated-type ::= &#39;Q&#39; archetype identifier // associated type
qualified-archetype ::= &#39;Qq&#39; index context   // archetype+context (DWARF only)
protocol-context ::= &#39;P&#39; protocol
tuple-element ::= identifier? type
metatype-repr ::= &#39;t&#39;                      // Thin metatype representation
metatype-repr ::= &#39;T&#39;                      // Thick metatype representation
metatype-repr ::= &#39;o&#39;                      // ObjC metatype representation
throws-annotation ::= &#39;z&#39;                  // &#39;throws&#39; annotation on function types


type ::= &#39;u&#39; generic-signature type        // generic type
type ::= &#39;x&#39;                               // generic param, depth=0, idx=0
type ::= &#39;q&#39; generic-param-index           // dependent generic parameter
type ::= &#39;q&#39; type assoc-type-name          // associated type of non-generic param
type ::= &#39;w&#39; generic-param-index assoc-type-name // associated type
type ::= &#39;W&#39; generic-param-index assoc-type-name+ &#39;_&#39; // associated type at depth

generic-param-index ::= &#39;x&#39;                // depth = 0,   idx = 0
generic-param-index ::= index              // depth = 0,   idx = N+1
generic-param-index ::= &#39;d&#39; index index    // depth = M+1, idx = N
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&lt;type&gt;</span></code> never begins or ends with a number.
<code class="docutils literal"><span class="pre">&lt;type&gt;</span></code> never begins with an underscore.
<code class="docutils literal"><span class="pre">&lt;type&gt;</span></code> never begins with <code class="docutils literal"><span class="pre">d</span></code>.
<code class="docutils literal"><span class="pre">&lt;type&gt;</span></code> never begins with <code class="docutils literal"><span class="pre">z</span></code>.</p>
<p>Note that protocols mangle differently as types and as contexts. A protocol
context always consists of a single protocol name and so mangles without a
trailing underscore. A protocol type can have zero, one, or many protocol bounds
which are juxtaposed and terminated with a trailing underscore.</p>
<div class="highlight-swift"><div class="highlight"><pre>assoc-type-name ::= (&#39;P&#39; protocol-name)? identifier
assoc-type-name ::= substitution
</pre></div>
</div>
<p>Associated types use an abbreviated mangling when the base generic parameter
or associated type is constrained by a single protocol requirement. The
associated type in this case can be referenced unambiguously by name alone.
If the base has multiple conformance constraints, then the protocol name is
mangled in to disambiguate.</p>
<div class="highlight-swift"><div class="highlight"><pre>impl-function-type ::=
  impl-callee-convention impl-function-attribute* generic-signature? &#39;_&#39;
  impl-parameter* &#39;_&#39; impl-result* &#39;_&#39;
impl-callee-convention ::= &#39;t&#39;              // thin
impl-callee-convention ::= impl-convention  // thick, callee transferred with given convention
impl-convention ::= &#39;a&#39;                     // direct, autoreleased
impl-convention ::= &#39;d&#39;                     // direct, no ownership transfer
impl-convention ::= &#39;D&#39;                     // direct, no ownership transfer,
                                            // dependent on &#39;self&#39; parameter
impl-convention ::= &#39;g&#39;                     // direct, guaranteed
impl-convention ::= &#39;e&#39;                     // direct, deallocating
impl-convention ::= &#39;i&#39;                     // indirect, ownership transfer
impl-convention ::= &#39;l&#39;                     // indirect, inout
impl-convention ::= &#39;G&#39;                     // indirect, guaranteed
impl-convention ::= &#39;o&#39;                     // direct, ownership transfer
impl-convention ::= &#39;z&#39; impl-convention     // error result
impl-function-attribute ::= &#39;Cb&#39;            // compatible with C block invocation function
impl-function-attribute ::= &#39;Cc&#39;            // compatible with C global function
impl-function-attribute ::= &#39;Cm&#39;            // compatible with Swift method
impl-function-attribute ::= &#39;CO&#39;            // compatible with ObjC method
impl-function-attribute ::= &#39;Cw&#39;            // compatible with protocol witness
impl-function-attribute ::= &#39;N&#39;             // noreturn
impl-function-attribute ::= &#39;G&#39;             // generic
impl-function-attribute ::= &#39;g&#39;             // pseudogeneric
impl-parameter ::= impl-convention type
impl-result ::= impl-convention type
</pre></div>
</div>
<p>For the most part, manglings follow the structure of formal language
types.  However, in some cases it is more useful to encode the exact
implementation details of a function type.</p>
<p>Any <code class="docutils literal"><span class="pre">&lt;impl-function-attribute&gt;</span></code> productions must appear in the order
in which they are specified above: e.g. a noreturn C function is
mangled with <code class="docutils literal"><span class="pre">CcN</span></code>.  <code class="docutils literal"><span class="pre">g</span></code> and <code class="docutils literal"><span class="pre">G</span></code> are exclusive and mark the presence
of a generic signature immediately following.</p>
<p>Note that the convention and function-attribute productions do not
need to be disambiguated from the start of a <code class="docutils literal"><span class="pre">&lt;type&gt;</span></code>.</p>
</div>
<div class="section" id="generics">
<h3><a class="toc-backref" href="#id35">Generics</a><a class="headerlink" href="#generics" title="Permalink to this headline"></a></h3>
<div class="highlight-swift"><div class="highlight"><pre>protocol-conformance ::= (&#39;u&#39; generic-signature)? type protocol module
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&lt;protocol-conformance&gt;</span></code> refers to a type&#8217;s conformance to a protocol. The
named module is the one containing the extension or type declaration that
declared the conformance.</p>
<div class="highlight-swift"><div class="highlight"><pre>// Property behavior conformance
protocol-conformance ::= (&#39;u&#39; generic-signature)?
                         &#39;b&#39; identifier context identifier protocol
</pre></div>
</div>
<p>Property behaviors are implemented using private protocol conformances.</p>
<div class="highlight-swift"><div class="highlight"><pre>generic-signature ::= (generic-param-count+)? (&#39;R&#39; requirement*)? &#39;r&#39;
generic-param-count ::= &#39;z&#39;       // zero parameters
generic-param-count ::= index     // N+1 parameters
requirement ::= type-param protocol-name // protocol requirement
requirement ::= type-param type          // base class requirement
                                         // type starts with [CS]
requirement ::= type-param &#39;z&#39; type      // &#39;z&#39;ame-type requirement

// Special type mangling for type params that saves the initial &#39;q&#39; on
// generic params
type-param ::= generic-param-index       // generic parameter
type-param ::= &#39;w&#39; generic-param-index assoc-type-name // associated type
type-param ::= &#39;W&#39; generic-param-index assoc-type-name+ &#39;_&#39;
</pre></div>
</div>
<p>A generic signature begins by describing the number of generic parameters at
each depth of the signature, followed by the requirements. As a special case,
no <code class="docutils literal"><span class="pre">generic-param-count</span></code> values indicates a single generic parameter at
the outermost depth:</p>
<div class="highlight-swift"><div class="highlight"><pre><span class="n">urFq_q_</span><span class="w">                           </span><span class="c1">// &lt;T_0_0&gt; T_0_0 -&gt; T_0_0</span>
<span class="n">u_0_rFq_qd_0_</span><span class="w">                     </span><span class="c1">// &lt;T_0_0&gt;&lt;T_1_0, T_1_1&gt; T_0_0 -&gt; T_1_1</span>
</pre></div>
</div>
</div>
<div class="section" id="value-witnesses">
<h3><a class="toc-backref" href="#id36">Value Witnesses</a><a class="headerlink" href="#value-witnesses" title="Permalink to this headline"></a></h3>
<p>TODO: document these</p>
<div class="highlight-swift"><div class="highlight"><pre>value-witness-kind ::= &#39;al&#39;           // allocateBuffer
value-witness-kind ::= &#39;ca&#39;           // assignWithCopy
value-witness-kind ::= &#39;ta&#39;           // assignWithTake
value-witness-kind ::= &#39;de&#39;           // deallocateBuffer
value-witness-kind ::= &#39;xx&#39;           // destroy
value-witness-kind ::= &#39;XX&#39;           // destroyBuffer
value-witness-kind ::= &#39;Xx&#39;           // destroyArray
value-witness-kind ::= &#39;CP&#39;           // initializeBufferWithCopyOfBuffer
value-witness-kind ::= &#39;Cp&#39;           // initializeBufferWithCopy
value-witness-kind ::= &#39;cp&#39;           // initializeWithCopy
value-witness-kind ::= &#39;TK&#39;           // initializeBufferWithTakeOfBuffer
value-witness-kind ::= &#39;Tk&#39;           // initializeBufferWithTake
value-witness-kind ::= &#39;tk&#39;           // initializeWithTake
value-witness-kind ::= &#39;pr&#39;           // projectBuffer
value-witness-kind ::= &#39;xs&#39;           // storeExtraInhabitant
value-witness-kind ::= &#39;xg&#39;           // getExtraInhabitantIndex
value-witness-kind ::= &#39;Cc&#39;           // initializeArrayWithCopy
value-witness-kind ::= &#39;Tt&#39;           // initializeArrayWithTakeFrontToBack
value-witness-kind ::= &#39;tT&#39;           // initializeArrayWithTakeBackToFront
value-witness-kind ::= &#39;ug&#39;           // getEnumTag
value-witness-kind ::= &#39;up&#39;           // destructiveProjectEnumData
value-witness-kind ::= &#39;ui&#39;           // destructiveInjectEnumTag
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&lt;value-witness-kind&gt;</span></code> differentiates the kinds of value
witness functions for a type.</p>
</div>
<div class="section" id="identifiers">
<h3><a class="toc-backref" href="#id37">Identifiers</a><a class="headerlink" href="#identifiers" title="Permalink to this headline"></a></h3>
<div class="highlight-swift"><div class="highlight"><pre>identifier ::= natural identifier-start-char identifier-char*
identifier ::= &#39;o&#39; operator-fixity natural operator-char+

operator-fixity ::= &#39;p&#39;                    // prefix operator
operator-fixity ::= &#39;P&#39;                    // postfix operator
operator-fixity ::= &#39;i&#39;                    // infix operator

operator-char ::= &#39;a&#39;                      // &amp; &#39;and&#39;
operator-char ::= &#39;c&#39;                      // @ &#39;commercial at&#39;
operator-char ::= &#39;d&#39;                      // / &#39;divide&#39;
operator-char ::= &#39;e&#39;                      // = &#39;equals&#39;
operator-char ::= &#39;g&#39;                      // &gt; &#39;greater&#39;
operator-char ::= &#39;l&#39;                      // &lt; &#39;less&#39;
operator-char ::= &#39;m&#39;                      // * &#39;multiply&#39;
operator-char ::= &#39;n&#39;                      // ! &#39;not&#39;
operator-char ::= &#39;o&#39;                      // | &#39;or&#39;
operator-char ::= &#39;p&#39;                      // + &#39;plus&#39;
operator-char ::= &#39;q&#39;                      // ? &#39;question&#39;
operator-char ::= &#39;r&#39;                      // % &#39;remainder&#39;
operator-char ::= &#39;s&#39;                      // - &#39;subtract&#39;
operator-char ::= &#39;t&#39;                      // ~ &#39;tilde&#39;
operator-char ::= &#39;x&#39;                      // ^ &#39;xor&#39;
operator-char ::= &#39;z&#39;                      // . &#39;zperiod&#39;
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&lt;identifier&gt;</span></code> is run-length encoded: the natural indicates how many
characters follow.  Operator characters are mapped to letter characters as
given. In neither case can an identifier start with a digit, so
there&#8217;s no ambiguity with the run-length.</p>
<div class="highlight-swift"><div class="highlight"><pre>identifier ::= &#39;X&#39; natural identifier-start-char identifier-char*
identifier ::= &#39;X&#39; &#39;o&#39; operator-fixity natural identifier-char*
</pre></div>
</div>
<p>Identifiers that contain non-ASCII characters are encoded using the Punycode
algorithm specified in RFC 3492, with the modifications that <code class="docutils literal"><span class="pre">_</span></code> is used
as the encoding delimiter, and uppercase letters A through J are used in place
of digits 0 through 9 in the encoding character set. The mangling then
consists of an <code class="docutils literal"><span class="pre">X</span></code> followed by the run length of the encoded string and the
encoded string itself. For example, the identifier <code class="docutils literal"><span class="pre">vergenza</span></code> is mangled
to <code class="docutils literal"><span class="pre">X12vergenza_JFa</span></code>. (The encoding in standard Punycode would be
<code class="docutils literal"><span class="pre">vergenza-95a</span></code>)</p>
<p>Operators that contain non-ASCII characters are mangled by first mapping the
ASCII operator characters to letters as for pure ASCII operator names, then
Punycode-encoding the substituted string. The mangling then consists of
<code class="docutils literal"><span class="pre">Xo</span></code> followed by the fixity, run length of the encoded string, and the encoded
string itself. For example, the infix operator <code class="docutils literal"><span class="pre">+</span></code> is mangled to
<code class="docutils literal"><span class="pre">Xoi7p_qcaDc</span></code> (<code class="docutils literal"><span class="pre">p_qcaDc</span></code> being the encoding of the substituted
string <code class="docutils literal"><span class="pre">p</span></code>).</p>
</div>
<div class="section" id="substitutions">
<h3><a class="toc-backref" href="#id38">Substitutions</a><a class="headerlink" href="#substitutions" title="Permalink to this headline"></a></h3>
<div class="highlight-swift"><div class="highlight"><pre>substitution ::= &#39;S&#39; index
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&lt;substitution&gt;</span></code> is a back-reference to a previously mangled entity. The mangling
algorithm maintains a mapping of entities to substitution indices as it runs.
When an entity that can be represented by a substitution (a module, nominal
type, or protocol) is mangled, a substitution is first looked for in the
substitution map, and if it is present, the entity is mangled using the
associated substitution index. Otherwise, the entity is mangled normally, and
it is then added to the substitution map and associated with the next
available substitution index.</p>
<p>For example, in mangling a function type
<code class="docutils literal"><span class="pre">(zim.zang.zung,</span> <span class="pre">zim.zang.zung,</span> <span class="pre">zim.zippity)</span> <span class="pre">-&gt;</span> <span class="pre">zim.zang.zoo</span></code> (with module
<code class="docutils literal"><span class="pre">zim</span></code> and class <code class="docutils literal"><span class="pre">zim.zang</span></code>),
the recurring contexts <code class="docutils literal"><span class="pre">zim</span></code>, <code class="docutils literal"><span class="pre">zim.zang</span></code>, and <code class="docutils literal"><span class="pre">zim.zang.zung</span></code>
will be mangled using substitutions after being mangled
for the first time. The first argument type will mangle in long form,
<code class="docutils literal"><span class="pre">CC3zim4zang4zung</span></code>, and in doing so, <code class="docutils literal"><span class="pre">zim</span></code> will acquire substitution <code class="docutils literal"><span class="pre">S_</span></code>,
<code class="docutils literal"><span class="pre">zim.zang</span></code> will acquire substitution <code class="docutils literal"><span class="pre">S0_</span></code>, and <code class="docutils literal"><span class="pre">zim.zang.zung</span></code> will
acquire <code class="docutils literal"><span class="pre">S1_</span></code>. The second argument is the same as the first and will mangle
using its substitution, <code class="docutils literal"><span class="pre">S1_</span></code>. The
third argument type will mangle using the substitution for <code class="docutils literal"><span class="pre">zim</span></code>,
<code class="docutils literal"><span class="pre">CS_7zippity</span></code>. (It also acquires substitution <code class="docutils literal"><span class="pre">S2_</span></code> which would be used
if it mangled again.) The result type will mangle using the substitution for
<code class="docutils literal"><span class="pre">zim.zang</span></code>, <code class="docutils literal"><span class="pre">CS0_3zoo</span></code> (and acquire substitution <code class="docutils literal"><span class="pre">S3_</span></code>). The full
function type thus mangles as <code class="docutils literal"><span class="pre">fTCC3zim4zang4zungS1_CS_7zippity_CS0_3zoo</span></code>.</p>
<div class="highlight-swift"><div class="highlight"><pre>substitution ::= &#39;s&#39;
</pre></div>
</div>
<p>The special substitution <code class="docutils literal"><span class="pre">s</span></code> is used for the <code class="docutils literal"><span class="pre">Swift</span></code> standard library
module.</p>
</div>
<div class="section" id="predefined-substitutions">
<h3><a class="toc-backref" href="#id39">Predefined Substitutions</a><a class="headerlink" href="#predefined-substitutions" title="Permalink to this headline"></a></h3>
<div class="highlight-swift"><div class="highlight"><pre>known-module ::= &#39;s&#39;                       // Swift
known-module ::= &#39;SC&#39;                      // C
known-module ::= &#39;So&#39;                      // Objective-C
known-nominal-type ::= &#39;Sa&#39;                // Swift.Array
known-nominal-type ::= &#39;Sb&#39;                // Swift.Bool
known-nominal-type ::= &#39;Sc&#39;                // Swift.UnicodeScalar
known-nominal-type ::= &#39;Sd&#39;                // Swift.Float64
known-nominal-type ::= &#39;Sf&#39;                // Swift.Float32
known-nominal-type ::= &#39;Si&#39;                // Swift.Int
known-nominal-type ::= &#39;SP&#39;                // Swift.UnsafePointer
known-nominal-type ::= &#39;Sp&#39;                // Swift.UnsafeMutablePointer
known-nominal-type ::= &#39;SQ&#39;                // Swift.ImplicitlyUnwrappedOptional
known-nominal-type ::= &#39;Sq&#39;                // Swift.Optional
known-nominal-type ::= &#39;SR&#39;                // Swift.UnsafeBufferPointer
known-nominal-type ::= &#39;Sr&#39;                // Swift.UnsafeMutableBufferPointer
known-nominal-type ::= &#39;SS&#39;                // Swift.String
known-nominal-type ::= &#39;Su&#39;                // Swift.UInt
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&lt;known-module&gt;</span></code> and <code class="docutils literal"><span class="pre">&lt;known-nominal-type&gt;</span></code> are built-in substitutions for
certain common entities.  Like any other substitution, they all start
with &#8216;S&#8217;.</p>
<p>The Objective-C module is used as the context for mangling Objective-C
classes as <code class="docutils literal"><span class="pre">&lt;type&gt;</span></code>s.</p>
</div>
<div class="section" id="indexes">
<h3><a class="toc-backref" href="#id40">Indexes</a><a class="headerlink" href="#indexes" title="Permalink to this headline"></a></h3>
<div class="highlight-swift"><div class="highlight"><pre>index ::= &#39;_&#39;                              // 0
index ::= natural &#39;_&#39;                      // N+1
natural ::= [0-9]+
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&lt;index&gt;</span></code> is a production for encoding numbers in contexts that can&#8217;t
end in a digit; it&#8217;s optimized for encoding smaller numbers.</p>
</div>
<hr />
<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
</div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2016/06/12/dong-hua-xiang-jie/"/>
    <updated>2016-06-12T19:26:02+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2016/06/12/dong-hua-xiang-jie</id>
    <content type="html"><![CDATA[<p>
iOSCAKeyframeAnimation
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line">    <span class="c1">//</span>
</span><span class="line">    <span class="n">CAKeyframeAnimation</span> <span class="o">*</span><span class="n">positionAnimation</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAKeyframeAnimation</span> <span class="n">animation</span><span class="p">];</span>
</span><span class="line">    <span class="n">positionAnimation</span><span class="p">.</span><span class="n">keyPath</span> <span class="o">=</span> <span class="s">@&quot;position&quot;</span><span class="p">;</span>
</span><span class="line">    <span class="n">positionAnimation</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="err">@</span><span class="p">[[</span><span class="n">NSValue</span> <span class="nl">valueWithCGPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)],</span> <span class="p">[</span><span class="n">NSValue</span> <span class="nl">valueWithCGPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="o">-</span><span class="mi">110</span><span class="p">,</span> <span class="mi">73</span><span class="p">)],</span> <span class="p">[</span><span class="n">NSValue</span> <span class="nl">valueWithCGPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="o">-</span><span class="mi">167</span><span class="p">,</span> <span class="mi">116</span><span class="p">)],</span> <span class="p">[</span><span class="n">NSValue</span> <span class="nl">valueWithCGPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="o">-</span><span class="mi">189</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">133</span><span class="o">+</span><span class="mi">30</span><span class="p">)]];</span>
</span><span class="line">    <span class="n">positionAnimation</span><span class="p">.</span><span class="n">keyTimes</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span> <span class="err">@</span><span class="mi">0</span><span class="p">,</span> <span class="err">@</span><span class="p">(</span><span class="mi">11</span> <span class="o">/</span> <span class="mf">30.0</span><span class="p">),</span> <span class="err">@</span><span class="p">(</span><span class="mi">22</span> <span class="o">/</span> <span class="mf">30.0</span><span class="p">),</span> <span class="err">@</span><span class="mi">1</span><span class="p">];</span>
</span><span class="line">    <span class="n">positionAnimation</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">;</span>
</span><span class="line">    <span class="n">positionAnimation</span><span class="p">.</span><span class="n">removedOnCompletion</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class="line">    <span class="n">positionAnimation</span><span class="p">.</span><span class="n">additive</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">    <span class="n">positionAnimation</span><span class="p">.</span><span class="n">timingFunctions</span> <span class="o">=</span> <span class="err">@</span><span class="p">[[</span><span class="n">CAMediaTimingFunction</span> <span class="nl">functionWithName:</span><span class="n">kCAMediaTimingFunctionLinear</span><span class="p">],</span> <span class="p">[</span><span class="n">CAMediaTimingFunction</span> <span class="nl">functionWithName:</span><span class="n">kCAMediaTimingFunctionLinear</span><span class="p">],</span> <span class="p">[</span><span class="n">CAMediaTimingFunction</span> <span class="nl">functionWithName:</span><span class="n">kCAMediaTimingFunctionLinear</span><span class="p">],</span> <span class="p">[</span><span class="n">CAMediaTimingFunction</span> <span class="nl">functionWithName:</span><span class="n">kCAMediaTimingFunctionLinear</span><span class="p">]];</span>
</span><span class="line">
</span><span class="line">    <span class="n">positionAnimation</span><span class="p">.</span><span class="n">autoreverses</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class="line">    <span class="n">positionAnimation</span><span class="p">.</span><span class="n">calculationMode</span> <span class="o">=</span> <span class="n">kCAAnimationLinear</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">    <span class="p">[</span><span class="n">_meteroStar</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addAnimation:</span><span class="n">positionAnimation</span> <span class="nl">forKey:</span><span class="s">@&quot;PositionAnimation&quot;</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="c1">//    Alpha</span>
</span><span class="line">    <span class="n">CAKeyframeAnimation</span> <span class="o">*</span><span class="n">alphaAnimation</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAKeyframeAnimation</span> <span class="nl">animationWithKeyPath:</span><span class="s">@&quot;opacity&quot;</span><span class="p">];</span>
</span><span class="line">    <span class="n">alphaAnimation</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">;</span>
</span><span class="line">    <span class="n">alphaAnimation</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span> <span class="err">@</span><span class="mf">0.0</span><span class="p">,</span> <span class="err">@</span><span class="mf">1.0</span><span class="p">,</span> <span class="err">@</span><span class="mf">0.5</span><span class="p">,</span> <span class="err">@</span><span class="mf">0.4</span><span class="p">];</span>
</span><span class="line">    <span class="n">alphaAnimation</span><span class="p">.</span><span class="n">keyTimes</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span> <span class="err">@</span><span class="mi">0</span><span class="p">,</span> <span class="err">@</span><span class="p">(</span><span class="mi">11</span> <span class="o">/</span> <span class="mf">30.0</span><span class="p">),</span> <span class="err">@</span><span class="p">(</span><span class="mi">22</span> <span class="o">/</span> <span class="mf">30.0</span><span class="p">),</span> <span class="err">@</span><span class="mi">1</span><span class="p">];</span>
</span><span class="line">    <span class="n">alphaAnimation</span><span class="p">.</span><span class="n">autoreverses</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class="line">    <span class="n">alphaAnimation</span><span class="p">.</span><span class="n">removedOnCompletion</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class="line">    <span class="p">[</span><span class="n">_meteroStar</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addAnimation:</span><span class="n">alphaAnimation</span> <span class="nl">forKey:</span><span class="s">@&quot;alphaPositionAnimation&quot;</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="c1">// Transform</span>
</span><span class="line">    <span class="n">CAKeyframeAnimation</span> <span class="o">*</span><span class="n">animation</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAKeyframeAnimation</span> <span class="nl">animationWithKeyPath:</span><span class="s">@&quot;transform&quot;</span><span class="p">];</span>
</span><span class="line">         <span class="n">CATransform3D</span> <span class="n">scale1</span> <span class="o">=</span> <span class="n">CATransform3DMakeScale</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class="line">         <span class="n">CATransform3D</span> <span class="n">scale2</span> <span class="o">=</span> <span class="n">CATransform3DMakeScale</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class="line">         <span class="n">CATransform3D</span> <span class="n">scale3</span> <span class="o">=</span> <span class="n">CATransform3DMakeScale</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class="line">         <span class="n">CATransform3D</span> <span class="n">scale4</span> <span class="o">=</span> <span class="n">CATransform3DMakeScale</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">NSArray</span> <span class="o">*</span><span class="n">frameValues</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSArray</span> <span class="nl">arrayWithObjects:</span>
</span><span class="line">                                  <span class="p">[</span><span class="n">NSValue</span> <span class="nl">valueWithCATransform3D:</span><span class="n">scale1</span><span class="p">],</span>
</span><span class="line">                                  <span class="p">[</span><span class="n">NSValue</span> <span class="nl">valueWithCATransform3D:</span><span class="n">scale2</span><span class="p">],</span>
</span><span class="line">                                  <span class="p">[</span><span class="n">NSValue</span> <span class="nl">valueWithCATransform3D:</span><span class="n">scale3</span><span class="p">],</span>
</span><span class="line">                                  <span class="p">[</span><span class="n">NSValue</span> <span class="nl">valueWithCATransform3D:</span><span class="n">scale4</span><span class="p">],</span>
</span><span class="line">                                                               <span class="nb">nil</span><span class="p">];</span>
</span><span class="line">    <span class="p">[</span><span class="n">animation</span> <span class="nl">setValues:</span><span class="n">frameValues</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="n">animation</span><span class="p">.</span><span class="n">keyTimes</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span> <span class="err">@</span><span class="mi">0</span><span class="p">,</span> <span class="err">@</span><span class="p">(</span><span class="mi">11</span> <span class="o">/</span> <span class="mf">30.0</span><span class="p">),</span> <span class="err">@</span><span class="p">(</span><span class="mi">22</span> <span class="o">/</span> <span class="mf">30.0</span><span class="p">),</span> <span class="err">@</span><span class="mi">1</span><span class="p">];</span>
</span><span class="line">    <span class="n">animation</span><span class="p">.</span><span class="n">fillMode</span> <span class="o">=</span> <span class="n">kCAFillModeForwards</span><span class="p">;</span>
</span><span class="line">    <span class="n">animation</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class="line">    <span class="n">animation</span><span class="p">.</span><span class="n">autoreverses</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class="line">    <span class="n">animation</span><span class="p">.</span><span class="n">removedOnCompletion</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">meteroStar</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addAnimation:</span><span class="n">animation</span> <span class="nl">forKey:</span><span class="s">@&quot;PopUpAnimation&quot;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

</p>
<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[React-Native ]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2016/05/26/react-native-zi-yuan-zheng-li/"/>
    <updated>2016-05-26T16:20:13+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2016/05/26/react-native-zi-yuan-zheng-li</id>
    <content type="html"><![CDATA[<p>
React-Native
</p>

<h2 id="section"></h2>

<p><a href="http://facebook.github.io/react-native/docs/getting-started.html">react-native api</a>.</p>

<p><a href="https://github.com/jondot/awesome-react-native">Awesome React-Native</a>.</p>

<p><a href="https://github.com/ecomfe/react-native-cn">react-native api ()</a>.</p>

<p><a href="http://reactjs.cn/">react.js</a>.</p>

<p><a href="http://hulufei.gitbooks.io/react-tutorial/content/introduction.html">react.js(gitbook)</a>.</p>

<p><a href="http://www.ruanyifeng.com/blog/2015/03/react.html">react.js</a>.</p>

<p><a href="http://react.nodejs-china.org/t/reactjszhong-wen-shi-pin-jiao-cheng-bai-du-wang-pan/584">react.js</a>.</p>

<p><a href="http://html-js.com/article/2783">react-native</a>.
<!-- more -->
<a href="http://zhuanlan.zhihu.com/FrontendMagazine/19996445"> React Native JavaScript </a>.</p>

<p><a href="http://blog.cnbang.net/tech/2698/">React Native</a>.</p>

<p><a href="http://segmentfault.com/a/1190000002658374">React Native</a>.</p>

<p><a href="http://segmentfault.com/a/1190000002645929">React Native )</a>.</p>

<p><a href="http://segmentfault.com/a/1190000002647733">React Native </a>.</p>

<p><a href="http://www..cn/archives/235#6838470-tsina-1-17436-6a377b1a66595f9ede646cf5c012734c">2</a>.</p>

<p><a href="http://herman.asia/building-a-flashcard-app-with-react-native">Diary of Building an iOS App with React Native</a>.</p>

<p><a href="http://blog-en.leapoahead.com/post/use-react-native-in-existing-ios-app">Use React Native in Existing iOS App</a>.</p>

<p><a href="http://react.rocks/example/tcomb-form-native">tcomb-form-native()</a>.</p>

<h2 id="app">APP</h2>

<p>
React-Native
</p>
<p><a href="https://github.com/facebook/react-native/tree/master/Examples">App</a>.</p>

<p><a href="https://github.com/henter/ReactNativeRubyChina">ReactNativeRubyChina</a>.</p>

<p><a href="https://github.com/iSimar/HackerNews-React-Native">HackerNews-React-Native</a>.</p>

<p><a href="https://github.com/tabalt/ReactNativeNews">React-Native</a>.</p>

<p><a href="https://github.com/bradoyler/newswatch-react-native">newswatch()</a>.</p>

<p><a href="https://github.com/appintheair/react-native-buyscreen">buyscreen()</a>.</p>

<p><a href="https://github.com/samuel1112/v2er">V2EX</a>.</p>

<p><a href="https://github.com/joemaddalone/react-native-todo">react-native-todo</a>.</p>

<p><a href="https://github.com/muratsu/react-native-beer">react-native-beer</a>.</p>

<p><a href="https://github.com/86/react-native-stars">react-native-stars</a>.</p>

<p><a href="https://github.com/baofen14787/react-native-demo">app</a>.</p>

<p><a href="https://github.com/csarsam/ReactNativeChess">ReactNativeChess</a>.</p>

<p><a href="https://github.com/Johnqing/miumiu">react native </a>.</p>

<p><a href="https://github.com/ababol/react-native-pokedex">react-native-pokedex</a>.</p>

<p><a href="https://github.com/SFantasy/CNode-React-Native">CNode-React-Native</a>.</p>

<p><a href="https://github.com/voronianski/EightTracksReactNative">8tracks</a>.</p>

<p><a href="https://github.com/yoxisem544/Calculator-using-React-Native">React-Native</a>.</p>

<p><a href="https://github.com/jawee/react-native-PropertyFinder">app</a>.</p>

<p><a href="https://github.com/LeezQ/react-native-zhihu-app">app</a>.</p>

<p><a href="https://github.com/peralmq/ForeignExchangeApp">ForeignExchangeApp</a>.</p>

<p><a href="https://github.com/peralmq/ForeignExchangeApp">ForeignExchangeApp</a>.</p>

<p><a href="https://github.com/fakefish/sf-react-native">Segmentfault </a>.</p>

<p><a href="https://github.com/stormhouse/QiuShiReactNative">app</a>.</p>

<p><a href="https://github.com/Hi-Rube/baoz-ReactNative">app</a>.</p>

<p><a href="https://github.com/fraserxu/shenjs">JS app</a>.</p>

<p><a href="https://github.com/asamiller/den">Den - app</a>.</p>

<p><a href="https://github.com/soliury/noder-react-native">Noder-cnodejs</a>.</p>

<p><a href="https://github.com/race604/ZhiHuDaily-React-Native">Android</a>.</p>

<p><a href="https://github.com/sonnylazuardi/ziliun-react-native">ziliun-react-native</a>.</p>

<p><a href="https://github.com/shevawen/react-native-weather-app">react-native-weather-app</a>.</p>

<p><a href="https://github.com/taskrabbit/ReactNativeSampleApp">React Native Sample App(Navigation,Flux)</a>.</p>

<p><a href="https://github.com/qddegtya/A-ReactNative-TesterHome">TesterHomeapp</a>.</p>

<p><a href="https://github.com/7kfpun/FinanceReactNative">Finance - app</a>.</p>

<p><a href="https://github.com/bigsui/shopping-react-native">shopping - app</a>.</p>

<p><a href="https://github.com/kazaff/ZhuiYuanDemo">zhuiyuan - cms app</a></p>

<p><a href="https://github.com/just4fun/uestc-bbs-react-native">uestc-bbs-react-native - UESTCRN(with Redux)</a>.</p>

<p><a href="https://github.com/benoitvallon/react-native-nw-react-calculator">react-native-nw-react-calculator(iOS/AndroidWeb)</a>.</p>

<p><a href="https://github.com/wwayne/react-native-nba-app">react-native-nba-app</a>.</p>

<p><a href="http://git.oschina.net/rplees/react-native-gitosc">Git@OSC</a>.</p>

<p><a href="https://github.com/liuchungui/rn_bycloud">rn_bycloud app</a>.</p>

<h2 id="section-1"></h2>

<p><a href="https://github.com/Shrugs/react-native-snippets">react-native-snippets()</a>.</p>

<p><a href="https://github.com/roman01la/react-native-babel">react-native-babel(ES6+)</a>.</p>

<p><a href="https://github.com/almost/react-native-sqlite">sqlite for react-native</a>.</p>

<p><a href="https://github.com/soliury/gulp-react-native-css">gulp-react-native-css(cssReact Style)</a>.</p>

<p><a href="https://github.com/rnpm/rnpm">rnpm(React Native Package Manager)</a>.</p>

<p><a href="https://github.com/futurice/pepperoni-app-kit">Pepperoni - React Native</a>.</p>

<p><a href="https://www.decosoftware.com/">Deco IDE - React Native IDE</a>.</p>

<h2 id="section-2"></h2>

<p><a href="http://facebook.github.io/react-native/">React-native</a>.</p>

<p><a href="http://react-china.org/">React-China</a>.</p>

<p><a href="http://react.parts/">React-native</a>.</p>

<p><a href="http://reactnativemodules.com/">React Native Modules</a>.</p>

<p><a href="http://www.oschina.net/news/61214/11-react-native-ui-components">11React Native UI </a>.</p>

<hr />

<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2016/05/04/zhuan-zhi-ioskai-fa-xi-lie-jie-jue-jian-pan-zhe-dang-shi-tu/"/>
    <updated>2016-05-04T14:08:52+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2016/05/04/zhuan-zhi-ioskai-fa-xi-lie-jie-jue-jian-pan-zhe-dang-shi-tu</id>
    <content type="html"><![CDATA[<p>
</p>
<p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="n">UIView</span><span class="o">*</span><span class="p">)</span><span class="nf">keyboardView</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">NSArray</span> <span class="o">*</span> <span class="n">windows</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="n">windows</span><span class="p">];</span>
</span><span class="line">    <span class="k">for</span> <span class="p">(</span><span class="n">UIWindow</span> <span class="o">*</span> <span class="n">window</span> <span class="k">in</span> <span class="p">[</span><span class="n">windows</span> <span class="n">reverseObjectEnumerator</span><span class="p">])</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="k">for</span> <span class="p">(</span><span class="n">UIView</span> <span class="o">*</span> <span class="n">view</span> <span class="k">in</span> <span class="p">[</span><span class="n">window</span> <span class="n">subviews</span><span class="p">])</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="c1">// UIPeripheralHostView is used from iOS 4.0, UIKeyboard was used in previous versions,UIInputSetContainerView was used iOS 8.0</span>
</span><span class="line">            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">object_getClassName</span><span class="p">(</span><span class="n">view</span><span class="p">),</span> <span class="s">&quot;UIPeripheralHostView&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">object_getClassName</span><span class="p">(</span><span class="n">view</span><span class="p">),</span> <span class="s">&quot;UIKeyboard&quot;</span><span class="p">)</span> <span class="o">||</span>
</span><span class="line">                <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">object_getClassName</span><span class="p">(</span><span class="n">view</span><span class="p">),</span> <span class="s">&quot;UIInputSetContainerView&quot;</span><span class="p">))</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">                <span class="k">return</span> <span class="n">view</span><span class="p">;</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="n">UIView</span><span class="o">*</span><span class="p">)</span><span class="nf">keyboardViewForView:</span><span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nv">view</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">UIView</span> <span class="o">*</span> <span class="n">keyboardView</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">keyboardView</span><span class="p">];</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="n">keyboardView</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="n">view</span> <span class="o">=</span> <span class="n">keyboardView</span><span class="p">.</span><span class="n">superview</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">return</span> <span class="n">view</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
keyboardViewForView
</p>
<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Git Control Version]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2016/04/07/git-control-version/"/>
    <updated>2016-04-07T16:35:09+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2016/04/07/git-control-version</id>
    <content type="html"><![CDATA[<hr />

<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2016/03/23/javascriptxue-xi-zhi-ji-ben-gai-nian/"/>
    <updated>2016-03-23T15:20:45+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2016/03/23/javascriptxue-xi-zhi-ji-ben-gai-nian</id>
    <content type="html"><![CDATA[<p>

</p>

<h2></h2>
<p>
</p>

<h3></h3>
<p>
</p>

<h3></h3>
<p>
</p>
<hr />

<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[React Native]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2016/03/23/react-native/"/>
    <updated>2016-03-23T11:46:49+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2016/03/23/react-native</id>
    <content type="html"><![CDATA[<p>
React-Native <code>JavaSript</code>ReactReact-Native
</p>

<h2>Native Components</h2>
<p>
React-NativeiOS<code>UITabBar</code><code>Android</code><code>Drawer</code>APPAPPReact:<code>TabBariOS</code><code>DrawerLayoutAndroid</code>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// iOS</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react-native&#39;</span><span class="p">);</span>
</span><span class="line"><span class="kd">var</span> <span class="p">{</span> <span class="nx">TabBarIOS</span><span class="p">,</span> <span class="nx">NavigatorIOS</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">React</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">App</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
</span><span class="line">  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">(</span>
</span><span class="line">      <span class="o">&lt;</span><span class="nx">TabBarIOS</span><span class="o">&gt;</span>
</span><span class="line">        <span class="o">&lt;</span><span class="nx">TabBarIOS</span><span class="p">.</span><span class="nx">Item</span> <span class="nx">title</span><span class="o">=</span><span class="s2">&quot;React Native&quot;</span> <span class="nx">selected</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span><span class="o">&gt;</span>
</span><span class="line">          <span class="o">&lt;</span><span class="nx">NavigatorIOS</span> <span class="nx">initialRoute</span><span class="o">=</span><span class="p"></span> <span class="o">/&gt;</span>
</span><span class="line">        <span class="o">&lt;</span><span class="err">/TabBarIOS.Item&gt;</span>
</span><span class="line">      <span class="o">&lt;</span><span class="err">/TabBarIOS&gt;</span>
</span><span class="line">    <span class="p">);</span>
</span><span class="line">  <span class="p">},</span>
</span><span class="line"><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// Android</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react-native&#39;</span><span class="p">);</span>
</span><span class="line"><span class="kd">var</span> <span class="p">{</span> <span class="nx">DrawerLayoutAndroid</span><span class="p">,</span> <span class="nx">ProgressBarAndroid</span><span class="p">,</span> <span class="nx">Text</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">React</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">App</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
</span><span class="line">  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">(</span>
</span><span class="line">      <span class="o">&lt;</span><span class="nx">DrawerLayoutAndroid</span>
</span><span class="line">        <span class="nx">renderNavigationView</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">Text</span><span class="o">&gt;</span><span class="nx">React</span> <span class="nx">Native</span><span class="o">&lt;</span><span class="err">/Text&gt;}&gt;</span>
</span><span class="line">        <span class="o">&lt;</span><span class="nx">ProgressBarAndroid</span> <span class="o">/&gt;</span>
</span><span class="line">      <span class="o">&lt;</span><span class="err">/DrawerLayoutAndroid&gt;</span>
</span><span class="line">    <span class="p">);</span>
</span><span class="line">  <span class="p">},</span>
</span><span class="line"><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>

<h2></h2>
<p>
<code>Javascript</code>UIReact-Native<code>Chrome</code><code>Javascript</code>
</p>
<!-- more-->
<h2></h2>
<p>
React-Native<code>TouchableHighlight</code>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// iOS &amp; Android</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react-native&#39;</span><span class="p">);</span>
</span><span class="line"><span class="kd">var</span> <span class="p">{</span> <span class="nx">ScrollView</span><span class="p">,</span> <span class="nx">TouchableHighlight</span><span class="p">,</span> <span class="nx">Text</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">React</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">TouchDemo</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
</span><span class="line">  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">(</span>
</span><span class="line">      <span class="o">&lt;</span><span class="nx">ScrollView</span><span class="o">&gt;</span>
</span><span class="line">        <span class="o">&lt;</span><span class="nx">TouchableHighlight</span> <span class="nx">onPress</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;pressed&#39;</span><span class="p">)}</span><span class="o">&gt;</span>
</span><span class="line">          <span class="o">&lt;</span><span class="nx">Text</span><span class="o">&gt;</span><span class="nx">Proper</span> <span class="nx">Touch</span> <span class="nx">Handling</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
</span><span class="line">        <span class="o">&lt;</span><span class="err">/TouchableHighlight&gt;</span>
</span><span class="line">      <span class="o">&lt;</span><span class="err">/ScrollView&gt;</span>
</span><span class="line">    <span class="p">);</span>
</span><span class="line">  <span class="p">},</span>
</span><span class="line"><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>

<h2>Flexbox</h2>
<p>
<code>Flexbox</code>webReact-NativeFlexboxUI<code>margin</code><code>padding</code>BoxReact-Native<code>fontWeight</code><code>StyleSheet</code>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// iOS &amp; Android</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react-native&#39;</span><span class="p">);</span>
</span><span class="line"><span class="kd">var</span> <span class="p">{</span> <span class="nx">Image</span><span class="p">,</span> <span class="nx">StyleSheet</span><span class="p">,</span> <span class="nx">Text</span><span class="p">,</span> <span class="nx">View</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">React</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">ReactNative</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
</span><span class="line">  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">(</span>
</span><span class="line">      <span class="o">&lt;</span><span class="nx">View</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">row</span><span class="p">}</span><span class="o">&gt;</span>
</span><span class="line">        <span class="o">&lt;</span><span class="nx">Image</span>
</span><span class="line">          <span class="nx">source</span><span class="o">=</span><span class="p"></span>
</span><span class="line">          <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">image</span><span class="p">}</span>
</span><span class="line">        <span class="o">/&gt;</span>
</span><span class="line">        <span class="o">&lt;</span><span class="nx">View</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="o">&gt;</span>
</span><span class="line">          <span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="o">&gt;</span>
</span><span class="line">            <span class="nx">React</span> <span class="nx">Native</span>
</span><span class="line">          <span class="o">&lt;</span><span class="err">/Text&gt;</span>
</span><span class="line">          <span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">subtitle</span><span class="p">}</span><span class="o">&gt;</span>
</span><span class="line">            <span class="nx">Build</span> <span class="nx">high</span> <span class="nx">quality</span> <span class="nx">mobile</span> <span class="nx">apps</span> <span class="nx">using</span> <span class="nx">React</span>
</span><span class="line">          <span class="o">&lt;</span><span class="err">/Text&gt;</span>
</span><span class="line">        <span class="o">&lt;</span><span class="err">/View&gt;</span>
</span><span class="line">      <span class="o">&lt;</span><span class="err">/View&gt;</span>
</span><span class="line">    <span class="p">);</span>
</span><span class="line">  <span class="p">},</span>
</span><span class="line"><span class="p">});</span>
</span><span class="line"><span class="kd">var</span> <span class="nx">styles</span> <span class="o">=</span> <span class="nx">StyleSheet</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
</span><span class="line">  <span class="nx">row</span><span class="o">:</span> <span class="p">{</span> <span class="nx">flexDirection</span><span class="o">:</span> <span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="nx">margin</span><span class="o">:</span> <span class="mi">40</span> <span class="p">},</span>
</span><span class="line">  <span class="nx">image</span><span class="o">:</span> <span class="p">{</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">40</span><span class="p">,</span> <span class="nx">height</span><span class="o">:</span> <span class="mi">40</span><span class="p">,</span> <span class="nx">marginRight</span><span class="o">:</span> <span class="mi">10</span> <span class="p">},</span>
</span><span class="line">  <span class="nx">text</span><span class="o">:</span> <span class="p">{</span> <span class="nx">flex</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">justifyContent</span><span class="o">:</span> <span class="s1">&#39;center&#39;</span><span class="p">},</span>
</span><span class="line">  <span class="nx">title</span><span class="o">:</span> <span class="p">{</span> <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">11</span><span class="p">,</span> <span class="nx">fontWeight</span><span class="o">:</span> <span class="s1">&#39;bold&#39;</span> <span class="p">},</span>
</span><span class="line">  <span class="nx">subtitle</span><span class="o">:</span> <span class="p">{</span> <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">10</span> <span class="p">},</span>
</span><span class="line"><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>

<h2></h2>
<p>
React-NativeAPInpm<code>JavaSript</code>React-Native:<code>XMLHttpRequest</code>,window.requestAnimationFrame,navigator.geolocationAPI
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// iOS (Android support for geolocation coming)</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react-native&#39;</span><span class="p">);</span>
</span><span class="line"><span class="kd">var</span> <span class="p">{</span> <span class="nx">Text</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">React</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">GeoInfo</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
</span><span class="line">  <span class="nx">getInitialState</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">{</span> <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;unknown&#39;</span> <span class="p">};</span>
</span><span class="line">  <span class="p">},</span>
</span><span class="line">  <span class="nx">componentDidMount</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span>
</span><span class="line">      <span class="p">(</span><span class="nx">position</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">position</span><span class="p">}),</span>
</span><span class="line">      <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
</span><span class="line">    <span class="p">);</span>
</span><span class="line">  <span class="p">},</span>
</span><span class="line">  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">(</span>
</span><span class="line">      <span class="o">&lt;</span><span class="nx">Text</span><span class="o">&gt;</span>
</span><span class="line">        <span class="nx">Position</span><span class="o">:</span> <span class="p">{</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">position</span><span class="p">)}</span>
</span><span class="line">      <span class="o">&lt;</span><span class="err">/Text&gt;</span>
</span><span class="line">    <span class="p">);</span>
</span><span class="line">  <span class="p">},</span>
</span><span class="line"><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>

<h2></h2>
<p>
React-NativeAPPReact-Native
</p>

<h3>iOS</h3>
<p>
iOS<code>RCTBridgeModule</code>,JavaSriptRCT_EXPORT_METHODRCT_EXPORT_MODULE();
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="cp">#import &quot;RCTBridgeModule.h&quot;</span>
</span><span class="line">
</span><span class="line"><span class="k">@interface</span> <span class="nc">MyCustomModule</span> : <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">RCTBridgeModule</span><span class="o">&gt;</span>
</span><span class="line"><span class="k">@end</span>
</span><span class="line">
</span><span class="line"><span class="k">@implementation</span> <span class="nc">MyCustomModule</span>
</span><span class="line">
</span><span class="line"><span class="n">RCT_EXPORT_MODULE</span><span class="p">();</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Available as NativeModules.MyCustomModule.processString</span>
</span><span class="line">
</span><span class="line"><span class="n">RCT_EXPORT_METHOD</span><span class="p">(</span><span class="nl">processString:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span> <span class="p">)</span><span class="n">input</span> <span class="nl">callback:</span><span class="p">(</span><span class="n">RCTResponseSenderBlock</span><span class="p">)</span><span class="n">callback</span><span class="p">)</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">  <span class="n">callback</span><span class="p">(</span><span class="err">@</span><span class="p">[[</span><span class="n">input</span> <span class="nl">stringByReplacingOccurrencesOfString:</span><span class="s">@&quot;Goodbye&quot;</span> <span class="nl">withString:</span><span class="s">@&quot;Hello&quot;</span><span class="p">]]);</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react-native&#39;</span><span class="p">);</span>
</span><span class="line"><span class="kd">var</span> <span class="p">{</span> <span class="nx">NativeModules</span><span class="p">,</span> <span class="nx">Text</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">React</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">Message</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
</span><span class="line">  <span class="nx">getInitialState</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">{</span> <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;Goodbye World.&#39;</span> <span class="p">};</span>
</span><span class="line">  <span class="p">},</span>
</span><span class="line">  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">NativeModules</span><span class="p">.</span><span class="nx">MyCustomModule</span><span class="p">.</span><span class="nx">processString</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">text</span><span class="p">,</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class="line">      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">text</span><span class="p">});</span>
</span><span class="line">    <span class="p">});</span>
</span><span class="line">  <span class="p">},</span>
</span><span class="line">  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">(</span>
</span><span class="line">      <span class="o">&lt;</span><span class="nx">Text</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
</span><span class="line">    <span class="p">);</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>

<h3>iOS</h3>
<p>
iOS<code>RCTViewManager</code>,-(UIView*)view<code>RCT_EXPORT_VIEW_PROPERTY</code>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="cp">#import &quot;RCTViewManager.h&quot;</span>
</span><span class="line">
</span><span class="line"><span class="k">@interface</span> <span class="nc">MyCustomViewManager</span> : <span class="nc">RCTViewManager</span>
</span><span class="line"><span class="k">@end</span>
</span><span class="line">
</span><span class="line"><span class="k">@implementation</span> <span class="nc">MyCustomViewManager</span>
</span><span class="line">
</span><span class="line"><span class="n">RCT_EXPORT_MODULE</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="o">-</span> <span class="p">(</span><span class="n">UIView</span> <span class="o">*</span> <span class="p">)</span><span class="n">view</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">  <span class="k">return</span> <span class="p">[[</span><span class="n">MyCustomView</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">RCT_EXPORT_VIEW_PROPERTY</span><span class="p">(</span><span class="n">myCustomProperty</span><span class="p">,</span> <span class="n">NSString</span><span class="p">);</span>
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react-native&#39;</span><span class="p">);</span>
</span><span class="line"><span class="kd">var</span> <span class="p">{</span> <span class="nx">requireNativeComponent</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">React</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="kr">class</span> <span class="nx">MyCustomView</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">NativeMyCustomView</span> <span class="p">{...</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">;</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="nx">MyCustomView</span><span class="p">.</span><span class="nx">propTypes</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">myCustomProperty</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">oneOf</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]),</span>
</span><span class="line"><span class="p">};</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">NativeMyCustomView</span> <span class="o">=</span> <span class="nx">requireNativeComponent</span><span class="p">(</span><span class="s1">&#39;MyCustomView&#39;</span><span class="p">,</span> <span class="nx">MyCustomView</span><span class="p">);</span>
</span><span class="line"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">MyCustomView</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>

<h3></h3>
<p>

</p>
<p>
Android<code>ReactContextBaseJavaModule</code><code>JavaScript</code>@ReactMethod<code>ReactPackage</code>React-Native
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCustomModule</span> <span class="kd">extends</span> <span class="n">ReactContextBaseJavaModule</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Available as NativeModules.MyCustomModule.processString</span>
</span><span class="line">  <span class="nd">@ReactMethod</span>
</span><span class="line">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">processString</span><span class="o">(</span><span class="n">String</span> <span class="n">input</span><span class="o">,</span> <span class="n">Callback</span> <span class="n">callback</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="n">callback</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="s">&quot;Goodbye&quot;</span><span class="o">,</span> <span class="s">&quot;Hello&quot;</span><span class="o">));</span>
</span><span class="line">  <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react-native&#39;</span><span class="p">);</span>
</span><span class="line"><span class="kd">var</span> <span class="p">{</span> <span class="nx">NativeModules</span><span class="p">,</span> <span class="nx">Text</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">React</span><span class="p">;</span>
</span><span class="line"><span class="kd">var</span> <span class="nx">Message</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
</span><span class="line">  <span class="nx">getInitialState</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">{</span> <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;Goodbye World.&#39;</span> <span class="p">};</span>
</span><span class="line">  <span class="p">},</span>
</span><span class="line">  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">NativeModules</span><span class="p">.</span><span class="nx">MyCustomModule</span><span class="p">.</span><span class="nx">processString</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">text</span><span class="p">,</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class="line">      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">text</span><span class="p">});</span>
</span><span class="line">    <span class="p">});</span>
</span><span class="line">  <span class="p">},</span>
</span><span class="line">  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">(</span>
</span><span class="line">      <span class="o">&lt;</span><span class="nx">Text</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
</span><span class="line">    <span class="p">);</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>

<h3></h3>
<p>
<code>SimpleViewManager</code>@UIProp
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCustomViewManager</span> <span class="kd">extends</span> <span class="n">SimpleViewManager</span><span class="o">&lt;</span><span class="n">MyCustomView</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">REACT_CLASS</span> <span class="o">=</span> <span class="s">&quot;MyCustomView&quot;</span><span class="o">;</span>
</span><span class="line">
</span><span class="line">  <span class="nd">@UIProp</span><span class="o">(</span><span class="n">UIProp</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">STRING</span><span class="o">)</span>
</span><span class="line">  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PROP_MY_CUSTOM_PROPERTY</span> <span class="o">=</span> <span class="s">&quot;myCustomProperty&quot;</span><span class="o">;</span>
</span><span class="line">
</span><span class="line">  <span class="nd">@Override</span>
</span><span class="line">  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="k">return</span> <span class="n">REACT_CLASS</span><span class="o">;</span>
</span><span class="line">  <span class="o">}</span>
</span><span class="line">
</span><span class="line">  <span class="nd">@Override</span>
</span><span class="line">  <span class="kd">protected</span> <span class="n">MyCustomView</span> <span class="nf">createViewInstance</span><span class="o">(</span><span class="n">ThemedReactContext</span> <span class="n">reactContext</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="k">return</span> <span class="k">new</span> <span class="nf">MyCustomView</span><span class="o">(</span><span class="n">reactContext</span><span class="o">);</span>
</span><span class="line">  <span class="o">}</span>
</span><span class="line">
</span><span class="line">  <span class="nd">@Override</span>
</span><span class="line">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateView</span><span class="o">(</span><span class="n">MyCustomView</span> <span class="n">view</span><span class="o">,</span> <span class="n">ReactStylesDiffMap</span> <span class="n">props</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="kd">super</span><span class="o">.</span><span class="na">updateView</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="n">props</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="k">if</span> <span class="o">(</span><span class="n">props</span><span class="o">.</span><span class="na">hasKey</span><span class="o">(</span><span class="n">PROP_MY_CUSTOM_PROPERTY</span><span class="o">))</span> <span class="o">{</span>
</span><span class="line">      <span class="n">view</span><span class="o">.</span><span class="na">setMyCustomProperty</span><span class="o">(</span><span class="n">props</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">PROP_MY_CUSTOM_PROPERTY</span><span class="o">));</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">  <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;react-native&#39;</span><span class="p">);</span>
</span><span class="line"><span class="kd">var</span> <span class="p">{</span> <span class="nx">requireNativeComponent</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">React</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="kr">class</span> <span class="nx">MyCustomView</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">NativeMyCustomView</span> <span class="p">{...</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">;</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="nx">MyCustomView</span><span class="p">.</span><span class="nx">propTypes</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">myCustomProperty</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">oneOf</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]),</span>
</span><span class="line"><span class="p">};</span>
</span><span class="line">
</span><span class="line"><span class="kd">var</span> <span class="nx">NativeMyCustomView</span> <span class="o">=</span> <span class="nx">requireNativeComponent</span><span class="p">(</span><span class="s1">&#39;MyCustomView&#39;</span><span class="p">,</span> <span class="nx">MyCustomView</span><span class="p">);</span>
</span><span class="line"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">MyCustomView</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>
<hr />

<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swift]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2016/03/04/ji-lu-%5B%3F%5D-ci-xiu-gai-swiftde-cuo-wu/"/>
    <updated>2016-03-04T18:32:47+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2016/03/04/ji-lu-[?]-ci-xiu-gai-swiftde-cuo-wu</id>
    <content type="html"><![CDATA[<p><img src="http://ww3.sinaimg.cn/large/626e5d69gw1f1l040x0l2j20xe0sotgc.jpg" alt="screen-shot-0" />
<img src="http://ww1.sinaimg.cn/large/626e5d69gw1f1l04x8j0ij20wo0sqdp1.jpg" alt="screen-shot-1" />
<img src="http://ww2.sinaimg.cn/large/626e5d69gw1f1l056kc5qj20xq0t0aj0.jpg" alt="screen-shot-2" />
<img src="http://ww1.sinaimg.cn/large/626e5d69gw1f1l05da3cmj20xi0ti78x.jpg" alt="screen-shot-3" />
<img src="http://ww2.sinaimg.cn/large/626e5d69gw1f1l05jk9etj20xs0taq8a.jpg" alt="screen-shot-4" />
<img src="http://ww4.sinaimg.cn/large/626e5d69gw1f1l05oxgsfj20y00ss0zu.jpg" alt="screen-shot-5" />
<img src="http://ww1.sinaimg.cn/large/626e5d69gw1f1l05usxv8j20xw0su0y9.jpg" alt="screen-shot-6" />
<img src="http://ww3.sinaimg.cn/large/626e5d69gw1f1l060hn0sj20yc0t6474.jpg" alt="screen-shot-7" /></p>

<hr />

<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2015]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2015/12/26/2015nian-du-zong-jie/"/>
    <updated>2015-12-26T14:14:29+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2015/12/26/2015nian-du-zong-jie</id>
    <content type="html"><![CDATA[<h2 id=""><a name="summaryIntroducton"></a></h2>
<ol>
<li><a href="#summaryHistory"><strong></strong></a></li>
<li><a href="#summary-now"><strong></strong></a></li>
<li><a href="#summary-future"><strong></strong></a></li>
<li><a href="#summary-work"><strong></strong></a></li>
</ol>
<h2 id=""><a name="summaryHistory"></a></h2>
<p>
44<br />

</p>
<p>
20114155
boss2A2BLeader 722B = =|Leader
</p>
<!-- more -->
<p>
2850850Leader2DellDelliOS
</p>
<p>
2011108iOS<br />
2014
iOSiOSDellUSBwindowsDellCPUDellLeaderLeader
</p>
<p>
iPadbug

</p>
<p>
20138APP
1APPiOS84
</p>
<h2 id=""><a name="summary-now"></a></h2>
<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JSPatch]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2015/12/23/jspatchyong-fa-pou-xi/"/>
    <updated>2015-12-23T09:51:39+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2015/12/23/jspatchyong-fa-pou-xi</id>
    <content type="html"><![CDATA[<h2 id=""><a name="jspatchIntroducton"></a></h2>
<ol>
<li><a href="#jspatchIntroducton"><strong>JSPatch</strong></a></li>
<li><a href="#jspatch-wax"><strong>JSPatch VS Wax lua</strong></a></li>
<li><a href="#jspatch-core"><strong>JSPatch</strong></a></li>
<li><a href="#jspatch-Extension"><strong>JSPatch Extension</strong></a></li>
<li><a href="#jspatch-Tech"><strong>JSPatch</strong></a> </li>
<li><a href="#jspatch-problem"><strong></strong></a></li>
</ol>
<h2 id="JSPatch"><a name="jspatchIntroducton">JSPatch</a></h2>
<h3 id=""></h3>
<p>iOS: bugcrashbugAppStorebug</p>
<p>JSPatchJSPatchJavaScriptObjective-CiOS APPbug      </p>
<h3 id=""></h3>
<p>JSPatchJSBindingObjective-CruntimeAppleiOS7JavaScriptCore.frameworkJavascriptJavaScriptJavaSriptObjective-CObjective-C runtimemethod swizzlingJavaScriptObjective-CForwardInvocationJavaScriptObjective-C</p>
<!-- more -->
<h2 id="JSPatch_VS_lua_Wax"><a name="jspatch-wax">JSPatch VS lua Wax</a></h2>
<p>waxCrashluaiOSluaCAPI(ClualualualuaClua) Objective-C runtimeluaObjective-Cluaocluaoc</p>
<p>lua wax:</p>
<ol>
<li><p>wax stdLibluaC APIObjective-C runtimeluaObjective-C;</p>
</li>
<li><p>Wax EngineObjective-Clualua;</p>
</li>
<li><p>lua Compilerluawax Enginelua<br /><img src="http://ww1.sinaimg.cn/bmiddle/68e55315gw1eu0af1y3asj20dp0ec3z0.jpg" alt="Wax lua" /></p>
</li>
</ol>
<p>wax    JSPatch</p>
<ol>
<li><p>Javascriptlua JavaScript</p>
</li>
<li><p>AppleiOS Developer Program License Agreement3.3.2JavaScriptCore.frameworkWebKitJSJavaScriptCore.framework</p>
</li>
<li><p> JavaScriptCore.frameworkWaxclua</p>
</li>
<li><p>JavascriptCore.frameworkGClua wax</p>
</li>
<li><p>armv7 armv7s arm64waxarm64</p>
</li>
</ol>
<p>JSPatch:</p>
<ol>
<li><p>iOS6JSPatchiOS7JavascriptCore.framework (iOS7)</p>
</li>
<li><p>OClua wax</p>
</li>
<li><p>JSPatchwax</p>
</li>
</ol>
<h2 id="JSPatch"><a name="jspatch-core">JSPatch</a></h2>
<h3 id="startEngine">startEngine</h3>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="p">[</span><span class="n">JPEngine</span> <span class="n">startEngine</span><span class="p">];</span>
</span><span class="line"><span class="n">NSString</span> <span class="o">*</span><span class="n">sourcePath</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span> <span class="nl">pathForResource:</span><span class="s">@&quot;demo&quot;</span> <span class="nl">ofType:</span><span class="s">@&quot;js&quot;</span><span class="p">];</span>
</span><span class="line"><span class="n">NSString</span> <span class="o">*</span><span class="n">script</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithContentsOfFile:</span><span class="n">sourcePath</span> <span class="nl">encoding:</span><span class="n">NSUTF8StringEncoding</span> <span class="nl">error:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class="line"><span class="p">[</span><span class="n">JPEngine</span> <span class="nl">evaluateScript:</span><span class="n">script</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>JSPatch<code>JPEngine</code><code>startEngine</code>JSContextJSContextJSJSJSContext/JavaScriptCore.frameworkOCNSArrayNSDictionaryNSStringNSNumberNSBlock[NSNull null]JSArray/Object/String/Number/function/null</p>
<p>JavascriptCore.frameworkbridgeClassJSOC</p>
<p>JSPatchJPBoxingidClassBoxingNSDictionary(NSDictionaryJSObject)JS<a href="#jspatch-boxing"></a>JPBoxing.</p>
<p>startEngine:</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">context</span><span class="p">[</span><span class="s">@&quot;_OC_defineClass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="n">classDeclaration</span><span class="p">,</span> <span class="n">JSValue</span> <span class="o">*</span><span class="n">instanceMethods</span><span class="p">,</span> <span class="n">JSValue</span> <span class="o">*</span><span class="n">classMethods</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="k">return</span> <span class="n">defineClass</span><span class="p">(</span><span class="n">classDeclaration</span><span class="p">,</span> <span class="n">instanceMethods</span><span class="p">,</span> <span class="n">classMethods</span><span class="p">);</span>
</span><span class="line">    <span class="p">};</span>
</span><span class="line">
</span><span class="line"><span class="n">context</span><span class="p">[</span><span class="s">@&quot;_OC_callI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">^</span><span class="kt">id</span><span class="p">(</span><span class="n">JSValue</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">selectorName</span><span class="p">,</span> <span class="n">JSValue</span> <span class="o">*</span><span class="n">arguments</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="n">isSuper</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="k">return</span> <span class="n">callSelector</span><span class="p">(</span><span class="nb">nil</span><span class="p">,</span> <span class="n">selectorName</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">isSuper</span><span class="p">);</span>
</span><span class="line">    <span class="p">};</span>
</span><span class="line">
</span><span class="line"><span class="n">context</span><span class="p">[</span><span class="s">@&quot;_OC_callC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">^</span><span class="kt">id</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="n">className</span><span class="p">,</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">selectorName</span><span class="p">,</span> <span class="n">JSValue</span> <span class="o">*</span><span class="n">arguments</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="k">return</span> <span class="n">callSelector</span><span class="p">(</span><span class="n">className</span><span class="p">,</span> <span class="n">selectorName</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="nb">nil</span><span class="p">,</span> <span class="n">NO</span><span class="p">);</span>
</span><span class="line">    <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>JSOCruntime</p>
<p><code>_OC_defineClass</code><code>_OC_callI</code><code>_OC_callC</code></p>
<p>startEngineGCDconsole.logsizeofJavascript</p>
<p>JSContextJS<code>[JPEngeine evaluateScript:script]</code></p>
<h3 id="defineClass">defineClass</h3>
<p>JSPatch</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">defineClass</span><span class="p">(</span><span class="s1">&#39;JPViewController&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class="line">  <span class="nx">handleBtn</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="kd">var</span> <span class="nx">tableViewCtrl</span> <span class="o">=</span> <span class="nx">JPTableViewController</span><span class="p">.</span><span class="nx">alloc</span><span class="p">().</span><span class="nx">init</span><span class="p">()</span>
</span><span class="line">    <span class="nx">self</span><span class="p">.</span><span class="nx">navigationController</span><span class="p">().</span><span class="nx">pushViewController_animated</span><span class="p">(</span><span class="nx">tableViewCtrl</span><span class="p">,</span> <span class="nx">YES</span><span class="p">)</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">},</span> <span class="p">{})</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><code>defineClass</code></p>
<ol>
<li>:: &lt;12&gt;</li>
<li>{}</li>
<li>{}</li>
</ol>
<p>bridgingOC:</p>
<ol>
<li>NSScannerclassDeclaration<ul>
<li> : className</li>
<li> : superClassName</li>
<li> : protocalNames</li>
</ul>
</li>
<li>NSClassFromString(className)Class<ul>
<li>ClassnilJS<code>objc_allocateClassPair</code><code>objc_registerClassPair</code></li>
<li>ClassnilJS</li>
</ul>
</li>
<li>JS/<ul>
<li>class; <code>objc_getMetaClass</code></li>
<li></li>
<li><ul>
<li>protocalNames<code>objc_getProtocol</code><code>protocol_copyMethodDescriptionList</code>typenameJSselectorNametypeDescription</li>
<li>jstypeDescription@@:\@****(idJSidJS)IMPIMP</li>
</ul>
</li>
</ul>
</li>
<li><code>setProp:forKey</code><code>getProp:</code><code>objc_getAssociatedObject</code><code>objc_setAssociatedObject</code>JSproperty</li>
<li>{className:cls}JS</li>
</ol>
<h3 id="overrideMethod">overrideMethod</h3>
<p><code>overrideMethod</code><br />:</p>
<ul>
<li></li>
<li></li>
<li>JS</li>
<li></li>
<li>typeDescription</li>
</ul>
<p></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">static</span> <span class="kt">void</span> <span class="n">overrideMethod</span><span class="p">(</span><span class="n">Class</span> <span class="n">cls</span><span class="p">,</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">selectorName</span><span class="p">,</span> <span class="n">JSValue</span> <span class="o">*</span><span class="n">function</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="n">isClassMethod</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">typeDescription</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p></p>
<ol>
<li>selectorNameSelectortypeDescriptionNSMethodSignature</li>
<li>IMP<code>@&quot;ORIG&quot; + selectorName</code>IMPIMP</li>
<li>IMP<ul>
<li>structIMP<code>(IMP)_objc_msgForward_stret</code></li>
<li>IMP<code>_objc_msgForward</code></li>
</ul>
</li>
<li><code>forwardInvocation:</code>IMPselectorName@ORIGforwardInvocation:IMPIMP</li>
<li><code>JPForwardInvocation</code></li>
<li>/IMP()</li>
</ol>
<h3 id="callSelector">callSelector</h3>
<p>JSOCOC<code>callSelector</code></p>
<p></p>
<ul>
<li></li>
<li>selectorName</li>
<li>JS</li>
<li>JS</li>
<li>super</li>
</ul>
<p></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">static</span> <span class="kt">id</span> <span class="n">callSelector</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="n">className</span><span class="p">,</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">selectorName</span><span class="p">,</span> <span class="n">JSValue</span> <span class="o">*</span><span class="n">arguments</span><span class="p">,</span> <span class="n">JSValue</span> <span class="o">*</span><span class="n">instance</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="n">isSuper</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p></p>
<ol>
<li><ul>
<li>JSinstanceOC</li>
<li>selectorNameselector</li>
<li>selectorNSMethodSignatureNSInvocationinvocationtargetSelector</li>
</ul>
</li>
<li>JS(intJSNSNumber<code>[[jsObj toNumber] intValue]</code>)<code>setArgument</code>NSInvocation</li>
<li>invoke</li>
<li>getReturnValue</li>
<li>JS(JSOCOC{<strong>className:className, </strong>obj:obj})JS</li>
</ol>
<h3 id="JPForwardInvocation">JPForwardInvocation</h3>
<p>JPForwardInvocation<code>-forwardInvocation</code>JSJavascriptCore.frameWork<code>callWithArguments</code>JS</p>
<p>ForwardInvocation</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">static</span> <span class="kt">void</span> <span class="n">JPForwardInvocation</span><span class="p">(</span><span class="kt">id</span> <span class="n">slf</span><span class="p">,</span> <span class="kt">SEL</span> <span class="n">selector</span><span class="p">,</span> <span class="n">NSInvocation</span> <span class="o">*</span><span class="n">invocation</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>invocationJSValueOC_TMPInvocationArgumentsJS</p>
<p> </p>
<p>JSPatch<code>-forwardInvocation:</code><code>-ORIGforwardInvocation:</code>IMP<code>-forwardInvocation:</code>JS<code>-JPForwardInvocation:</code><code>-ORIGforwardInvocation:</code></p>
<h3 id="/"><a name="jspatch-convert"></a>/</h3>
<p>bang<a href="http://blog.cnbang.net/tech/2808/" target="_blank" rel="external"></a>/.</p>
<p>UIView.alloc() OC [UIView alloc]UIViewJSOCJSJS (UIView.alloc().init())</p>
<p>idJavaScriptCoreJSJSOCOCJSOC1 JS1OCOCJSJS<br />JSOCJSPatch</p>
<p>JSOC</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">static</span> <span class="n">NSDictionary</span> <span class="o">*</span><span class="nf">toJSObj</span><span class="p">(</span><span class="kt">id</span> <span class="n">obj</span><span class="p">)</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">obj</span><span class="p">)</span> <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class="line">    <span class="k">return</span> <span class="err">@</span><span class="p">{</span><span class="s">@&quot;__isObj&quot;</span><span class="o">:</span> <span class="err">@</span><span class="p">(</span><span class="n">YES</span><span class="p">),</span> <span class="s">@&quot;cls&quot;</span><span class="o">:</span> <span class="n">NSStringFromClass</span><span class="p">([</span><span class="n">obj</span> <span class="n">class</span><span class="p">]),</span> <span class="s">@&quot;obj&quot;</span><span class="o">:</span> <span class="n">obj</span><span class="p">};</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>__isObjOCJS JSClass </p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">_formatOCToJS</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">obj</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">__obj</span><span class="p">)</span> <span class="k">return</span> <span class="nx">obj</span>
</span><span class="line">      <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">__isNull</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span>  <span class="c1">//:JS</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class="line">      <span class="nx">obj</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_formatOCToJS</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
</span><span class="line">      <span class="p">})</span>
</span><span class="line">      <span class="k">return</span> <span class="nx">ret</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="k">instanceof</span> <span class="nb">Function</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">obj</span><span class="err"></span><span class="nx">_OC_formatJSToOC</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span>
</span><span class="line">      <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="k">instanceof</span> <span class="nb">Object</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class="line">      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="nx">ret</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_formatOCToJS</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
</span><span class="line">      <span class="p">}</span>
</span><span class="line">      <span class="k">return</span> <span class="nx">ret</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">return</span> <span class="nx">obj</span>
</span><span class="line">  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>OCview.setBackgroundColor(require(UIColor).grayColor()) UIColor OC UIColor JS JSClass OC <strong>c  .</strong>obj OC</p>
<p>/:</p>
<p><img src="http://blog.cnbang.net/wp-content/uploads/2015/06/JSPatch1.png" alt="convertpng" /></p>
<h2 id="JSPatch_Extension"><a name="jspatch-Extension">JSPatch Extension</a></h2>
<h3 id="JSPatchC_APIJS">JSPatchC APIJS</h3>
<p>JSPatchObjective-C runtimeJSBindingJSObjective-CC APIruntime<code>dlsym</code>JSCCGRectMakeCJSOCJSValueCJSContextJSC</p>
<p>CGRectMake()JSCGRectMake()JPEngineCGRectMakeJSContext</p>
<p>CGRectMakestructstructJSNSDictionary</p>
<p>ExtensionstructNSDictionary</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">+</span> <span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nf">dictOfStruct:</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">structData</span> <span class="nf">typeString:</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="nv">type</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="err"></span><span class="k">@encode</span><span class="p">(</span><span class="n">CGRect</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="n">CGRect</span> <span class="o">*</span><span class="n">rect</span> <span class="o">=</span> <span class="n">structData</span><span class="p">;</span>
</span><span class="line">        <span class="k">return</span> <span class="err">@</span><span class="p">{</span><span class="s">@&quot;x&quot;</span><span class="o">:</span> <span class="err">@</span><span class="p">(</span><span class="n">rect</span><span class="o">-&gt;</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="s">@&quot;y&quot;</span><span class="o">:</span> <span class="err">@</span><span class="p">(</span><span class="n">rect</span><span class="o">-&gt;</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="s">@&quot;width&quot;</span><span class="o">:</span> <span class="err">@</span><span class="p">(</span><span class="n">rect</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">)</span><span class="err"></span><span class="s">@&quot;height&quot;</span><span class="o">:</span> <span class="err">@</span><span class="p">(</span><span class="n">rect</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)};</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="c1">//Struct</span>
</span><span class="line">    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>startEngineCGRectMake</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">context</span><span class="p">[</span><span class="s">@&quot;CGRectMake&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">^</span><span class="kt">id</span><span class="p">(</span><span class="n">JSValue</span> <span class="o">*</span><span class="n">x</span><span class="err"></span><span class="n">JSValue</span> <span class="o">*</span><span class="n">y</span><span class="err"></span><span class="n">JSValue</span> <span class="o">*</span><span class="n">width</span><span class="err"></span><span class="n">JSValue</span> <span class="o">*</span><span class="n">height</span><span class="p">){</span>
</span><span class="line">        <span class="n">CGRect</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">([</span><span class="n">x</span> <span class="n">toDouble</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span> <span class="n">toDouble</span><span class="p">],</span> <span class="p">[</span><span class="n">width</span> <span class="n">toDouble</span><span class="p">],</span> <span class="p">[</span><span class="n">height</span> <span class="n">toDouble</span><span class="p">]);</span>
</span><span class="line">        <span class="k">return</span> <span class="p">[</span><span class="n">JPEngine</span> <span class="nl">dictOfStruct:</span><span class="o">&amp;</span><span class="n">rect</span> <span class="nl">typeString:</span><span class="k">@encode</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)];</span>
</span><span class="line">    <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>JS</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">frame</span> <span class="o">=</span> <span class="nx">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><a name="jspatch-boxing"></a><strong></strong></p>
<p>BoxingClassJS(box);JSOCCObjective-C(unbox)</p>
<p>Boxing:</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@interface</span> <span class="nc">JPBoxing</span> : <span class="nc">NSObject</span>
</span><span class="line"><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="kt">id</span> <span class="n">obj</span><span class="p">;</span>
</span><span class="line"><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="kt">void</span> <span class="o">*</span><span class="n">pointer</span><span class="p">;</span>
</span><span class="line"><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">Class</span> <span class="n">cls</span><span class="p">;</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">unbox</span><span class="p">;</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nf">unboxPointer</span><span class="p">;</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="n">Class</span><span class="p">)</span><span class="nf">unboxClass</span><span class="p">;</span>
</span><span class="line"><span class="k">@end</span>
</span><span class="line">
</span><span class="line"><span class="k">@implementation</span> <span class="nc">JPBoxing</span>
</span><span class="line">
</span><span class="line"><span class="cp">#define JPBOXING_GEN(_name, _prop, _type) \</span>
</span><span class="line"><span class="cp">+ (instancetype)_name:(_type)obj  \</span>
</span><span class="line"><span class="cp">{   \</span>
</span><span class="line"><span class="cp">    JPBoxing *boxing = [[JPBoxing alloc] init]; \</span>
</span><span class="line"><span class="cp">    boxing._prop = obj;   \</span>
</span><span class="line"><span class="cp">    return boxing;  \</span>
</span><span class="line"><span class="cp">}</span>
</span><span class="line">
</span><span class="line"><span class="n">JPBOXING_GEN</span><span class="p">(</span><span class="n">boxObj</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">id</span><span class="p">)</span>
</span><span class="line"><span class="n">JPBOXING_GEN</span><span class="p">(</span><span class="n">boxPointer</span><span class="p">,</span> <span class="n">pointer</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span>
</span><span class="line"><span class="n">JPBOXING_GEN</span><span class="p">(</span><span class="n">boxClass</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="n">Class</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">unbox</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">obj</span><span class="p">)</span> <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">obj</span><span class="p">;</span>
</span><span class="line">    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="o">-</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">unboxPointer</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">pointer</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="o">-</span> <span class="p">(</span><span class="n">Class</span><span class="p">)</span><span class="n">unboxClass</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">cls</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>unbox<code>return self</code>trick<code>formatJSToOC</code></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="kt">id</span> <span class="n">formatJSToOC</span><span class="p">(</span><span class="n">JSValue</span> <span class="o">*</span><span class="n">jsval</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>JSOCClassidJPBoxingobjnilidJPBoxingJPBoxing</p>
<p>BoxingExtensionC APIC; JS; C API<code>UIGraphicsGetCurrentContext()</code>:</p>
<p><img src="http://ww1.sinaimg.cn/mw1024/68e55315gw1eu0bbdxplrj20e5026mxg.jpg" alt="jpboxing1" /><br /><img src="http://ww4.sinaimg.cn/mw1024/68e55315gw1eu0bb95xx3j20ez0aa75n.jpg" alt="jpboxing2" /></p>
<p></p>
<p><img src="http://ww1.sinaimg.cn/mw1024/68e55315gw1eu0bb1sjvsj208w0geaa7.jpg" alt="jpboxing3" /></p>
<h3 id="JPExtesnionC_APIStruct">JPExtesnionC APIStruct</h3>
<p>JSPatchC API C API</p>
<ol>
<li></li>
<li>js</li>
<li>extensionstruct</li>
</ol>
<p>JPExtensionC APIJPExtension</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@protocol</span> <span class="nc">JPExtensionProtocol</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
</span><span class="line"><span class="k">@optional</span>
</span><span class="line"><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">main:</span><span class="p">(</span><span class="n">JSContext</span> <span class="o">*</span><span class="p">)</span><span class="n">context</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="n">size_t</span><span class="p">)</span><span class="nf">sizeOfStructWithTypeName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">typeName</span><span class="p">;</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nf">dictOfStruct:</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">structData</span> <span class="nf">typeName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">typeName</span><span class="p">;</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">structData:</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">structData</span> <span class="nf">ofDict:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">dict</span> <span class="nf">typeName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">typeName</span><span class="p">;</span>
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><code>- (void)main:(JSContext * )context</code>C APIC APIJSextensionstructJSc struct(structNSDictionary)<code>CGAffineTransform</code></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="n">size_t</span><span class="p">)</span><span class="nf">sizeOfStructWithTypeName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">typeName</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">([</span><span class="n">typeName</span> <span class="nl">rangeOfString:</span><span class="s">@&quot;CGAffineTransform&quot;</span><span class="p">].</span><span class="n">location</span> <span class="o">!=</span> <span class="n">NSNotFound</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="k">return</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">CGAffineTransform</span><span class="p">);</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nf">dictOfStruct:</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">structData</span> <span class="nf">typeName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">typeName</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">([</span><span class="n">typeName</span> <span class="nl">rangeOfString:</span><span class="s">@&quot;CGAffineTransform&quot;</span><span class="p">].</span><span class="n">location</span> <span class="o">!=</span> <span class="n">NSNotFound</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="n">CGAffineTransform</span> <span class="o">*</span><span class="n">trans</span> <span class="o">=</span> <span class="p">(</span><span class="n">CGAffineTransform</span> <span class="o">*</span><span class="p">)</span><span class="n">structData</span><span class="p">;</span>
</span><span class="line">        <span class="k">return</span> <span class="p">[</span><span class="n">JPCGTransform</span> <span class="nl">transDictOfStruct:</span><span class="n">trans</span><span class="p">];</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">structData:</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">structData</span> <span class="nf">ofDict:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">dict</span> <span class="nf">typeName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">typeName</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">([</span><span class="n">typeName</span> <span class="nl">rangeOfString:</span><span class="s">@&quot;CGAffineTransform&quot;</span><span class="p">].</span><span class="n">location</span> <span class="o">!=</span> <span class="n">NSNotFound</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="p">[</span><span class="n">JPCGTransform</span> <span class="nl">transStruct:</span><span class="n">structData</span> <span class="nl">ofDict:</span><span class="n">dict</span><span class="p">];</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>JPEngineextesnion_structExtensionJSstructJSEngine_structExtension</p>
<p>JPExtension</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">main:</span><span class="p">(</span><span class="n">JSContext</span> <span class="o">*</span><span class="p">)</span><span class="nv">context</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">NSArray</span> <span class="o">*</span><span class="n">extensionArray</span> <span class="o">=</span> <span class="err">@</span><span class="p">[[</span><span class="n">JPCGTransform</span> <span class="n">instance</span><span class="p">],</span> <span class="p">[</span><span class="n">JPCGContext</span> <span class="n">instance</span><span class="p">],</span>
</span><span class="line">                                            <span class="p">[</span><span class="n">JPCGGeometry</span> <span class="n">instance</span><span class="p">],</span> <span class="p">[</span><span class="n">JPCGBitmapContext</span> <span class="n">instance</span><span class="p">],</span>
</span><span class="line">                                            <span class="p">[</span><span class="n">JPCGColor</span> <span class="n">instance</span><span class="p">],</span> <span class="p">[</span><span class="n">JPCGImage</span> <span class="n">instance</span><span class="p">],</span> <span class="p">[</span><span class="n">JPCGPath</span> <span class="n">instance</span><span class="p">]];</span>
</span><span class="line">    <span class="p">[</span><span class="n">JPEngine</span> <span class="nl">addExtensions:</span><span class="n">extensionArray</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>JS</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="p">(</span><span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="kd">var</span> <span class="nx">extensionArr</span> <span class="o">=</span> <span class="p">[</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;JPCoreGraphics&#39;</span><span class="p">).</span><span class="nx">instance</span><span class="p">(),</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;JPUIKit&#39;</span><span class="p">).</span><span class="nx">instance</span><span class="p">()]</span>
</span><span class="line">    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;JPEngine&#39;</span><span class="p">).</span><span class="nx">addExtensions</span><span class="p">(</span><span class="nx">extensionArr</span><span class="p">)</span>
</span><span class="line"><span class="p">})()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p></p>
<h3 id="C_API">C API</h3>
<p>C APICGContextRefOCJSOCJS(JPBoxing)JPExtensionAPIOCJPBoxingJPBoxing</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nf">formatPointerJSToOC:</span><span class="p">(</span><span class="n">JSValue</span> <span class="o">*</span><span class="p">)</span><span class="nv">val</span><span class="p">;</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">formatPointerOCToJS:</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">pointer</span><span class="p">;</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">formatJSToOC:</span><span class="p">(</span><span class="n">JSValue</span> <span class="o">*</span><span class="p">)</span><span class="nv">val</span><span class="p">;</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">formatOCToJS:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">obj</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>C API:</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">context</span><span class="p">[</span><span class="s">@&quot;UIGraphicsGetCurrentContext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">^</span><span class="kt">id</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">        <span class="n">CGContextRef</span> <span class="n">c</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line">        <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nl">formatPointerOCToJS:</span><span class="n">c</span><span class="p">];</span>
</span><span class="line">    <span class="p">};</span>
</span><span class="line">
</span><span class="line"><span class="n">context</span><span class="p">[</span><span class="s">@&quot;UIGraphicsBeginImageContext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">^</span><span class="kt">void</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="n">sizeDict</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="n">CGSize</span> <span class="n">size</span><span class="p">;</span>
</span><span class="line">        <span class="p">[</span><span class="n">JPCGGeometry</span> <span class="nl">sizeStruct:</span><span class="o">&amp;</span><span class="n">size</span> <span class="nl">ofDict:</span><span class="n">sizeDict</span><span class="p">];</span>
</span><span class="line">        <span class="n">UIGraphicsBeginImageContext</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</span><span class="line">    <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><code>UIGraphicsGetCurrentContext()</code>CGContextRefAPIidCGContextRefJPBoxing<code>UIGraphicsBeginImageContext()</code>CGSizeJS<code>{x:100, y:100}</code>Javascript objectobjectOCNSDictionary.</p>
<p>C APIJavascriptCore.Framework(NSArrayNSDictionaryNSStringNSNumberNSBlock)<code>formatOCToJS:</code>NSArrayNSDictionaryNSStringJavascriptCoreJSArrayObjectStringOCJS<code>formatOCToJS:</code></p>
<h3 id="JSPatch&amp;">JSPatch&amp;</h3>
<p>CJavascript<code>&amp;</code>JavascriptCOC:</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="p">......</span>
</span><span class="line"><span class="n">NSString</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="s">@&quot;littleliang&quot;</span><span class="p">;</span>
</span><span class="line"><span class="p">[</span><span class="n">invocation</span> <span class="nl">setArgument:</span><span class="o">&amp;</span><span class="n">str</span> <span class="nl">atIndex:</span><span class="mi">2</span><span class="p">];</span>
</span><span class="line"><span class="p">......</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>JPMemoryc<code>malloc</code><code>memset</code><code>free</code><code>memcpy</code><code>memncpy</code><code>memmove</code></p>
<p><code>&amp;</code>JPMemoryJS<code>getpointer</code></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="p">......</span>
</span><span class="line"><span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;NSString&#39;</span><span class="p">).</span><span class="nx">stringWithString</span><span class="p">(</span><span class="s1">&#39;littleliang&#39;</span><span class="p">)</span>
</span><span class="line"><span class="nx">invocation</span><span class="p">.</span><span class="nx">setArgument_atIndex</span><span class="p">(</span><span class="nx">getpointer</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span><span class="err"></span><span class="mi">2</span><span class="p">)</span>
</span><span class="line"><span class="p">......</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>getpointer:</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nf">getPointerFromJS:</span><span class="p">(</span><span class="n">JSValue</span> <span class="o">*</span><span class="p">)</span><span class="nv">val</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="kt">void</span> <span class="o">**</span><span class="n">p</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">));</span>
</span><span class="line">    <span class="k">if</span> <span class="p">([[</span><span class="n">val</span> <span class="n">toObject</span><span class="p">]</span> <span class="nl">isKindOfClass:</span><span class="p">[</span><span class="n">NSDictionary</span> <span class="n">class</span><span class="p">]])</span> <span class="p">{</span>
</span><span class="line">        <span class="k">if</span> <span class="p">([[</span><span class="n">val</span> <span class="n">toObject</span><span class="p">][</span><span class="s">@&quot;__obj&quot;</span><span class="p">]</span> <span class="nl">isKindOfClass:</span><span class="p">[</span><span class="n">JPBoxing</span> <span class="n">class</span><span class="p">]])</span> <span class="p">{</span>
</span><span class="line">            <span class="kt">void</span> <span class="o">*</span><span class="n">pointer</span> <span class="o">=</span> <span class="p">[(</span><span class="n">JPBoxing</span> <span class="o">*</span><span class="p">)[</span><span class="n">val</span> <span class="n">toObject</span><span class="p">][</span><span class="s">@&quot;__obj&quot;</span><span class="p">]</span> <span class="n">unboxPointer</span><span class="p">];</span>
</span><span class="line">            <span class="k">if</span> <span class="p">(</span><span class="n">pointer</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">                <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">pointer</span><span class="p">;</span>
</span><span class="line">            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class="line">                <span class="kt">id</span> <span class="n">jpobj</span> <span class="o">=</span> <span class="p">[(</span><span class="n">JPBoxing</span> <span class="o">*</span><span class="p">)[</span><span class="n">val</span> <span class="n">toObject</span><span class="p">][</span><span class="s">@&quot;__obj&quot;</span><span class="p">]</span> <span class="n">unbox</span><span class="p">];</span>
</span><span class="line">                <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">__bridge</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">jpobj</span><span class="p">;</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">        <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class="line">            <span class="kt">id</span> <span class="n">obj</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="n">toObject</span><span class="p">][</span><span class="s">@&quot;__obj&quot;</span><span class="p">];</span>
</span><span class="line">            <span class="o">*</span><span class="n">p</span>     <span class="o">=</span> <span class="p">(</span><span class="n">__bridge</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">obj</span><span class="p">;</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">        <span class="k">return</span> <span class="n">p</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class="line">        <span class="n">NSAssert</span><span class="p">(</span><span class="n">NO</span><span class="p">,</span> <span class="s">@&quot;getpointer only support pointer and id type!&quot;</span><span class="p">);</span>
</span><span class="line">        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>JPMemorypvalpvalWithXXXXXX</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">context</span><span class="p">[</span><span class="s">@&quot;pval&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="o">^</span><span class="kt">id</span><span class="p">(</span><span class="n">JSValue</span> <span class="o">*</span><span class="n">jsVal</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="kt">void</span> <span class="o">*</span><span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">formatPointerJSToOC:</span><span class="n">jsVal</span><span class="p">];</span>
</span><span class="line">        <span class="kt">id</span> <span class="n">obj</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">__unsafe_unretained</span> <span class="kt">id</span> <span class="o">*</span><span class="p">)</span><span class="n">m</span><span class="p">);</span>
</span><span class="line">        <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nl">formatOCToJS:</span><span class="n">obj</span><span class="p">];</span>
</span><span class="line">    <span class="p">};</span>
</span><span class="line">
</span><span class="line"><span class="n">context</span><span class="p">[</span><span class="s">@&quot;pvalWithBool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">^</span><span class="kt">id</span><span class="p">(</span><span class="n">JSValue</span> <span class="o">*</span><span class="n">jsVal</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="kt">void</span> <span class="o">*</span><span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">formatPointerJSToOC:</span><span class="n">jsVal</span><span class="p">];</span>
</span><span class="line">        <span class="kt">BOOL</span> <span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">BOOL</span> <span class="o">*</span><span class="p">)</span><span class="n">m</span><span class="p">);</span>
</span><span class="line">        <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nl">formatOCToJS:</span><span class="p">[</span><span class="n">NSNumber</span> <span class="nl">numberWithBool:</span><span class="n">b</span><span class="p">]];</span>
</span><span class="line">    <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<h3 id="include">include</h3>
<p>JSPatchJSincludeJSJS</p>
<p>:</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="p">(</span><span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="kd">var</span> <span class="nx">extensionArr</span> <span class="o">=</span> <span class="p">[</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;JPInclude&#39;</span><span class="p">).</span><span class="nx">instance</span><span class="p">()]</span>
</span><span class="line">    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;JPEngine&#39;</span><span class="p">).</span><span class="nx">addExtensions</span><span class="p">(</span><span class="nx">extensionArr</span><span class="p">)</span>
</span><span class="line">    <span class="nx">include</span><span class="p">(</span><span class="s1">&#39;another.js&#39;</span><span class="p">)</span>
</span><span class="line"><span class="p">})()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>includeOC01</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="p">(</span><span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">include</span><span class="p">(</span><span class="s1">&#39;thridparty.js&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class="line"><span class="p">})()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<h2 id="JSPatch"><a name="jspatch-Tech">JSPatch</a></h2>
<h3 id="GCD">GCD</h3>
<p>JSPatchJSContextGCDJSGCD</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">__weak</span> <span class="n">JSContext</span> <span class="o">*</span><span class="n">weakCtx</span> <span class="o">=</span> <span class="n">context</span><span class="p">;</span>
</span><span class="line">  <span class="n">context</span><span class="p">[</span><span class="s">@&quot;dispatch_after&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="kt">double</span> <span class="n">time</span><span class="p">,</span> <span class="n">JSValue</span> <span class="o">*</span><span class="n">func</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="n">JSValue</span> <span class="o">*</span><span class="n">currSelf</span> <span class="o">=</span> <span class="n">weakCtx</span><span class="p">[</span><span class="s">@&quot;self&quot;</span><span class="p">];</span>
</span><span class="line">      <span class="n">dispatch_after</span><span class="p">(</span><span class="n">dispatch_time</span><span class="p">(</span><span class="n">DISPATCH_TIME_NOW</span><span class="p">,</span> <span class="p">(</span><span class="n">int64_t</span><span class="p">)(</span><span class="n">time</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">)),</span> <span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class="line">          <span class="n">JSValue</span> <span class="o">*</span><span class="n">prevSelf</span> <span class="o">=</span> <span class="n">weakCtx</span><span class="p">[</span><span class="s">@&quot;self&quot;</span><span class="p">];</span>
</span><span class="line">          <span class="n">weakCtx</span><span class="p">[</span><span class="s">@&quot;self&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">currSelf</span><span class="p">;</span>
</span><span class="line">          <span class="p">[</span><span class="n">func</span> <span class="nl">callWithArguments:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class="line">          <span class="n">weakCtx</span><span class="p">[</span><span class="s">@&quot;self&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prevSelf</span><span class="p">;</span>
</span><span class="line">      <span class="p">});</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line">  <span class="n">context</span><span class="p">[</span><span class="s">@&quot;dispatch_async_main&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">JSValue</span> <span class="o">*</span><span class="n">func</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="n">JSValue</span> <span class="o">*</span><span class="n">currSelf</span> <span class="o">=</span> <span class="n">weakCtx</span><span class="p">[</span><span class="s">@&quot;self&quot;</span><span class="p">];</span>
</span><span class="line">      <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class="line">          <span class="n">JSValue</span> <span class="o">*</span><span class="n">prevSelf</span> <span class="o">=</span> <span class="n">weakCtx</span><span class="p">[</span><span class="s">@&quot;self&quot;</span><span class="p">];</span>
</span><span class="line">          <span class="n">weakCtx</span><span class="p">[</span><span class="s">@&quot;self&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">currSelf</span><span class="p">;</span>
</span><span class="line">          <span class="p">[</span><span class="n">func</span> <span class="nl">callWithArguments:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class="line">          <span class="n">weakCtx</span><span class="p">[</span><span class="s">@&quot;self&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prevSelf</span><span class="p">;</span>
</span><span class="line">      <span class="p">});</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line">  <span class="n">context</span><span class="p">[</span><span class="s">@&quot;dispatch_sync_main&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">JSValue</span> <span class="o">*</span><span class="n">func</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="k">if</span> <span class="p">([</span><span class="n">NSThread</span> <span class="n">currentThread</span><span class="p">].</span><span class="n">isMainThread</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">          <span class="p">[</span><span class="n">func</span> <span class="nl">callWithArguments:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class="line">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class="line">          <span class="n">dispatch_sync</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class="line">              <span class="p">[</span><span class="n">func</span> <span class="nl">callWithArguments:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class="line">          <span class="p">});</span>
</span><span class="line">      <span class="p">}</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line">  <span class="n">context</span><span class="p">[</span><span class="s">@&quot;dispatch_async_global_queue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">JSValue</span> <span class="o">*</span><span class="n">func</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="n">JSValue</span> <span class="o">*</span><span class="n">currSelf</span> <span class="o">=</span> <span class="n">weakCtx</span><span class="p">[</span><span class="s">@&quot;self&quot;</span><span class="p">];</span>
</span><span class="line">      <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">^</span><span class="p">{</span>
</span><span class="line">          <span class="n">JSValue</span> <span class="o">*</span><span class="n">prevSelf</span> <span class="o">=</span> <span class="n">weakCtx</span><span class="p">[</span><span class="s">@&quot;self&quot;</span><span class="p">];</span>
</span><span class="line">          <span class="n">weakCtx</span><span class="p">[</span><span class="s">@&quot;self&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">currSelf</span><span class="p">;</span>
</span><span class="line">          <span class="p">[</span><span class="n">func</span> <span class="nl">callWithArguments:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class="line">          <span class="n">weakCtx</span><span class="p">[</span><span class="s">@&quot;self&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prevSelf</span><span class="p">;</span>
</span><span class="line">      <span class="p">});</span>
</span><span class="line">  <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p></p>
<ol>
<li><p>blockcontext__weakJavascriptCore.frameworkapi<br /><code>[JSContext currentContext]</code></p>
</li>
<li><p>JSContext<code>callWithArguments:</code>JSContext<code>self</code>JS<code>self</code>nil</p>
</li>
<li><p><code>dispatch_sync_main</code>block</p>
</li>
</ol>
<h3 id="JS">JS</h3>
<p>JSOCJavaScriptCore.framworkexceptionHandler</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">context</span><span class="p">.</span><span class="n">exceptionHandler</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">JSContext</span> <span class="o">*</span><span class="n">con</span><span class="p">,</span> <span class="n">JSValue</span> <span class="o">*</span><span class="n">exception</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@&quot;</span><span class="p">,</span> <span class="n">exception</span><span class="p">);</span>
</span><span class="line">        <span class="n">NSAssert</span><span class="p">(</span><span class="n">NO</span><span class="p">,</span> <span class="s">@&quot;js exception: %@&quot;</span><span class="p">,</span> <span class="n">exception</span><span class="p">);</span>
</span><span class="line">    <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<h3 id="#pragmawarning">#pragmawarning</h3>
<p>#pargamawarning<a href="http://nshipster.cn/clang-diagnostics/" target="_ blank" rel="external">Matt Thomsonclang diagnostics</a><a href="http://fuckingclangwarnings.com/" target="_ blank" rel="external"></a>warning</p>
<h3 id="IMP">IMP</h3>
<p>IMP</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="cp">#define JPMETHOD_IMPLEMENTATION(_type, _typeString, _typeSelector) \</span>
</span><span class="line"><span class="cp">    JPMETHOD_IMPLEMENTATION_RET(_type, _typeString, return [[ret toObject] _typeSelector]) \</span>
</span><span class="line">
</span><span class="line"><span class="cp">#define JPMETHOD_IMPLEMENTATION_RET(_type, _typeString, _ret) \</span>
</span><span class="line"><span class="cp">static _type JPMETHOD_IMPLEMENTATION_NAME(_typeString) (id slf, SEL selector) {    \</span>
</span><span class="line"><span class="cp">    JSValue *fun = getJSFunctionInObjectHierachy(slf, selector);    \</span>
</span><span class="line"><span class="cp">    JSValue *ret = [fun callWithArguments:_TMPInvocationArguments];  \</span>
</span><span class="line"><span class="cp">    _ret;    \</span>
</span><span class="line"><span class="cp">}   \</span>
</span><span class="line">
</span><span class="line"><span class="cp">#define JPMETHOD_IMPLEMENTATION_NAME(_typeString) JPMethodImplement_##_typeString</span>
</span><span class="line">
</span><span class="line"><span class="cp">#pragma clang diagnostic push</span>
</span><span class="line"><span class="cp">#pragma clang diagnostic ignored &quot;-Wunused-variable&quot;</span>
</span><span class="line">
</span><span class="line"><span class="cp">#define JPMETHOD_RET_ID \</span>
</span><span class="line"><span class="cp">    id obj = formatJSToOC(ret); \</span>
</span><span class="line"><span class="cp">    if ([obj isKindOfClass:[NSNull class]]) return nil;  \</span>
</span><span class="line"><span class="cp">    return obj;</span>
</span><span class="line">
</span><span class="line"><span class="cp">#define JPMETHOD_RET_STRUCT(_methodName)    \</span>
</span><span class="line"><span class="cp">    id dict = formatJSToOC(ret);   \</span>
</span><span class="line"><span class="cp">    return _methodName(dict);</span>
</span><span class="line">
</span><span class="line"><span class="n">JPMETHOD_IMPLEMENTATION_RET</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="nb">nil</span><span class="p">)</span>
</span><span class="line"><span class="n">JPMETHOD_IMPLEMENTATION_RET</span><span class="p">(</span><span class="kt">id</span><span class="p">,</span> <span class="kt">id</span><span class="p">,</span> <span class="n">JPMETHOD_RET_ID</span><span class="p">)</span>
</span><span class="line"><span class="n">JPMETHOD_IMPLEMENTATION_RET</span><span class="p">(</span><span class="n">CGRect</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">JPMETHOD_RET_STRUCT</span><span class="p">(</span><span class="n">dictToRect</span><span class="p">))</span>
</span><span class="line"><span class="n">JPMETHOD_IMPLEMENTATION_RET</span><span class="p">(</span><span class="n">CGSize</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">JPMETHOD_RET_STRUCT</span><span class="p">(</span><span class="n">dictToSize</span><span class="p">))</span>
</span><span class="line"><span class="n">JPMETHOD_IMPLEMENTATION_RET</span><span class="p">(</span><span class="n">CGPoint</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">JPMETHOD_RET_STRUCT</span><span class="p">(</span><span class="n">dictToPoint</span><span class="p">))</span>
</span><span class="line"><span class="n">JPMETHOD_IMPLEMENTATION_RET</span><span class="p">(</span><span class="n">NSRange</span><span class="p">,</span> <span class="n">range</span><span class="p">,</span> <span class="n">JPMETHOD_RET_STRUCT</span><span class="p">(</span><span class="n">dictToRange</span><span class="p">))</span>
</span><span class="line"><span class="p">......</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<h2 id=""><a name="jspatch-problem"></a></h2>
<p>JSPatch</p>
<h3 id="1-_JSPatchUIWebViewHTML">1. JSPatchUIWebViewHTML</h3>
<p>JSPatch<a href="https://github.com/bang590/JSPatch/issues/61" target="_blank" rel="external">issue</a>JSPatchUIWebViewURLloadRequestHTML<br /><img src="https://cloud.githubusercontent.com/assets/7334742/8666691/731b0354-2a27-11e5-95cc-90df45fac11f.png" alt="" /><br />JSContextUIWebView<a href="http://stackoverflow.com/questions/28638293/creating-a-uiwebview-from-a-jscontext-block-prevents-assets-from-loading-on-ios8" target="_blank" rel="external"></a></p>
<p><code>UIWebView</code><code>JSContext</code>JSPatch<code>JSContext</code><code>UIWebView</code>JSContext</p>
<p><strong>:</strong></p>
<p>1JSPatch<code>UIWebView</code><code>init</code></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span> <span class="p">{</span>
</span><span class="line">    <span class="n">UIWebView</span> <span class="o">*</span><span class="n">view</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIWebView</span> <span class="n">alloc</span><span class="p">]</span><span class="n">init</span><span class="p">];</span>   <span class="c1">//Useless. Just to load the UIWebview framework.</span>
</span><span class="line">    <span class="n">view</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectZero</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">    <span class="p">[</span><span class="n">JPEngine</span> <span class="n">startEngine</span><span class="p">];</span>
</span><span class="line">   <span class="c1">//.......</span>
</span><span class="line">
</span><span class="line">    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>2JSPatchUIWebViewJSContext</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">defineClass</span><span class="p">(</span><span class="s1">&#39;UIWebView&#39;</span><span class="p">,{</span>
</span><span class="line">	 <span class="nx">loadRequest</span> <span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">){</span>
</span><span class="line">	 	<span class="nx">self</span><span class="p">.</span><span class="nx">valueForKeyPath</span><span class="p">(</span><span class="s2">&quot;documentView.webView.mainFrame.javaScriptContext&quot;</span><span class="p">)</span>  		
</span><span class="line">	 	<span class="nx">self</span><span class="p">.</span><span class="nx">ORIGloadRequest</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span>
</span><span class="line"> <span class="p">}</span>
</span><span class="line"><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<h3 id="2-_id_*">2. id * </h3>
<p>JS:</p>
<ol>
<li><code>JPMemoery</code>Extension<code>malloc</code><code>getpointer</code></li>
<li><code>pval</code></li>
</ol>
<p>NSInvocation<code>- (void)getReturnValue:(void * )retLoc</code><code>- (void)setArgument:(void * )argumentLocation atIndex:(NSInteger)idx;</code>C API</p>
<p>NSString<code>- (BOOL)writeToFile:(NSString * )path atomically:(BOOL)useAuxiliaryFile encoding:(NSStringEncoding)enc error:(NSError * * )error</code>NSErrorJS</p>
<p>NSError <em>* NSError \</em>&#8211;__ autoreleasing*autoreleasing- poolJSContext</p>
<p><strong></strong></p>
<p>id * (<code>callSelector</code><code>[invocation inoke]</code>)JSNSDictonry(key)JS(remove):</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">case</span> <span class="sc">&#39;^&#39;</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">                <span class="k">if</span> <span class="p">([</span><span class="n">valObj</span> <span class="nl">isKindOfClass:</span><span class="p">[</span><span class="n">JPBoxing</span> <span class="n">class</span><span class="p">]])</span> <span class="p">{</span>
</span><span class="line">                    <span class="kt">void</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="p">[((</span><span class="n">JPBoxing</span> <span class="o">*</span><span class="p">)</span><span class="n">valObj</span><span class="p">)</span> <span class="n">unboxPointer</span><span class="p">];</span>
</span><span class="line">                    <span class="k">if</span> <span class="p">(</span><span class="n">argumentType</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;@&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">                        <span class="n">memset</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">id</span><span class="p">));</span>
</span><span class="line">                        <span class="p">[</span><span class="n">_markArray</span> <span class="nl">addObject:</span><span class="n">valObj</span><span class="p">];</span>
</span><span class="line">                    <span class="p">}</span>
</span><span class="line">                    <span class="p">[</span><span class="n">invocation</span> <span class="nl">setArgument:</span><span class="o">&amp;</span><span class="n">value</span> <span class="nl">atIndex:</span><span class="n">i</span><span class="p">];</span>
</span><span class="line">                    <span class="k">break</span><span class="p">;</span>
</span><span class="line">                <span class="p">}</span>
</span><span class="line">            <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>idJPBoxing_markArray</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="c1">//...</span>
</span><span class="line"><span class="p">[</span><span class="n">invocation</span> <span class="n">invoke</span><span class="p">];</span>
</span><span class="line">    <span class="k">if</span> <span class="p">([</span><span class="n">_markArray</span> <span class="n">count</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="k">for</span> <span class="p">(</span><span class="n">JPBoxing</span> <span class="o">*</span><span class="n">box</span> <span class="k">in</span> <span class="n">_markArray</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">            <span class="kt">void</span> <span class="o">*</span><span class="n">pointer</span> <span class="o">=</span> <span class="p">[</span><span class="n">box</span> <span class="n">unboxPointer</span><span class="p">];</span>
</span><span class="line">            <span class="kt">id</span> <span class="n">obj</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">__unsafe_unretained</span> <span class="kt">id</span> <span class="o">*</span><span class="p">)</span><span class="n">pointer</span><span class="p">);</span>
</span><span class="line">            <span class="k">if</span> <span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">                <span class="k">@synchronized</span><span class="p">(</span><span class="n">_TMPMemoryPool</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">                    <span class="p">[</span><span class="n">_TMPMemoryPool</span> <span class="nl">setObject:</span><span class="n">obj</span> <span class="nl">forKey:</span><span class="p">[</span><span class="n">NSNumber</span> <span class="nl">numberWithInteger:</span><span class="p">[</span><span class="n">obj</span> <span class="n">hash</span><span class="p">]]];</span>
</span><span class="line">                <span class="p">}</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>_markArrayJPBoxingkeyhashCode</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">context</span><span class="p">[</span><span class="s">@&quot;releaseTmpObj&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">^</span><span class="kt">void</span><span class="p">(</span><span class="n">JSValue</span> <span class="o">*</span><span class="n">jsVal</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="k">if</span> <span class="p">([[</span><span class="n">jsVal</span> <span class="n">toObject</span><span class="p">]</span> <span class="nl">isKindOfClass:</span><span class="p">[</span><span class="n">NSDictionary</span> <span class="n">class</span><span class="p">]])</span> <span class="p">{</span>
</span><span class="line">            <span class="kt">void</span> <span class="o">*</span><span class="n">pointer</span> <span class="o">=</span>  <span class="p">[(</span><span class="n">JPBoxing</span> <span class="o">*</span><span class="p">)([</span><span class="n">jsVal</span> <span class="n">toObject</span><span class="p">][</span><span class="s">@&quot;__obj&quot;</span><span class="p">])</span> <span class="n">unboxPointer</span><span class="p">];</span>
</span><span class="line">            <span class="kt">id</span> <span class="n">obj</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">__unsafe_unretained</span> <span class="kt">id</span> <span class="o">*</span><span class="p">)</span><span class="n">pointer</span><span class="p">);</span>
</span><span class="line">            <span class="k">@synchronized</span><span class="p">(</span><span class="n">_TMPMemoryPool</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">                <span class="p">[</span><span class="n">_TMPMemoryPool</span> <span class="nl">removeObjectForKey:</span><span class="p">[</span><span class="n">NSNumber</span> <span class="nl">numberWithInteger:</span><span class="p">[</span><span class="n">obj</span> <span class="n">hash</span><span class="p">]]];</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>JSPatch<code>releaseTmpObj</code></p>
<h2 id=""><a name="conclusion"></a></h2>
<p>JSPatch</p>
<p>1 C APIClassJSC APIJPBoxing{__ className:JPBoxing__ obj:[JPBoxing boxPointer:pointer]}JS__obj</p>
<p>2 includejs</p>
<p>3 sizeofJSExtensionJPExtension<code>- (size_t)sizeOfStructWithTypeName:(NSString * )typeName</code>JS:<code>sizeof(&#39;CGRect&#39;)</code>strutJPMemorymallocC API</p>
<p>4 JPMemoryJavascriptJPMemoryJSPatch</p>
<p>5 __autoreleasingJSJSNSDictonry(key)JS(remove)</p>
<h4 id=""><strong></strong></h4>
<p>1 JS<a href="https://github.com/bang590/JSPatch/commit/3c9a10cd86fc13f7e0909bb3a2a93bba286aa1c9" target="_ blank" rel="external">nil</a>JavaScriptnilundefinednullJavascriptCore.frameworkjsnullOC[NSNull null][NSNull null]nil[NSNull null]JSnsnull[NSNull null]nsnull</p>
<p>2 JSPatchstruct<a href="https://github.com/bang590/JSPatch/commit/6df89bec6c8f4217500be316832fecbd898d1b46" target="_ blank" rel="external"></a>bang@encode()CJSextension<code>- (size_t)sizeOfStructWithTypeEncode:(NSString * )typeName</code>@encode:<code>{CGPoint=dd}</code></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">typeEncode</span> <span class="nl">rangeOfString:</span><span class="s">@&quot;CGPoint&quot;</span><span class="p">].</span><span class="n">location</span> <span class="o">!=</span> <span class="n">NSNotFound</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>CGPointCGRectCGRect@encode<code>{CGRect={CGPoint=dd}{CGSize=dd}}</code>bang</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="p">[</span><span class="n">typeEncode</span> <span class="nl">rangeOfString:</span><span class="s">@&quot;CGPoint&quot;</span><span class="p">].</span><span class="n">location</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>sizeof@encode(NSRange)<code>{_NSRange=QQ}</code>location==1<a href="https://github.com/bang590/JSPatch/blob/6df89bec6c8f4217500be316832fecbd898d1b46/JSPatch/JPEngine.m#L1003" target="_ blank" rel="external">typeEncodeStruct</a></p>
<p>3 JSPatchExtension<a href="https://github.com/bang590/JSPatch/commit/c20e2910ee8e73e3ae22db071a43072c9e6ca149" target="_ blank" rel="external"></a></p>
<p>: <a href="https://github.com/bang590/JSPatch/graphs/contributors" target="_ blank" rel="external">1916++ / 348</a>  <a href="https://github.com/bang590/JSPatch/commits/master" target="_ blank" rel="external">commit log</a></p>
<h4 id=""></h4>
<p>JSPatchhot fixAPI</p>
<p></p>
<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swift]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2015/12/16/bian-xie-gao-zhi-liang-de-swiftdai-ma/"/>
    <updated>2015-12-16T20:00:26+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2015/12/16/bian-xie-gao-zhi-liang-de-swiftdai-ma</id>
    <content type="html"><![CDATA[<p>
 Swift 

 Swift  
</p>
<h2></h2>
<p>Swift <br />
<ul>
<li>-Onone: </li>
<li>-O: </li>
<li>-Ounchecked: </li>
<!-- more -->
</ul>
 Xcode UI 
</p>
<h2></h2>
<p>SwiftXcodeSwiftflag-whole-module-optimization<br />
Xcode<code>Whole Module Optimization</code>
</p>
<h2></h2>
<p>
SwiftObjective-CObjective-CSwift
</p>
<h2></h2>
<p>
a.aPropertya.doSomething()  a.doSomethingElse() 
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">class</span> <span class="n">A</span> <span class="p">{</span>
</span><span class="line">  <span class="n">var</span> <span class="nl">aProperty:</span> <span class="p">[</span><span class="n">Int</span><span class="p">]</span>
</span><span class="line">  <span class="n">func</span> <span class="n">doSomething</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class="line">  <span class="n">dynamic</span> <span class="n">doSomethingElse</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">class</span> <span class="n">B</span> <span class="o">:</span> <span class="n">A</span> <span class="p">{</span>
</span><span class="line">  <span class="n">override</span> <span class="n">var</span> <span class="n">aProperty</span> <span class="p">{</span>
</span><span class="line">    <span class="n">get</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class="line">    <span class="n">set</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line">
</span><span class="line">  <span class="n">override</span> <span class="n">func</span> <span class="n">doSomething</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">func</span> <span class="n">usingAnA</span><span class="p">(</span><span class="nl">a:</span> <span class="n">A</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">  <span class="n">a</span><span class="p">.</span><span class="n">doSomething</span><span class="p">()</span>
</span><span class="line">  <span class="n">a</span><span class="p">.</span><span class="n">aProperty</span> <span class="o">=</span> <span class="p">...</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<br />
Swift vtabledynamicSwiftObjective-C
</p>
<h4><code>final</code></h4>
<p>
final
 C.array1  D.array1 D.array2 
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">final</span> <span class="n">class</span> <span class="n">C</span> <span class="p">{</span>
</span><span class="line">  <span class="c1">// No declarations in class &#39;C&#39; can be overridden.</span>
</span><span class="line">  <span class="n">var</span> <span class="nl">array1:</span> <span class="p">[</span><span class="n">Int</span><span class="p">]</span>
</span><span class="line">  <span class="n">func</span> <span class="n">doSomething</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">class</span> <span class="n">D</span> <span class="p">{</span>
</span><span class="line">  <span class="n">final</span> <span class="n">var</span> <span class="n">array1</span> <span class="p">[</span><span class="n">Int</span><span class="p">]</span> <span class="c1">// &#39;array1&#39; cannot be overridden by a computed property.</span>
</span><span class="line">  <span class="n">var</span> <span class="nl">array2:</span> <span class="p">[</span><span class="n">Int</span><span class="p">]</span>      <span class="c1">// &#39;array2&#39; *can* be overridden by a computed property.</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">func</span> <span class="n">usingC</span><span class="p">(</span><span class="nl">c:</span> <span class="n">C</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">   <span class="n">c</span><span class="p">.</span><span class="n">array1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// Can directly access C.array without going through dynamic dispatch.</span>
</span><span class="line">   <span class="n">c</span><span class="p">.</span><span class="n">doSomething</span><span class="p">()</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// Can directly call C.doSomething without going through virtual dispatch.</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">func</span> <span class="n">usingD</span><span class="p">(</span><span class="nl">d:</span> <span class="n">D</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">   <span class="n">d</span><span class="p">.</span><span class="n">array1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// Can directly access D.array1 without going through dynamic dispatch.</span>
</span><span class="line">   <span class="n">d</span><span class="p">.</span><span class="n">array2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// Will access D.array2 through dynamic dispatch.</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>

<h4><code>private</code></h4>
<p><code>private</code><code>final</code>e.doSomething()  f.myPrivateVar E,F <br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">private</span> <span class="n">class</span> <span class="n">E</span> <span class="p">{</span>
</span><span class="line">  <span class="n">func</span> <span class="n">doSomething</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">class</span> <span class="n">F</span> <span class="p">{</span>
</span><span class="line">  <span class="n">private</span> <span class="n">var</span> <span class="n">myPrivateVar</span> <span class="o">:</span> <span class="n">Int</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">func</span> <span class="n">usingE</span><span class="p">(</span><span class="nl">e:</span> <span class="n">E</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">  <span class="n">e</span><span class="p">.</span><span class="n">doSomething</span><span class="p">()</span> <span class="c1">// There is no sub class in the file that declares this class.</span>
</span><span class="line">                  <span class="c1">// The compiler can remove virtual calls to doSomething()</span>
</span><span class="line">                  <span class="c1">// and directly call As doSomething method.</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">func</span> <span class="n">usingF</span><span class="p">(</span><span class="nl">f:</span> <span class="n">F</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="p">{</span>
</span><span class="line">  <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="n">myPrivateVar</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>
<h2></h2>
<p> Array  Dictionary  Swift 
</p>
<h4></h4>
<p>
Swift: NSArray  NSArray <br />
<br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="c1">// Don&#39;t use a class here.</span>
</span><span class="line"><span class="k">struct</span> <span class="n">PhonebookEntry</span> <span class="p">{</span>
</span><span class="line">  <span class="n">var</span> <span class="n">name</span> <span class="o">:</span> <span class="n">String</span>
</span><span class="line">  <span class="n">var</span> <span class="n">number</span> <span class="o">:</span> <span class="p">[</span><span class="n">Int</span><span class="p">]</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">var</span> <span class="n">a</span> <span class="o">:</span> <span class="p">[</span><span class="n">PhonebookEntry</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
/
</p>
<h4> <code>NSArray</code> <code> ContiguousArray </code></h4>
<p>
 NSArray  ContiguousArray  Array
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">class</span> <span class="n">C</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class="line"><span class="n">var</span> <span class="nl">a:</span> <span class="n">ContiguousArray</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[</span><span class="n">C</span><span class="p">(...),</span> <span class="n">C</span><span class="p">(...),</span> <span class="p">...,</span> <span class="n">C</span><span class="p">(...)]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>
<h4></h4>
<p>
 Swift  COW(copy-on-write)  1  d  c  d  2 d  2  d
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">var</span> <span class="nl">c:</span> <span class="p">[</span><span class="n">Int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="p">...</span> <span class="p">]</span>
</span><span class="line"><span class="n">var</span> <span class="n">d</span> <span class="o">=</span> <span class="n">c</span>        <span class="c1">// No copy will occur here.</span>
</span><span class="line"><span class="n">d</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>      <span class="c1">// A copy *does* occur here.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
 COW  Swift 
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">append_one</span><span class="p">(</span><span class="nl">a:</span> <span class="p">[</span><span class="n">Int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">Int</span><span class="p">]</span> <span class="p">{</span>
</span><span class="line">  <span class="n">a</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">  <span class="k">return</span> <span class="n">a</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">var</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span class="line"><span class="n">a</span> <span class="o">=</span> <span class="n">append_one</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
a   append_one   a  inout 
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="nf">append_one_in_place</span><span class="p">(</span><span class="n">inout</span> <span class="nl">a:</span> <span class="p">[</span><span class="n">Int</span><span class="p">])</span> <span class="p">{</span>
</span><span class="line">  <span class="n">a</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">var</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span class="line"><span class="n">append_one_in_place</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<h2></h2>
<p>Swift  bug
</p>
<h4></h4>
<p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">a</span> <span class="o">:</span> <span class="p">[</span><span class="n">Int</span><span class="p">]</span>
</span><span class="line"><span class="n">b</span> <span class="o">:</span> <span class="p">[</span><span class="n">Int</span><span class="p">]</span>
</span><span class="line"><span class="n">c</span> <span class="o">:</span> <span class="p">[</span><span class="n">Int</span><span class="p">]</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Precondition: for all a[i], b[i]: a[i] + b[i] does not overflow!</span>
</span><span class="line"><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span> <span class="p">...</span> <span class="n">n</span> <span class="p">{</span>
</span><span class="line">  <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>
<h4></h4>
<p>
Swift  Swift  T  MySwiftFunc<t>  T MySwiftFunc<int> MySwiftFunc<string> :
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">class</span> <span class="n">MySwiftFunc</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">MySwiftFunc</span><span class="o">&lt;</span><span class="n">Int</span><span class="o">&gt;</span> <span class="n">X</span>    <span class="c1">// Will emit code that works with Int...</span>
</span><span class="line"><span class="n">MySwiftFunc</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">Y</span> <span class="c1">// ... as well as String.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
Swift Swift 
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">class</span> <span class="n">MyStack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class="line">  <span class="n">func</span> <span class="n">push</span><span class="p">(</span><span class="nl">element:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class="line">  <span class="n">func</span> <span class="n">pop</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">T</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">func</span> <span class="n">myAlgorithm</span><span class="p">(</span><span class="nl">a:</span> <span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="nl">length:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="c1">// The compiler can specialize code of MyStack[Int]</span>
</span><span class="line"><span class="n">var</span> <span class="nl">stackOfInts:</span> <span class="n">MyStack</span><span class="p">[</span><span class="n">Int</span><span class="p">]</span>
</span><span class="line"><span class="c1">// Use stack of ints.</span>
</span><span class="line"><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="p">...</span> <span class="p">{</span>
</span><span class="line">  <span class="n">stack</span><span class="p">.</span><span class="n">push</span><span class="p">(...)</span>
</span><span class="line">  <span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">(...)</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">var</span> <span class="nl">arrayOfInts:</span> <span class="p">[</span><span class="n">Int</span><span class="p">]</span>
</span><span class="line"><span class="c1">// The compiler can emit a specialized version of &#39;myAlgorithm&#39; targeted for</span>
</span><span class="line"><span class="c1">// [Int]&#39; types.</span>
</span><span class="line"><span class="n">myAlgorithm</span><span class="p">(</span><span class="n">arrayOfInts</span><span class="p">,</span> <span class="n">arrayOfInts</span><span class="p">.</span><span class="n">length</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4></h4>
<p>
</p>
<h4></h4>
<p>&#8212; play_a_game <br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="c1">//Framework.swift:</span>
</span><span class="line">
</span><span class="line"><span class="n">protocol</span> <span class="n">Pingable</span> <span class="p">{</span> <span class="n">func</span> <span class="n">ping</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Self</span> <span class="p">}</span>
</span><span class="line"><span class="n">protocol</span> <span class="n">Playable</span> <span class="p">{</span> <span class="n">func</span> <span class="n">play</span><span class="p">()</span> <span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">extension</span> <span class="n">Int</span> <span class="o">:</span> <span class="n">Pingable</span> <span class="p">{</span>
</span><span class="line">  <span class="n">func</span> <span class="n">ping</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="p">{</span> <span class="k">return</span> <span class="n">self</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">class</span> <span class="n">Game</span><span class="o">&lt;</span><span class="n">T</span> <span class="o">:</span> <span class="n">Pingable</span><span class="o">&gt;</span> <span class="o">:</span> <span class="n">Playable</span> <span class="p">{</span>
</span><span class="line">  <span class="n">var</span> <span class="n">t</span> <span class="o">:</span> <span class="n">T</span>
</span><span class="line">
</span><span class="line">  <span class="n">init</span> <span class="p">(</span><span class="n">_</span> <span class="n">v</span> <span class="o">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span><span class="n">t</span> <span class="o">=</span> <span class="n">v</span><span class="p">}</span>
</span><span class="line">
</span><span class="line">  <span class="n">func</span> <span class="n">play</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mf">0.</span><span class="p">.</span><span class="mf">.100</span><span class="n">_000_000</span> <span class="p">{</span> <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">ping</span><span class="p">()</span> <span class="p">}</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">func</span> <span class="n">play_a_game</span><span class="p">(</span><span class="n">game</span> <span class="o">:</span> <span class="n">Playable</span> <span class="p">)</span> <span class="p">{</span>
</span><span class="line">  <span class="c1">// This check allows the optimizer to specialize the</span>
</span><span class="line">  <span class="c1">// generic call &#39;play&#39;</span>
</span><span class="line">  <span class="k">if</span> <span class="n">let</span> <span class="n">z</span> <span class="o">=</span> <span class="n">game</span> <span class="n">as</span><span class="o">?</span> <span class="n">Game</span><span class="o">&lt;</span><span class="n">Int</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class="line">    <span class="n">z</span><span class="p">.</span><span class="n">play</span><span class="p">()</span>
</span><span class="line">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class="line">    <span class="n">game</span><span class="p">.</span><span class="n">play</span><span class="p">()</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="c1">/// -------------- &gt;8</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Application.swift:</span>
</span><span class="line">
</span><span class="line"><span class="n">play_a_game</span><span class="p">(</span><span class="n">Game</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>
<h4></h4>
<p>
Swift


<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">protocol</span> <span class="n">P</span> <span class="p">{}</span>
</span><span class="line"><span class="k">struct</span> <span class="n">Node</span> <span class="o">:</span> <span class="n">P</span> <span class="p">{</span>
</span><span class="line">  <span class="n">var</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">:</span> <span class="n">P</span><span class="o">?</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">struct</span> <span class="n">Tree</span> <span class="p">{</span>
</span><span class="line">  <span class="n">var</span> <span class="n">node</span> <span class="o">:</span> <span class="n">P</span><span class="o">?</span>
</span><span class="line">  <span class="n">init</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
. malloc/free 


</p>
<h4> COWcopy-on-write</h4>
<p>
Swift 

 Tree  tree  tree  O(n)  O(1)
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">struct</span> <span class="n">tree</span> <span class="o">:</span> <span class="n">P</span> <span class="p">{</span>
</span><span class="line">  <span class="n">var</span> <span class="n">node</span> <span class="o">:</span> <span class="p">[</span><span class="n">P</span><span class="o">?</span><span class="p">]</span>
</span><span class="line">  <span class="n">init</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="n">node</span> <span class="o">=</span> <span class="p">[</span> <span class="n">thing</span> <span class="p">]</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
 COW  append  count  API  OC Swift 

 COW 
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">final</span> <span class="n">class</span> <span class="n">Ref</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class="line">  <span class="n">var</span> <span class="n">val</span> <span class="o">:</span> <span class="n">T</span>
</span><span class="line">  <span class="n">init</span><span class="p">(</span><span class="n">_</span> <span class="n">v</span> <span class="o">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span><span class="n">val</span> <span class="o">=</span> <span class="n">v</span><span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">struct</span> <span class="n">Box</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class="line">    <span class="n">var</span> <span class="n">ref</span> <span class="o">:</span> <span class="n">Ref</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
</span><span class="line">    <span class="n">init</span><span class="p">(</span><span class="n">_</span> <span class="n">x</span> <span class="o">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span> <span class="n">ref</span> <span class="o">=</span> <span class="n">Ref</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span>
</span><span class="line">
</span><span class="line">    <span class="n">var</span> <span class="nl">value:</span> <span class="n">T</span> <span class="p">{</span>
</span><span class="line">        <span class="n">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ref</span><span class="p">.</span><span class="n">val</span> <span class="p">}</span>
</span><span class="line">        <span class="n">set</span> <span class="p">{</span>
</span><span class="line">          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isUniquelyReferencedNonObjC</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ref</span><span class="p">))</span> <span class="p">{</span>
</span><span class="line">            <span class="n">ref</span> <span class="o">=</span> <span class="n">Ref</span><span class="p">(</span><span class="n">newValue</span><span class="p">)</span>
</span><span class="line">            <span class="k">return</span>
</span><span class="line">          <span class="p">}</span>
</span><span class="line">          <span class="n">ref</span><span class="p">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">newValue</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
 Box 
</p>
<h4></h4>
SwiftSwift<code>elem = elem.next</code>Swift  next  Swift 
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">final</span> <span class="n">class</span> <span class="n">Node</span> <span class="p">{</span>
</span><span class="line"> <span class="n">var</span> <span class="nl">next:</span> <span class="n">Node</span><span class="o">?</span>
</span><span class="line"> <span class="n">var</span> <span class="nl">data:</span> <span class="n">Int</span>
</span><span class="line"> <span class="p">...</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4></h4>
<p>
Unmanaged<t>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">var</span> <span class="n">Ref</span> <span class="o">:</span> <span class="n">Unmanaged</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">Unmanaged</span><span class="p">.</span><span class="n">passUnretained</span><span class="p">(</span><span class="n">Head</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">while</span> <span class="n">let</span> <span class="n">Next</span> <span class="o">=</span> <span class="n">Ref</span><span class="p">.</span><span class="n">takeUnretainedValue</span><span class="p">().</span><span class="n">next</span> <span class="p">{</span>
</span><span class="line">  <span class="p">...</span>
</span><span class="line">  <span class="n">Ref</span> <span class="o">=</span> <span class="n">Unmanaged</span><span class="p">.</span><span class="n">passUnretained</span><span class="p">(</span><span class="n">Next</span><span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2></h2>
<h4></h4>
<p>Swift ARC <br />

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">protocol</span> <span class="n">Pingable</span> <span class="o">:</span> <span class="n">class</span> <span class="p">{</span> <span class="n">func</span> <span class="n">ping</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>

<ul>
<li>:<code>vtable</code></li>
<li>:</li>
<li></li>
<li>: ARC  retainrelease </li>
</ul>
<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
</t></p></string></int></t></p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swift  ABI]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2015/12/11/swift-2-dot-2-yuan-ma-jie-du/"/>
    <updated>2015-12-11T10:10:22+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2015/12/11/swift-2-dot-2-yuan-ma-jie-du</id>
    <content type="html"><![CDATA[<p>
SwiftSwiftSwiftSwiftCCABISwiftABICname manglingllvmObjective-C
</p>
<p>
SwiftSwiftSwiftllvm irSILSILSwiftABIABIAPI
</p>
<p>
ABIApplication Binary Interface
</p>
<p>
ABI
<!-- more-->
<ul>
<li>;</li>
<li>push</li>
<li></li>
<li>ABI</li>
</ul>
ABIInteliBCSABI
</p>
<p>
ABIAPIAPIAPIABIABI UnixIntel 80386ABILinuxLinux
</p>
<p>
ABISwiftSwiftObject Objective-CSwift
</p>
<h2></h2>
<h4></h4>
<p>

<ul>
  <li>01</li>
  <li>,,var:<ul>
      <li></li>
      <li>&lt;/li&gt;
      <li></li>
      <li></li>
      
  </li>
  <li></li>
</ul>

CLLVM,,C,,,C,,LLVM:
<br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="c1">// LLVM &lt;{ i64, i8 }&gt;</span>
</span><span class="line"><span class="k">struct</span> <span class="n">S</span> <span class="p">{</span>
</span><span class="line">  <span class="n">var</span> <span class="nl">x:</span> <span class="n">Int</span>
</span><span class="line">  <span class="n">var</span> <span class="nl">y:</span> <span class="n">UInt8</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="c1">// LLVM &lt;{ i8, [7 x i8], &lt;{ i64, i8 }&gt;, i8 }&gt;</span>
</span><span class="line"><span class="k">struct</span> <span class="n">S2</span> <span class="p">{</span>
</span><span class="line">  <span class="n">var</span> <span class="nl">x:</span> <span class="n">UInt8</span>
</span><span class="line">  <span class="n">var</span> <span class="nl">s:</span> <span class="n">S</span>
</span><span class="line">  <span class="n">var</span> <span class="nl">y:</span> <span class="n">UInt8</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="c1">// LLVM &lt;{}&gt;</span>
</span><span class="line"><span class="k">struct</span> <span class="n">Empty</span> <span class="p">{}</span>
</span><span class="line">
</span><span class="line"><span class="c1">// LLVM &lt;{ i64, i64 }&gt;</span>
</span><span class="line"><span class="k">struct</span> <span class="n">ContainsEmpty</span> <span class="p">{</span>
</span><span class="line">  <span class="n">var</span> <span class="nl">x:</span> <span class="n">Int</span>
</span><span class="line">  <span class="n">var</span> <span class="nl">y:</span> <span class="n">Empty</span>
</span><span class="line">  <span class="n">var</span> <span class="nl">z:</span> <span class="n">Int</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<h4></h4>
<p>
SwiftObjective-CObjective-C ABI
<ul>
<li>32ObjCnil</li>
<li>x86-64,,0</li>
<li>ARM64,</li>
<li>32isa<code>object_getClass</code><code>*(Class*)object</code></li>
<li>64isa<code>uintptr_t objc_debug_isa_class_mask;</code><code>object_getClass</code><code>(Class)(objc_debug_isa_class_mask &amp; *(uintptr_t*)object)</code></li>
<li>isanil;</li>
</ul>

Swift ABI
<ul>
<li>Swift</li>
</ul>
</p>

<h2>Enum</h2>
<p>
enumABIABIenum:
</p>
<h4></h4>
<p>enumcase,
<br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">enum</span> <span class="n">Empty</span> <span class="p">{}</span> <span class="c1">// =&gt; empty type</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>
<h4></h4>
<p>,,,
<br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">enum</span> <span class="n">EmptyCase</span> <span class="p">{</span> <span class="k">case</span> <span class="n">X</span> <span class="p">}</span>             <span class="c1">// =&gt; empty type</span>
</span><span class="line"><span class="k">enum</span> <span class="n">DataCase</span> <span class="p">{</span> <span class="k">case</span> <span class="n">Y</span><span class="p">(</span><span class="n">Int</span><span class="p">,</span> <span class="n">Double</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// =&gt; LLVM &lt;{ i64, double }&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>
<h4>C</h4>
<p>case(cenum),enumLLVMcase
<br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">enum</span> <span class="n">EnumLike2</span> <span class="p">{</span> <span class="c1">// =&gt; LLVM i1</span>
</span><span class="line">  <span class="k">case</span> <span class="n">A</span>         <span class="c1">// =&gt; i1 0</span>
</span><span class="line">  <span class="k">case</span> <span class="n">B</span>         <span class="c1">// =&gt; i1 1</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">enum</span> <span class="n">EnumLike8</span> <span class="p">{</span> <span class="c1">// =&gt; LLVM i3</span>
</span><span class="line">  <span class="k">case</span> <span class="n">A</span>         <span class="c1">// =&gt; i3 0</span>
</span><span class="line">  <span class="k">case</span> <span class="n">B</span>         <span class="c1">// =&gt; i3 1</span>
</span><span class="line">  <span class="k">case</span> <span class="n">C</span>         <span class="c1">// =&gt; i3 2</span>
</span><span class="line">  <span class="k">case</span> <span class="n">D</span>         <span class="c1">// etc.</span>
</span><span class="line">  <span class="k">case</span> <span class="n">E</span>
</span><span class="line">  <span class="k">case</span> <span class="n">F</span>
</span><span class="line">  <span class="k">case</span> <span class="n">G</span>
</span><span class="line">  <span class="k">case</span> <span class="n">H</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<br />
case
</p>

<h4></h4>
<p>
(),,,,,,,case(),enum
<br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">enum</span> <span class="n">CharOrSectionMarker</span> <span class="p">{</span> <span class="o">=&gt;</span> <span class="n">LLVM</span> <span class="n">i32</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Paragraph</span>            <span class="o">=&gt;</span> <span class="n">i32</span> <span class="mh">0x0020</span><span class="n">_0000</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Char</span><span class="p">(</span><span class="n">UnicodeScalar</span><span class="p">)</span>  <span class="o">=&gt;</span> <span class="n">i32</span> <span class="p">(</span><span class="n">zext</span> <span class="n">i21</span> <span class="o">%</span><span class="n">Char</span> <span class="n">to</span> <span class="n">i32</span><span class="p">)</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Chapter</span>              <span class="o">=&gt;</span> <span class="n">i32</span> <span class="mh">0x0020</span><span class="n">_0001</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">CharOrSectionMarker</span><span class="p">.</span><span class="n">Char</span><span class="p">(</span><span class="sc">&#39;\x00&#39;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">i32</span> <span class="mh">0x0000</span><span class="n">_0000</span>
</span><span class="line"><span class="n">CharOrSectionMarker</span><span class="p">.</span><span class="n">Char</span><span class="p">(</span><span class="err">&#39;\</span><span class="n">u10FFFF</span><span class="err">&#39;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">i32</span> <span class="mh">0x0010</span><span class="n">_FFFF</span>
</span><span class="line">
</span><span class="line"><span class="k">enum</span> <span class="n">CharOrSectionMarkerOrFootnoteMarker</span> <span class="p">{</span> <span class="o">=&gt;</span> <span class="n">LLVM</span> <span class="n">i32</span>
</span><span class="line">  <span class="k">case</span> <span class="n">CharOrSectionMarker</span><span class="p">(</span><span class="n">CharOrSectionMarker</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">i32</span> <span class="o">%</span><span class="n">CharOrSectionMarker</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Asterisk</span>                                 <span class="o">=&gt;</span> <span class="n">i32</span> <span class="mh">0x0020</span><span class="n">_0002</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Dagger</span>                                   <span class="o">=&gt;</span> <span class="n">i32</span> <span class="mh">0x0020</span><span class="n">_0003</span>
</span><span class="line">  <span class="k">case</span> <span class="n">DoubleDagger</span>                             <span class="o">=&gt;</span> <span class="n">i32</span> <span class="mh">0x0020</span><span class="n">_0004</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<br />
,,enum,
<br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">enum</span> <span class="n">IntOrInfinity</span> <span class="p">{</span> <span class="o">=&gt;</span> <span class="n">LLVM</span> <span class="o">&lt;</span><span class="p">{</span> <span class="n">i64</span><span class="p">,</span> <span class="n">i1</span> <span class="p">}</span><span class="o">&gt;</span>
</span><span class="line">  <span class="k">case</span> <span class="n">NegInfinity</span>    <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="p">{</span> <span class="n">i64</span><span class="p">,</span> <span class="n">i1</span> <span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">}</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Int</span><span class="p">(</span><span class="n">Int</span><span class="p">)</span>       <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="p">{</span> <span class="n">i64</span><span class="p">,</span> <span class="n">i1</span> <span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span> <span class="o">%</span><span class="n">Int</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span>
</span><span class="line">  <span class="k">case</span> <span class="n">PosInfinity</span>    <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="p">{</span> <span class="n">i64</span><span class="p">,</span> <span class="n">i1</span> <span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span>    <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">IntOrInfinity</span><span class="p">.</span><span class="n">Int</span><span class="p">(</span>    <span class="mi">0</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="p">{</span> <span class="n">i64</span><span class="p">,</span> <span class="n">i1</span> <span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span>
</span><span class="line"><span class="n">IntOrInfinity</span><span class="p">.</span><span class="n">Int</span><span class="p">(</span><span class="mi">20721</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="p">{</span> <span class="n">i64</span><span class="p">,</span> <span class="n">i1</span> <span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span> <span class="mi">20721</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>
<h4></h4>
<p>
,ABI,fixed-zero,<code>i21</code>
<br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">enum</span> <span class="n">TerminalChar</span> <span class="p">{</span>             <span class="o">=&gt;</span> <span class="n">LLVM</span> <span class="n">i32</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Plain</span><span class="p">(</span><span class="n">UnicodeScalar</span><span class="p">)</span>     <span class="o">=&gt;</span> <span class="n">i32</span>     <span class="p">(</span><span class="n">zext</span> <span class="n">i21</span> <span class="o">%</span><span class="n">Plain</span>     <span class="n">to</span> <span class="n">i32</span><span class="p">)</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Bold</span><span class="p">(</span><span class="n">UnicodeScalar</span><span class="p">)</span>      <span class="o">=&gt;</span> <span class="n">i32</span> <span class="p">(</span><span class="n">or</span> <span class="p">(</span><span class="n">zext</span> <span class="n">i21</span> <span class="o">%</span><span class="n">Bold</span>      <span class="n">to</span> <span class="n">i32</span><span class="p">),</span> <span class="mh">0x0020</span><span class="n">_0000</span><span class="p">)</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Underline</span><span class="p">(</span><span class="n">UnicodeScalar</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">i32</span> <span class="p">(</span><span class="n">or</span> <span class="p">(</span><span class="n">zext</span> <span class="n">i21</span> <span class="o">%</span><span class="n">Underline</span> <span class="n">to</span> <span class="n">i32</span><span class="p">),</span> <span class="mh">0x0040</span><span class="n">_0000</span><span class="p">)</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Blink</span><span class="p">(</span><span class="n">UnicodeScalar</span><span class="p">)</span>     <span class="o">=&gt;</span> <span class="n">i32</span> <span class="p">(</span><span class="n">or</span> <span class="p">(</span><span class="n">zext</span> <span class="n">i21</span> <span class="o">%</span><span class="n">Blink</span>     <span class="n">to</span> <span class="n">i32</span><span class="p">),</span> <span class="mh">0x0060</span><span class="n">_0000</span><span class="p">)</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Empty</span>                    <span class="o">=&gt;</span> <span class="n">i32</span> <span class="mh">0x0080</span><span class="n">_0000</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Cursor</span>                   <span class="o">=&gt;</span> <span class="n">i32</span> <span class="mh">0x0080</span><span class="n">_0001</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<br />
,,,
<br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">class</span> <span class="n">Bignum</span> <span class="p">{}</span>
</span><span class="line">
</span><span class="line"><span class="k">enum</span> <span class="n">IntDoubleOrBignum</span> <span class="p">{</span> <span class="o">=&gt;</span> <span class="n">LLVM</span> <span class="o">&lt;</span><span class="p">{</span> <span class="n">i64</span><span class="p">,</span> <span class="n">i2</span> <span class="p">}</span><span class="o">&gt;</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Int</span><span class="p">(</span><span class="n">Int</span><span class="p">)</span>           <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="p">{</span> <span class="n">i64</span><span class="p">,</span> <span class="n">i2</span> <span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span>           <span class="o">%</span><span class="n">Int</span><span class="p">,</span>            <span class="mi">0</span> <span class="p">}</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Double</span><span class="p">(</span><span class="n">Double</span><span class="p">)</span>     <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="p">{</span> <span class="n">i64</span><span class="p">,</span> <span class="n">i2</span> <span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span> <span class="p">(</span><span class="n">bitcast</span>  <span class="o">%</span><span class="n">Double</span> <span class="n">to</span> <span class="n">i64</span><span class="p">),</span> <span class="mi">1</span> <span class="p">}</span>
</span><span class="line">  <span class="k">case</span> <span class="n">Bignum</span><span class="p">(</span><span class="n">Bignum</span><span class="p">)</span>     <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="p">{</span> <span class="n">i64</span><span class="p">,</span> <span class="n">i2</span> <span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span> <span class="p">(</span><span class="n">ptrtoint</span> <span class="o">%</span><span class="n">Bignum</span> <span class="n">to</span> <span class="n">i64</span><span class="p">),</span> <span class="mi">2</span> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>
<h2></h2>
<p>,,any(<code>protocol&lt;&gt;</code>)()</p>
<h4></h4>
<p>,,pointer-aligned,,,C:
<br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">struct</span> <span class="n">OpaqueExistentialContainer</span> <span class="p">{</span>
</span><span class="line">  <span class="kt">void</span> <span class="o">*</span><span class="n">fixedSizeBuffer</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span><span class="line">  <span class="n">Metadata</span> <span class="o">*</span><span class="n">type</span><span class="p">;</span>
</span><span class="line">  <span class="n">WitnessTable</span> <span class="o">*</span><span class="n">witnessTables</span><span class="p">[</span><span class="n">NUM_WITNESS_TABLES</span><span class="p">];</span>
</span><span class="line"><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>
<h4></h4>
<p>
,,,,,C:
<br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">struct</span> <span class="n">ClassExistentialContainer</span> <span class="p">{</span>
</span><span class="line">  <span class="n">HeapObject</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>
</span><span class="line">  <span class="n">WitnessTable</span> <span class="o">*</span><span class="n">witnessTables</span><span class="p">[</span><span class="n">NUM_WITNESS_TABLES</span><span class="p">];</span>
</span><span class="line"><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<br />
,,<code>protocol&lt;&gt;</code>Objective-C,ABIid,<code>Protocol</code>Objective-C
</p>

<h2></h2>
<p>,(TODO:),,,,,<br />
,32,14,64,8<br />
</p>
<h4></h4>
<p>
,:
<ul>
<li>vtable,,,,-1,</li>
<li>pointer-sized0</li>
</ul>
</p>
<h4></h4>
<p>
:<br />
<ul>
<li>1</li>
<li>2,,null</li>
<li>3,var,pointer-sized</li>
<li>,3 + n,n</li>
</ul>
</p>
<h4></h4>
<p>,enum:<br />
<ul>
<li>1</li>
<li>2,,null</li>
<li>enum,3</li>
</ul>
</p>
<h4></h4>
<p>
:<br />
<ul>
<li>1</li>
<li>null2null,UTF-8,(,)</li>
<li>3,type-offsetn3+2*nn3+2*n+1</li>
</ul>
</p>
<h4></h4>
<p>,:<br />
<ul>
<li>1</li>
<li>2,</li>
<li>3,</li>
</ul>
<p>
in/out,,in/out,
in/out,:
</p>
<ul>
<li>0:</li>
<li>1:</li>
<li>&gt; 1:tuple</li>
</ul>
</p>
<h4></h4>
<p>
,:</p>
<ul>
<li>1:<ul>
<li>31</li>
<li>31,,,</li>
</ul>
pointer-sized,32,
</li>
<li>2<code>protocol&lt;&gt; </code> <code>P</code><code>protocol&lt;P, Q, ...&gt;</code>,</li>
<li>3,,</li>
</ul>

<h4></h4>
<p>
:
<ul>
<li>1</li>
</ul>
</p>

<h4></h4>
<p>
Objective-C;Objective-C,
<ul>
<li>2Swift<ul>
<li>isaObjective-C0</li>
<li>1null</li>
<li>23Objective-C</li>
<li>rodata4;Objective-Crodata1Swift0Objective-C</li>
<li>325</li>
<li>32</li>
<li>32</li>
<li>mask16 </li>
<li>16mask </li>
<li>32</li>
<li>32 </li>
<li>6483211 </li>
<li>Swift </li>
<li> </li>
<li></li>
<li>V </li>
<li> Objective-Civar</li>
</ul>

<p>Objective-C </p>
<h4></h4>
<p> <br />
&lt;TUV&gt;TUVC<br />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">struct</span> <span class="n">GenericParameterVector</span> <span class="p">{</span>
</span><span class="line">  <span class="n">TypeMetadata</span> <span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="o">*</span><span class="n">U</span><span class="p">,</span> <span class="o">*</span><span class="n">V</span><span class="p">;</span>
</span><span class="line"><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<code> &lt;T: Runcible, U: protocol&lt;Fungible, Ansible&gt;, V&gt; </code>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">struct</span> <span class="n">GenericParameterVector</span> <span class="p">{</span>
</span><span class="line">  <span class="n">TypeMetadata</span> <span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="o">*</span><span class="n">U</span><span class="p">,</span> <span class="o">*</span><span class="n">V</span><span class="p">;</span>
</span><span class="line">  <span class="n">RuncibleWitnessTable</span> <span class="o">*</span><span class="n">T_Runcible</span><span class="p">;</span>
</span><span class="line">  <span class="n">FungibleWitnessTable</span> <span class="o">*</span><span class="n">U_Fungible</span><span class="p">;</span>
</span><span class="line">  <span class="n">AnsibleWitnessTable</span> <span class="o">*</span><span class="n">U_Ansible</span><span class="p">;</span>
</span><span class="line"><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</p>
<h4></h4>
<p>
<ul>
<li>0<ul>
<li>0</li>
<li>1</li>
<li>2</li>
</ul></li>
<li>C </li>
<li> <ul>
<li>:<ul>
<li>2 </li>
<li>3. </li>
<li>4C</li>
<li>5. </li></ul></li>
<li><ul>
<li>2248</li>
<li>3 </li>
<li>case4C </li>
<li>case5. </li></ul></li>
</ul></li>
<li>6. </li>
<li>7 <ul>
<li>7. </li>
<li>8. </li>
<li>9. </li>
<li>n <ul>
<li>10 + N </li></ul></li></ul></li>
</ul>

</p>
<h4>Protocol</h4>
Objective-C
<ul>
<li>isa0Objective-C </li>
<li>C1 </li>
<li>2. </li>
<li>ObjC3ObjCSwift </li>
<li>ObjC4ObjCSwift </li>
<li>ObjC5ObjCSwift </li>
<li>ObjC6ObjCSwift </li>
<li>ObjC7ObjCSwift </li>
<li>32872644032</li>
<li>32 <ul>
<li>0SwiftSwiftObjective-C </li>
<li>1 Objective-CObjective-C </li>
<li>2objc_msgSend </li>
<li>31Objective-CSwift </li>
</ul></li>
</ul>

<h2></h2>
<p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">mangled</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">_T</span><span class="err">&#39;</span> <span class="n">global</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
Swift-
</p>
<h4></h4>
<p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="sc">&#39;t&#39;</span> <span class="n">type</span>                    <span class="c1">// standalone type (for DWARF)</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="sc">&#39;M&#39;</span> <span class="n">type</span>                    <span class="c1">// type metadata (address point)</span>
</span><span class="line">                                       <span class="c1">// -- type starts with [BCOSTV]</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Mf</span><span class="err">&#39;</span> <span class="n">type</span>                   <span class="c1">// &#39;full&#39; type metadata (start of object)</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">MP</span><span class="err">&#39;</span> <span class="n">type</span>                   <span class="c1">// type metadata pattern</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Ma</span><span class="err">&#39;</span> <span class="n">type</span>                   <span class="c1">// type metadata access function</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">ML</span><span class="err">&#39;</span> <span class="n">type</span>                   <span class="c1">// type metadata lazy cache variable</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Mm</span><span class="err">&#39;</span> <span class="n">type</span>                   <span class="c1">// class metaclass</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Mn</span><span class="err">&#39;</span> <span class="n">nominal</span><span class="o">-</span><span class="n">type</span>           <span class="c1">// nominal type descriptor</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Mp</span><span class="err">&#39;</span> <span class="n">protocol</span>               <span class="c1">// protocol descriptor</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">PA</span><span class="err">&#39;</span> <span class="p">.</span><span class="o">*</span>                     <span class="c1">// partial application forwarder</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">PAo</span><span class="err">&#39;</span> <span class="p">.</span><span class="o">*</span>                    <span class="c1">// ObjC partial application forwarder</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="sc">&#39;w&#39;</span> <span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="n">type</span> <span class="c1">// value witness</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">WV</span><span class="err">&#39;</span> <span class="n">type</span>                   <span class="c1">// value witness table</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Wo</span><span class="err">&#39;</span> <span class="n">entity</span>                 <span class="c1">// witness table offset</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Wv</span><span class="err">&#39;</span> <span class="n">directness</span> <span class="n">entity</span>      <span class="c1">// field offset</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">WP</span><span class="err">&#39;</span> <span class="n">protocol</span><span class="o">-</span><span class="n">conformance</span>   <span class="c1">// protocol witness table</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Wa</span><span class="err">&#39;</span> <span class="n">protocol</span><span class="o">-</span><span class="n">conformance</span>   <span class="c1">// protocol witness table accessor</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Wl</span><span class="err">&#39;</span> <span class="n">type</span> <span class="n">protocol</span><span class="o">-</span><span class="n">conformance</span> <span class="c1">// lazy protocol witness table accessor</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">WL</span><span class="err">&#39;</span> <span class="n">protocol</span><span class="o">-</span><span class="n">conformance</span>   <span class="c1">// lazy protocol witness table cache variable</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">WD</span><span class="err">&#39;</span> <span class="n">protocol</span><span class="o">-</span><span class="n">conformance</span>   <span class="c1">// dependent proto witness table generator</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Wd</span><span class="err">&#39;</span> <span class="n">protocol</span><span class="o">-</span><span class="n">conformance</span>   <span class="c1">// dependent proto witness table template</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="n">entity</span>                      <span class="c1">// some identifiable thing</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">TO</span><span class="err">&#39;</span> <span class="n">global</span>                 <span class="c1">// ObjC-as-swift thunk</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">To</span><span class="err">&#39;</span> <span class="n">global</span>                 <span class="c1">// swift-as-ObjC thunk</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">TD</span><span class="err">&#39;</span> <span class="n">global</span>                 <span class="c1">// dynamic dispatch thunk</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Td</span><span class="err">&#39;</span> <span class="n">global</span>                 <span class="c1">// direct method reference thunk</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">TR</span><span class="err">&#39;</span> <span class="n">reabstract</span><span class="o">-</span><span class="n">signature</span>   <span class="c1">// reabstraction thunk helper function</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Tr</span><span class="err">&#39;</span> <span class="n">reabstract</span><span class="o">-</span><span class="n">signature</span>   <span class="c1">// reabstraction thunk</span>
</span><span class="line">
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">TS</span><span class="err">&#39;</span> <span class="n">specializationinfo</span> <span class="sc">&#39;_&#39;</span> <span class="n">mangled</span><span class="o">-</span><span class="n">name</span>
</span><span class="line"><span class="n">specializationinfo</span> <span class="o">::=</span> <span class="sc">&#39;g&#39;</span> <span class="n">passid</span> <span class="p">(</span><span class="n">type</span> <span class="n">protocol</span><span class="o">-</span><span class="n">conformance</span><span class="o">*</span> <span class="sc">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span>            <span class="c1">// Generic specialization info.</span>
</span><span class="line"><span class="n">specializationinfo</span> <span class="o">::=</span> <span class="sc">&#39;f&#39;</span> <span class="n">passid</span> <span class="p">(</span><span class="n">funcspecializationarginfo</span> <span class="sc">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span>             <span class="c1">// Function signature specialization kind</span>
</span><span class="line"><span class="n">passid</span> <span class="o">::=</span> <span class="n">integer</span>                                                             <span class="c1">// The id of the pass that generated this specialization.</span>
</span><span class="line"><span class="n">funcsigspecializationarginfo</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">cl</span><span class="err">&#39;</span> <span class="n">closurename</span> <span class="n">type</span><span class="o">*</span>                        <span class="c1">// Closure specialized with closed over types in argument order.</span>
</span><span class="line"><span class="n">funcsigspecializationarginfo</span> <span class="o">::=</span> <span class="sc">&#39;n&#39;</span>                                           <span class="c1">// Unmodified argument</span>
</span><span class="line"><span class="n">funcsigspecializationarginfo</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">cp</span><span class="err">&#39;</span> <span class="n">funcsigspecializationconstantproppayload</span> <span class="c1">// Constant propagated argument</span>
</span><span class="line"><span class="n">funcsigspecializationarginfo</span> <span class="o">::=</span> <span class="sc">&#39;d&#39;</span>                                           <span class="c1">// Dead argument</span>
</span><span class="line"><span class="n">funcsigspecializationarginfo</span> <span class="o">::=</span> <span class="sc">&#39;g&#39;</span> <span class="sc">&#39;s&#39;</span><span class="o">?</span>                                      <span class="c1">// Owned =&gt; Guaranteed and Exploded if &#39;s&#39; present.</span>
</span><span class="line"><span class="n">funcsigspecializationarginfo</span> <span class="o">::=</span> <span class="sc">&#39;s&#39;</span>                                           <span class="c1">// Exploded</span>
</span><span class="line"><span class="n">funcsigspecializationarginfo</span> <span class="o">::=</span> <span class="sc">&#39;k&#39;</span>                                           <span class="c1">// Exploded</span>
</span><span class="line"><span class="n">funcsigspecializationconstantpropinfo</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">fr</span><span class="err">&#39;</span> <span class="n">mangled</span><span class="o">-</span><span class="n">name</span>
</span><span class="line"><span class="n">funcsigspecializationconstantpropinfo</span> <span class="o">::=</span> <span class="sc">&#39;g&#39;</span> <span class="n">mangled</span><span class="o">-</span><span class="n">name</span>
</span><span class="line"><span class="n">funcsigspecializationconstantpropinfo</span> <span class="o">::=</span> <span class="sc">&#39;i&#39;</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span><span class="o">-</span><span class="n">integer</span>
</span><span class="line"><span class="n">funcsigspecializationconstantpropinfo</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">fl</span><span class="err">&#39;</span> <span class="kt">float</span><span class="o">-</span><span class="n">as</span><span class="o">-</span><span class="mi">64</span><span class="o">-</span><span class="n">bit</span><span class="o">-</span><span class="n">integer</span>
</span><span class="line"><span class="n">funcsigspecializationconstantpropinfo</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">se</span><span class="err">&#39;</span> <span class="n">stringencoding</span> <span class="sc">&#39;v&#39;</span> <span class="n">md5hash</span>
</span><span class="line">
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">TV</span><span class="err">&#39;</span> <span class="n">global</span>                 <span class="c1">// vtable override thunk</span>
</span><span class="line"><span class="n">global</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">TW</span><span class="err">&#39;</span> <span class="n">protocol</span><span class="o">-</span><span class="n">conformance</span> <span class="n">entity</span>
</span><span class="line">                                       <span class="c1">// protocol witness thunk</span>
</span><span class="line"><span class="n">entity</span> <span class="o">::=</span> <span class="n">nominal</span><span class="o">-</span><span class="n">type</span>                <span class="c1">// named type declaration</span>
</span><span class="line"><span class="n">entity</span> <span class="o">::=</span> <span class="k">static</span><span class="o">?</span> <span class="n">entity</span><span class="o">-</span><span class="n">kind</span> <span class="n">context</span> <span class="n">entity</span><span class="o">-</span><span class="n">name</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="sc">&#39;F&#39;</span>                    <span class="c1">// function (ctor, accessor, etc.)</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="sc">&#39;v&#39;</span>                    <span class="c1">// variable (let/var)</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="sc">&#39;i&#39;</span>                    <span class="c1">// subscript (&#39;i&#39;ndex) itself (not the individual accessors)</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="sc">&#39;I&#39;</span>                    <span class="c1">// initializer</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="n">decl</span><span class="o">-</span><span class="n">name</span> <span class="n">type</span>         <span class="c1">// named declaration</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;A&#39;</span> <span class="n">index</span>              <span class="c1">// default argument generator</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;a&#39;</span> <span class="n">addressor</span><span class="o">-</span><span class="n">kind</span> <span class="n">decl</span><span class="o">-</span><span class="n">name</span> <span class="n">type</span>     <span class="c1">// mutable addressor</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;C&#39;</span> <span class="n">type</span>               <span class="c1">// allocating constructor</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;c&#39;</span> <span class="n">type</span>               <span class="c1">// non-allocating constructor</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;D&#39;</span>                    <span class="c1">// deallocating destructor; untyped</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;d&#39;</span>                    <span class="c1">// non-deallocating destructor; untyped</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;g&#39;</span> <span class="n">decl</span><span class="o">-</span><span class="n">name</span> <span class="n">type</span>     <span class="c1">// getter</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;i&#39;</span>                    <span class="c1">// non-local variable initializer</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;l&#39;</span> <span class="n">addressor</span><span class="o">-</span><span class="n">kind</span> <span class="n">decl</span><span class="o">-</span><span class="n">name</span> <span class="n">type</span>     <span class="c1">// non-mutable addressor</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;m&#39;</span> <span class="n">decl</span><span class="o">-</span><span class="n">name</span> <span class="n">type</span>     <span class="c1">// materializeForSet</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;s&#39;</span> <span class="n">decl</span><span class="o">-</span><span class="n">name</span> <span class="n">type</span>     <span class="c1">// setter</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;U&#39;</span> <span class="n">index</span> <span class="n">type</span>         <span class="c1">// explicit anonymous closure expression</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;u&#39;</span> <span class="n">index</span> <span class="n">type</span>         <span class="c1">// implicit anonymous closure</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;w&#39;</span> <span class="n">decl</span><span class="o">-</span><span class="n">name</span> <span class="n">type</span>     <span class="c1">// willSet</span>
</span><span class="line"><span class="n">entity</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;W&#39;</span> <span class="n">decl</span><span class="o">-</span><span class="n">name</span> <span class="n">type</span>     <span class="c1">// didSet</span>
</span><span class="line"><span class="k">static</span> <span class="o">::=</span> <span class="sc">&#39;Z&#39;</span>                         <span class="c1">// entity is a static member of a type</span>
</span><span class="line"><span class="n">decl</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="n">identifier</span>
</span><span class="line"><span class="n">decl</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="n">local</span><span class="o">-</span><span class="n">decl</span><span class="o">-</span><span class="n">name</span>
</span><span class="line"><span class="n">decl</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="n">private</span><span class="o">-</span><span class="n">decl</span><span class="o">-</span><span class="n">name</span>
</span><span class="line"><span class="n">local</span><span class="o">-</span><span class="n">decl</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;L&#39;</span> <span class="n">index</span> <span class="n">identifier</span>  <span class="c1">// locally-discriminated declaration</span>
</span><span class="line"><span class="n">private</span><span class="o">-</span><span class="n">decl</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="sc">&#39;P&#39;</span> <span class="n">identifier</span> <span class="n">identifier</span>  <span class="c1">// file-discriminated declaration</span>
</span><span class="line"><span class="n">reabstract</span><span class="o">-</span><span class="n">signature</span> <span class="o">::=</span> <span class="p">(</span><span class="sc">&#39;G&#39;</span> <span class="n">generic</span><span class="o">-</span><span class="n">signature</span><span class="p">)</span><span class="o">?</span> <span class="n">type</span> <span class="n">type</span>
</span><span class="line"><span class="n">addressor</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="sc">&#39;u&#39;</span>                 <span class="c1">// unsafe addressor (no owner)</span>
</span><span class="line"><span class="n">addressor</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="sc">&#39;O&#39;</span>                 <span class="c1">// owning addressor (non-native owner)</span>
</span><span class="line"><span class="n">addressor</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="sc">&#39;o&#39;</span>                 <span class="c1">// owning addressor (native owner)</span>
</span><span class="line"><span class="n">addressor</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="sc">&#39;p&#39;</span>                 <span class="c1">// pinning addressor (native owner)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<code>entity</code> <code>nominal-type-kind ([COPV])</code>, <code>([Ss])</code> <code> entity-kind ([FIiv])</code>
<code>entity-name</code><code>[AaCcDggis]</code><code>decl-name</code><code>decl-name</code><code>[LP]</code><code>[0-9oX]</code>
[EE][0-9oX][SS]
<code>[MTWw]</code>
_TPA_
mangling
<private-decl-name>
<private-decl-name>;
<reabstract-signature><>

<h4></h4>
<p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">directness</span> <span class="o">::=</span> <span class="sc">&#39;d&#39;</span>                         <span class="c1">// direct</span>
</span><span class="line"><span class="n">directness</span> <span class="o">::=</span> <span class="sc">&#39;i&#39;</span>                         <span class="c1">// indirect</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
manglings

 
</p>
<h4></h4>
<p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">context</span> <span class="o">::=</span> <span class="n">module</span>
</span><span class="line"><span class="n">context</span> <span class="o">::=</span> <span class="n">extension</span>
</span><span class="line"><span class="n">context</span> <span class="o">::=</span> <span class="n">entity</span>
</span><span class="line"><span class="n">module</span> <span class="o">::=</span> <span class="n">substitution</span>                    <span class="c1">// other substitution</span>
</span><span class="line"><span class="n">module</span> <span class="o">::=</span> <span class="n">identifier</span>                      <span class="c1">// module name</span>
</span><span class="line"><span class="n">module</span> <span class="o">::=</span> <span class="n">known</span><span class="o">-</span><span class="n">module</span>                    <span class="c1">// abbreviation</span>
</span><span class="line"><span class="n">extension</span> <span class="o">::=</span> <span class="sc">&#39;E&#39;</span> <span class="n">module</span> <span class="n">entity</span>
</span><span class="line"><span class="n">extension</span> <span class="o">::=</span> <span class="sc">&#39;e&#39;</span> <span class="n">module</span> <span class="n">generic</span><span class="o">-</span><span class="n">signature</span> <span class="n">entity</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
manglings
mangling

</p>
<h4></h4>
<p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Bb</span><span class="err">&#39;</span>                              <span class="c1">// Builtin.BridgeObject</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">BB</span><span class="err">&#39;</span>                              <span class="c1">// Builtin.UnsafeValueBuffer</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Bf</span><span class="err">&#39;</span> <span class="n">natural</span> <span class="sc">&#39;_&#39;</span>                  <span class="c1">// Builtin.Float&lt;n&gt;</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Bi</span><span class="err">&#39;</span> <span class="n">natural</span> <span class="sc">&#39;_&#39;</span>                  <span class="c1">// Builtin.Int&lt;n&gt;</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">BO</span><span class="err">&#39;</span>                              <span class="c1">// Builtin.ObjCPointer</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Bo</span><span class="err">&#39;</span>                              <span class="c1">// Builtin.ObjectPointer</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Bp</span><span class="err">&#39;</span>                              <span class="c1">// Builtin.RawPointer</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Bv</span><span class="err">&#39;</span> <span class="n">natural</span> <span class="n">type</span>                 <span class="c1">// Builtin.Vec&lt;n&gt;x&lt;type&gt;</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Bw</span><span class="err">&#39;</span>                              <span class="c1">// Builtin.Word</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="n">nominal</span><span class="o">-</span><span class="n">type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="n">associated</span><span class="o">-</span><span class="n">type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;a&#39;</span> <span class="n">context</span> <span class="n">identifier</span>            <span class="c1">// Type alias (DWARF only)</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;b&#39;</span> <span class="n">type</span> <span class="n">type</span>                     <span class="c1">// objc block function type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;c&#39;</span> <span class="n">type</span> <span class="n">type</span>                     <span class="c1">// C function pointer type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;F&#39;</span> <span class="n">throws</span><span class="o">-</span><span class="n">annotation</span><span class="o">?</span> <span class="n">type</span> <span class="n">type</span>  <span class="c1">// function type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;f&#39;</span> <span class="n">throws</span><span class="o">-</span><span class="n">annotation</span><span class="o">?</span> <span class="n">type</span> <span class="n">type</span>  <span class="c1">// uncurried function type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;G&#39;</span> <span class="n">type</span> <span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;+</span> <span class="sc">&#39;_&#39;</span>              <span class="c1">// generic type application</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;K&#39;</span> <span class="n">type</span> <span class="n">type</span>                     <span class="c1">// @auto_closure function type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;M&#39;</span> <span class="n">type</span>                          <span class="c1">// metatype without representation</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">XM</span><span class="err">&#39;</span> <span class="n">metatype</span><span class="o">-</span><span class="n">repr</span> <span class="n">type</span>           <span class="c1">// metatype with representation</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;P&#39;</span> <span class="n">protocol</span><span class="o">-</span><span class="n">list</span> <span class="sc">&#39;_&#39;</span>             <span class="c1">// protocol type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">PM</span><span class="err">&#39;</span> <span class="n">type</span>                         <span class="c1">// existential metatype without representation</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">XPM</span><span class="err">&#39;</span> <span class="n">metatype</span><span class="o">-</span><span class="n">repr</span> <span class="n">type</span>          <span class="c1">// existential metatype with representation</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="n">archetype</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;R&#39;</span> <span class="n">type</span>                          <span class="c1">// inout</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;T&#39;</span> <span class="n">tuple</span><span class="o">-</span><span class="n">element</span><span class="o">*</span> <span class="sc">&#39;_&#39;</span>            <span class="c1">// tuple</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;t&#39;</span> <span class="n">tuple</span><span class="o">-</span><span class="n">element</span><span class="o">*</span> <span class="sc">&#39;_&#39;</span>            <span class="c1">// variadic tuple</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Xo</span><span class="err">&#39;</span> <span class="n">type</span>                         <span class="c1">// @unowned type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Xu</span><span class="err">&#39;</span> <span class="n">type</span>                         <span class="c1">// @unowned(unsafe) type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Xw</span><span class="err">&#39;</span> <span class="n">type</span>                         <span class="c1">// @weak type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">XF</span><span class="err">&#39;</span> <span class="n">impl</span><span class="o">-</span><span class="n">function</span><span class="o">-</span><span class="n">type</span>           <span class="c1">// function implementation type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Xf</span><span class="err">&#39;</span> <span class="n">type</span> <span class="n">type</span>                    <span class="c1">// @thin function type</span>
</span><span class="line"><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span>
</span><span class="line"><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="n">substitution</span>
</span><span class="line"><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="n">nominal</span><span class="o">-</span><span class="n">type</span><span class="o">-</span><span class="n">kind</span> <span class="n">declaration</span><span class="o">-</span><span class="n">name</span>
</span><span class="line"><span class="n">nominal</span><span class="o">-</span><span class="n">type</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="sc">&#39;C&#39;</span>                  <span class="c1">// class</span>
</span><span class="line"><span class="n">nominal</span><span class="o">-</span><span class="n">type</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="sc">&#39;O&#39;</span>                  <span class="c1">// enum</span>
</span><span class="line"><span class="n">nominal</span><span class="o">-</span><span class="n">type</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="sc">&#39;V&#39;</span>                  <span class="c1">// struct</span>
</span><span class="line"><span class="n">archetype</span> <span class="o">::=</span> <span class="sc">&#39;Q&#39;</span> <span class="n">index</span>                    <span class="c1">// archetype with depth=0, idx=N</span>
</span><span class="line"><span class="n">archetype</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Qd</span><span class="err">&#39;</span> <span class="n">index</span> <span class="n">index</span>             <span class="c1">// archetype with depth=M+1, idx=N</span>
</span><span class="line"><span class="n">archetype</span> <span class="o">::=</span> <span class="n">associated</span><span class="o">-</span><span class="n">type</span>
</span><span class="line"><span class="n">archetype</span> <span class="o">::=</span> <span class="n">qualified</span><span class="o">-</span><span class="n">archetype</span>
</span><span class="line"><span class="n">associated</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="n">substitution</span>
</span><span class="line"><span class="n">associated</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;Q&#39;</span> <span class="n">protocol</span><span class="o">-</span><span class="n">context</span>     <span class="c1">// self type of protocol</span>
</span><span class="line"><span class="n">associated</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;Q&#39;</span> <span class="n">archetype</span> <span class="n">identifier</span> <span class="c1">// associated type</span>
</span><span class="line"><span class="n">qualified</span><span class="o">-</span><span class="n">archetype</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Qq</span><span class="err">&#39;</span> <span class="n">index</span> <span class="n">context</span>   <span class="c1">// archetype+context (DWARF only)</span>
</span><span class="line"><span class="n">protocol</span><span class="o">-</span><span class="n">context</span> <span class="o">::=</span> <span class="sc">&#39;P&#39;</span> <span class="n">protocol</span>
</span><span class="line"><span class="n">tuple</span><span class="o">-</span><span class="n">element</span> <span class="o">::=</span> <span class="n">identifier</span><span class="o">?</span> <span class="n">type</span>
</span><span class="line"><span class="n">metatype</span><span class="o">-</span><span class="n">repr</span> <span class="o">::=</span> <span class="sc">&#39;t&#39;</span>                      <span class="c1">// Thin metatype representation</span>
</span><span class="line"><span class="n">metatype</span><span class="o">-</span><span class="n">repr</span> <span class="o">::=</span> <span class="sc">&#39;T&#39;</span>                      <span class="c1">// Thick metatype representation</span>
</span><span class="line"><span class="n">metatype</span><span class="o">-</span><span class="n">repr</span> <span class="o">::=</span> <span class="sc">&#39;o&#39;</span>                      <span class="c1">// ObjC metatype representation</span>
</span><span class="line"><span class="n">throws</span><span class="o">-</span><span class="n">annotation</span> <span class="o">::=</span> <span class="sc">&#39;z&#39;</span>                  <span class="c1">// &#39;throws&#39; annotation on function types</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;u&#39;</span> <span class="n">generic</span><span class="o">-</span><span class="n">signature</span> <span class="n">type</span>        <span class="c1">// generic type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;x&#39;</span>                               <span class="c1">// generic param, depth=0, idx=0</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;q&#39;</span> <span class="n">generic</span><span class="o">-</span><span class="n">param</span><span class="o">-</span><span class="n">index</span>           <span class="c1">// dependent generic parameter</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;q&#39;</span> <span class="n">type</span> <span class="n">assoc</span><span class="o">-</span><span class="n">type</span><span class="o">-</span><span class="n">name</span>          <span class="c1">// associated type of non-generic param</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;w&#39;</span> <span class="n">generic</span><span class="o">-</span><span class="n">param</span><span class="o">-</span><span class="n">index</span> <span class="n">assoc</span><span class="o">-</span><span class="n">type</span><span class="o">-</span><span class="n">name</span> <span class="c1">// associated type</span>
</span><span class="line"><span class="n">type</span> <span class="o">::=</span> <span class="sc">&#39;W&#39;</span> <span class="n">generic</span><span class="o">-</span><span class="n">param</span><span class="o">-</span><span class="n">index</span> <span class="n">assoc</span><span class="o">-</span><span class="n">type</span><span class="o">-</span><span class="n">name</span><span class="o">+</span> <span class="sc">&#39;_&#39;</span> <span class="c1">// associated type at depth</span>
</span><span class="line">
</span><span class="line"><span class="n">generic</span><span class="o">-</span><span class="n">param</span><span class="o">-</span><span class="n">index</span> <span class="o">::=</span> <span class="sc">&#39;x&#39;</span>                <span class="c1">// depth = 0,   idx = 0</span>
</span><span class="line"><span class="n">generic</span><span class="o">-</span><span class="n">param</span><span class="o">-</span><span class="n">index</span> <span class="o">::=</span> <span class="n">index</span>              <span class="c1">// depth = 0,   idx = N+1</span>
</span><span class="line"><span class="n">generic</span><span class="o">-</span><span class="n">param</span><span class="o">-</span><span class="n">index</span> <span class="o">::=</span> <span class="sc">&#39;d&#39;</span> <span class="n">index</span> <span class="n">index</span>    <span class="c1">// depth = M+1, idx = N</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<type> <type> <type>D <type>Z


<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">assoc</span><span class="o">-</span><span class="n">type</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="p">(</span><span class="sc">&#39;P&#39;</span> <span class="n">protocol</span><span class="o">-</span><span class="n">name</span><span class="p">)</span><span class="o">?</span> <span class="n">identifier</span>
</span><span class="line"><span class="n">assoc</span><span class="o">-</span><span class="n">type</span><span class="o">-</span><span class="n">name</span> <span class="o">::=</span> <span class="n">substitution</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
mangling
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">function</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span>
</span><span class="line">  <span class="n">impl</span><span class="o">-</span><span class="n">callee</span><span class="o">-</span><span class="n">convention</span> <span class="n">impl</span><span class="o">-</span><span class="n">function</span><span class="o">-</span><span class="n">attribute</span><span class="o">*</span> <span class="n">generic</span><span class="o">-</span><span class="n">signature</span><span class="o">?</span> <span class="sc">&#39;_&#39;</span>
</span><span class="line">  <span class="n">impl</span><span class="o">-</span><span class="n">parameter</span><span class="o">*</span> <span class="sc">&#39;_&#39;</span> <span class="n">impl</span><span class="o">-</span><span class="n">result</span><span class="o">*</span> <span class="sc">&#39;_&#39;</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">callee</span><span class="o">-</span><span class="n">convention</span> <span class="o">::=</span> <span class="sc">&#39;t&#39;</span>              <span class="c1">// thin</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">callee</span><span class="o">-</span><span class="n">convention</span> <span class="o">::=</span> <span class="n">impl</span><span class="o">-</span><span class="n">convention</span>  <span class="c1">// thick, callee transferred with given convention</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">convention</span> <span class="o">::=</span> <span class="sc">&#39;a&#39;</span>                     <span class="c1">// direct, autoreleased</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">convention</span> <span class="o">::=</span> <span class="sc">&#39;d&#39;</span>                     <span class="c1">// direct, no ownership transfer</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">convention</span> <span class="o">::=</span> <span class="sc">&#39;D&#39;</span>                     <span class="c1">// direct, no ownership transfer,</span>
</span><span class="line">                                            <span class="c1">// dependent on &#39;self&#39; parameter</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">convention</span> <span class="o">::=</span> <span class="sc">&#39;g&#39;</span>                     <span class="c1">// direct, guaranteed</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">convention</span> <span class="o">::=</span> <span class="sc">&#39;e&#39;</span>                     <span class="c1">// direct, deallocating</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">convention</span> <span class="o">::=</span> <span class="sc">&#39;i&#39;</span>                     <span class="c1">// indirect, ownership transfer</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">convention</span> <span class="o">::=</span> <span class="sc">&#39;l&#39;</span>                     <span class="c1">// indirect, inout</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">convention</span> <span class="o">::=</span> <span class="sc">&#39;G&#39;</span>                     <span class="c1">// indirect, guaranteed</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">convention</span> <span class="o">::=</span> <span class="sc">&#39;o&#39;</span>                     <span class="c1">// direct, ownership transfer</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">convention</span> <span class="o">::=</span> <span class="sc">&#39;z&#39;</span> <span class="n">impl</span><span class="o">-</span><span class="n">convention</span>     <span class="c1">// error result</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">function</span><span class="o">-</span><span class="n">attribute</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Cb</span><span class="err">&#39;</span>            <span class="c1">// compatible with C block invocation function</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">function</span><span class="o">-</span><span class="n">attribute</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Cc</span><span class="err">&#39;</span>            <span class="c1">// compatible with C global function</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">function</span><span class="o">-</span><span class="n">attribute</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Cm</span><span class="err">&#39;</span>            <span class="c1">// compatible with Swift method</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">function</span><span class="o">-</span><span class="n">attribute</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">CO</span><span class="err">&#39;</span>            <span class="c1">// compatible with ObjC method</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">function</span><span class="o">-</span><span class="n">attribute</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Cw</span><span class="err">&#39;</span>            <span class="c1">// compatible with protocol witness</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">function</span><span class="o">-</span><span class="n">attribute</span> <span class="o">::=</span> <span class="sc">&#39;N&#39;</span>             <span class="c1">// noreturn</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">function</span><span class="o">-</span><span class="n">attribute</span> <span class="o">::=</span> <span class="sc">&#39;G&#39;</span>             <span class="c1">// generic</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">parameter</span> <span class="o">::=</span> <span class="n">impl</span><span class="o">-</span><span class="n">convention</span> <span class="n">type</span>
</span><span class="line"><span class="n">impl</span><span class="o">-</span><span class="n">result</span> <span class="o">::=</span> <span class="n">impl</span><span class="o">-</span><span class="n">convention</span> <span class="n">type</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
manglings
<impl-function-attribute>CCCN
<type>

<h4></h4>
<p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">protocol</span><span class="o">-</span><span class="n">conformance</span> <span class="o">::=</span> <span class="p">(</span><span class="sc">&#39;u&#39;</span> <span class="n">generic</span><span class="o">-</span><span class="n">signature</span><span class="p">)</span><span class="o">?</span> <span class="n">type</span> <span class="n">protocol</span> <span class="n">module</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<protocol-conformance>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">generic</span><span class="o">-</span><span class="n">signature</span> <span class="o">::=</span> <span class="p">(</span><span class="n">generic</span><span class="o">-</span><span class="n">param</span><span class="o">-</span><span class="n">count</span><span class="o">+</span><span class="p">)</span><span class="o">?</span> <span class="p">(</span><span class="sc">&#39;R&#39;</span> <span class="n">requirement</span><span class="o">*</span><span class="p">)</span><span class="o">?</span> <span class="sc">&#39;r&#39;</span>
</span><span class="line"><span class="n">generic</span><span class="o">-</span><span class="n">param</span><span class="o">-</span><span class="n">count</span> <span class="o">::=</span> <span class="sc">&#39;z&#39;</span>       <span class="c1">// zero parameters</span>
</span><span class="line"><span class="n">generic</span><span class="o">-</span><span class="n">param</span><span class="o">-</span><span class="n">count</span> <span class="o">::=</span> <span class="n">index</span>     <span class="c1">// N+1 parameters</span>
</span><span class="line"><span class="n">requirement</span> <span class="o">::=</span> <span class="n">type</span><span class="o">-</span><span class="n">param</span> <span class="n">protocol</span><span class="o">-</span><span class="n">name</span> <span class="c1">// protocol requirement</span>
</span><span class="line"><span class="n">requirement</span> <span class="o">::=</span> <span class="n">type</span><span class="o">-</span><span class="n">param</span> <span class="n">type</span>          <span class="c1">// base class requirement</span>
</span><span class="line">                                         <span class="c1">// type starts with [CS]</span>
</span><span class="line"><span class="n">requirement</span> <span class="o">::=</span> <span class="n">type</span><span class="o">-</span><span class="n">param</span> <span class="sc">&#39;z&#39;</span> <span class="n">type</span>      <span class="c1">// &#39;z&#39;ame-type requirement</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Special type mangling for type params that saves the initial &#39;q&#39; on</span>
</span><span class="line"><span class="c1">// generic params</span>
</span><span class="line"><span class="n">type</span><span class="o">-</span><span class="n">param</span> <span class="o">::=</span> <span class="n">generic</span><span class="o">-</span><span class="n">param</span><span class="o">-</span><span class="n">index</span>       <span class="c1">// generic parameter</span>
</span><span class="line"><span class="n">type</span><span class="o">-</span><span class="n">param</span> <span class="o">::=</span> <span class="sc">&#39;w&#39;</span> <span class="n">generic</span><span class="o">-</span><span class="n">param</span><span class="o">-</span><span class="n">index</span> <span class="n">assoc</span><span class="o">-</span><span class="n">type</span><span class="o">-</span><span class="n">name</span> <span class="c1">// associated type</span>
</span><span class="line"><span class="n">type</span><span class="o">-</span><span class="n">param</span> <span class="o">::=</span> <span class="sc">&#39;W&#39;</span> <span class="n">generic</span><span class="o">-</span><span class="n">param</span><span class="o">-</span><span class="n">index</span> <span class="n">assoc</span><span class="o">-</span><span class="n">type</span><span class="o">-</span><span class="n">name</span><span class="o">+</span> <span class="sc">&#39;_&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
generic-param-count
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">urFq_q_</span>                           <span class="c1">// &lt;T_0_0&gt; T_0_0 -&gt; T_0_0</span>
</span><span class="line"><span class="n">u_0_rFq_qd_0_</span>                     <span class="c1">// &lt;T_0_0&gt;&lt;T_1_0, T_1_1&gt; T_0_0 -&gt; T_1_1</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4></h4>
<p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">al</span><span class="err">&#39;</span>           <span class="c1">// allocateBuffer</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">ca</span><span class="err">&#39;</span>           <span class="c1">// assignWithCopy</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">ta</span><span class="err">&#39;</span>           <span class="c1">// assignWithTake</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">de</span><span class="err">&#39;</span>           <span class="c1">// deallocateBuffer</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">xx</span><span class="err">&#39;</span>           <span class="c1">// destroy</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">XX</span><span class="err">&#39;</span>           <span class="c1">// destroyBuffer</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Xx</span><span class="err">&#39;</span>           <span class="c1">// destroyArray</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">CP</span><span class="err">&#39;</span>           <span class="c1">// initializeBufferWithCopyOfBuffer</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Cp</span><span class="err">&#39;</span>           <span class="c1">// initializeBufferWithCopy</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">cp</span><span class="err">&#39;</span>           <span class="c1">// initializeWithCopy</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">TK</span><span class="err">&#39;</span>           <span class="c1">// initializeBufferWithTakeOfBuffer</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Tk</span><span class="err">&#39;</span>           <span class="c1">// initializeBufferWithTake</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">tk</span><span class="err">&#39;</span>           <span class="c1">// initializeWithTake</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">pr</span><span class="err">&#39;</span>           <span class="c1">// projectBuffer</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">xs</span><span class="err">&#39;</span>           <span class="c1">// storeExtraInhabitant</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">xg</span><span class="err">&#39;</span>           <span class="c1">// getExtraInhabitantIndex</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Cc</span><span class="err">&#39;</span>           <span class="c1">// initializeArrayWithCopy</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Tt</span><span class="err">&#39;</span>           <span class="c1">// initializeArrayWithTakeFrontToBack</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">tT</span><span class="err">&#39;</span>           <span class="c1">// initializeArrayWithTakeBackToFront</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">ug</span><span class="err">&#39;</span>           <span class="c1">// getEnumTag</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">up</span><span class="err">&#39;</span>           <span class="c1">// destructiveProjectEnumData</span>
</span><span class="line"><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">ui</span><span class="err">&#39;</span>           <span class="c1">// destructiveInjectEnumTag</span>
</span><span class="line"><span class="o">&lt;</span><span class="n">value</span><span class="o">-</span><span class="n">witness</span><span class="o">-</span><span class="n">kind</span><span class="o">&gt;</span> <span class="n">differentiates</span> <span class="n">the</span> <span class="n">kinds</span> <span class="n">of</span> <span class="n">value</span> <span class="n">witness</span> <span class="n">functions</span> <span class="k">for</span> <span class="n">a</span> <span class="n">type</span><span class="p">.</span>
</span><span class="line">
</span><span class="line"><span class="n">Identifiers</span>
</span><span class="line">
</span><span class="line"><span class="n">identifier</span> <span class="o">::=</span> <span class="n">natural</span> <span class="n">identifier</span><span class="o">-</span><span class="n">start</span><span class="o">-</span><span class="kt">char</span> <span class="n">identifier</span><span class="o">-</span><span class="kt">char</span><span class="o">*</span>
</span><span class="line"><span class="n">identifier</span> <span class="o">::=</span> <span class="sc">&#39;o&#39;</span> <span class="n">operator</span><span class="o">-</span><span class="n">fixity</span> <span class="n">natural</span> <span class="n">operator</span><span class="o">-</span><span class="kt">char</span><span class="o">+</span>
</span><span class="line">
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="n">fixity</span> <span class="o">::=</span> <span class="sc">&#39;p&#39;</span>                    <span class="c1">// prefix operator</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="n">fixity</span> <span class="o">::=</span> <span class="sc">&#39;P&#39;</span>                    <span class="c1">// postfix operator</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="n">fixity</span> <span class="o">::=</span> <span class="sc">&#39;i&#39;</span>                    <span class="c1">// infix operator</span>
</span><span class="line">
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;a&#39;</span>                      <span class="c1">// &amp; &#39;and&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;c&#39;</span>                      <span class="c1">// @ &#39;commercial at&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;d&#39;</span>                      <span class="c1">// / &#39;divide&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;e&#39;</span>                      <span class="c1">// = &#39;equals&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;g&#39;</span>                      <span class="c1">// &gt; &#39;greater&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;l&#39;</span>                      <span class="c1">// &lt; &#39;less&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;m&#39;</span>                      <span class="c1">// * &#39;multiply&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;n&#39;</span>                      <span class="c1">// ! &#39;not&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;o&#39;</span>                      <span class="c1">// | &#39;or&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;p&#39;</span>                      <span class="c1">// + &#39;plus&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;q&#39;</span>                      <span class="c1">// ? &#39;question&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;r&#39;</span>                      <span class="c1">// % &#39;remainder&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;s&#39;</span>                      <span class="c1">// - &#39;subtract&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;t&#39;</span>                      <span class="c1">// ~ &#39;tilde&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;x&#39;</span>                      <span class="c1">// ^ &#39;xor&#39;</span>
</span><span class="line"><span class="n">operator</span><span class="o">-</span><span class="kt">char</span> <span class="o">::=</span> <span class="sc">&#39;z&#39;</span>                      <span class="c1">// . &#39;zperiod&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<identifier>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">identifier</span> <span class="o">::=</span> <span class="sc">&#39;X&#39;</span> <span class="n">natural</span> <span class="n">identifier</span><span class="o">-</span><span class="n">start</span><span class="o">-</span><span class="kt">char</span> <span class="n">identifier</span><span class="o">-</span><span class="kt">char</span><span class="o">*</span>
</span><span class="line"><span class="n">identifier</span> <span class="o">::=</span> <span class="sc">&#39;X&#39;</span> <span class="sc">&#39;o&#39;</span> <span class="n">operator</span><span class="o">-</span><span class="n">fixity</span> <span class="n">natural</span> <span class="n">identifier</span><span class="o">-</span><span class="kt">char</span><span class="o">*</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
ASCIIRFC 3492Punycode_AJ09XvergenzaX12vergenza_JFa Punycodevergenza-95A

ASCIIASCIIASCIIPunycodeXO+Xoi7p_qcaDcp_qcaDcP

<h4></h4>
<p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">substitution</span> <span class="o">::=</span> <span class="sc">&#39;S&#39;</span> <span class="n">index</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<substitution>
zim.zang.zungzim.zang.zungzim.zippity - &gt; zim.zang.zooZIMzim.zangZIMzim.zang.zungCC3zim4zang4zungZIMS_zim.zangS0_zim.zang.zungS1_CS1_ZIMCS_7zippity S2_zim.zangCS0_zooS3_fTCC3zim4zang4zungCS1_CS_7zippity_CS0_zoo
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">substitution</span> <span class="o">::=</span> <span class="sc">&#39;s&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
sSwift

<h4></h4>
<p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">module</span> <span class="o">::=</span> <span class="sc">&#39;s&#39;</span>                       <span class="c1">// Swift</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">module</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">SC</span><span class="err">&#39;</span>                      <span class="c1">// C</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">module</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">So</span><span class="err">&#39;</span>                      <span class="c1">// Objective-C</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Sa</span><span class="err">&#39;</span>                <span class="c1">// Swift.Array</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Sb</span><span class="err">&#39;</span>                <span class="c1">// Swift.Bool</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Sc</span><span class="err">&#39;</span>                <span class="c1">// Swift.UnicodeScalar</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Sd</span><span class="err">&#39;</span>                <span class="c1">// Swift.Float64</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Sf</span><span class="err">&#39;</span>                <span class="c1">// Swift.Float32</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Si</span><span class="err">&#39;</span>                <span class="c1">// Swift.Int</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">SP</span><span class="err">&#39;</span>                <span class="c1">// Swift.UnsafePointer</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Sp</span><span class="err">&#39;</span>                <span class="c1">// Swift.UnsafeMutablePointer</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">SQ</span><span class="err">&#39;</span>                <span class="c1">// Swift.ImplicitlyUnwrappedOptional</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Sq</span><span class="err">&#39;</span>                <span class="c1">// Swift.Optional</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">SR</span><span class="err">&#39;</span>                <span class="c1">// Swift.UnsafeBufferPointer</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Sr</span><span class="err">&#39;</span>                <span class="c1">// Swift.UnsafeMutableBufferPointer</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">SS</span><span class="err">&#39;</span>                <span class="c1">// Swift.String</span>
</span><span class="line"><span class="n">known</span><span class="o">-</span><span class="n">nominal</span><span class="o">-</span><span class="n">type</span> <span class="o">::=</span> <span class="err">&#39;</span><span class="n">Su</span><span class="err">&#39;</span>                <span class="c1">// Swift.UInt</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<known-module>  <known-nominal-type>&#8217;S&#8217;
Objective-CObjective-C<type>

<h4></h4>
<p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">index</span> <span class="o">::=</span> <span class="sc">&#39;_&#39;</span>                              <span class="c1">// 0</span>
</span><span class="line"><span class="n">index</span> <span class="o">::=</span> <span class="n">natural</span> <span class="sc">&#39;_&#39;</span>                      <span class="c1">// N+1</span>
</span><span class="line"><span class="n">natural</span> <span class="o">::=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<index>;


<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
</index></p></type></known-nominal-type></known-module></p></substitution></p></identifier></p></protocol-conformance></p></type></impl-function-attribute></type></type></type></type></p></></reabstract-signature></private-decl-name></private-decl-name></p></li></ul></p></li></ul></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2015/01/14/zhe-xie-nian-wo-de-bu-zu/"/>
    <updated>2015-01-14T17:54:14+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2015/01/14/zhe-xie-nian-wo-de-bu-zu</id>
    <content type="html"><![CDATA[<p></p>
<p></p>
<h3></h3>
<!-- more-->
<p></p>
<p></p>
<h3></h3>
<p></p>
<p></p>
<h3></h3>
<p></p>
<p>ADDB,C</p>
<h3></h3>
<p></p>
<h3></h3>
<p></p>
<p></p>
<h3></h3>
<p></p>
<p></p>
<h3></h3>
<p></p>
<p>The world is trying to keep you stupid</p>
<h3></h3>
<p>B2C(cdn)</p>
<p></p>
<h3></h3>
<p></p>
<p></p>
<h3></h3>
<p></p>
<p></p>
<h3></h3>
<p></p>
<p>open party</p>
<p></p>
<h3></h3>
<p></p>
<p></p>

<p>PS:</p>
<hr />

<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swift]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2014/09/18/swiftde-qiang-da-zhi-chu/"/>
    <updated>2014-09-18T13:38:34+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2014/09/18/swiftde-qiang-da-zhi-chu</id>
    <content type="html"><![CDATA[<p> Swift Cocoa  SwiftObjective-C  Haskell  ( Swift ) Swift </p>

<p> iOS/Mac  Haskell ()  Haskell  Objective-C iOS  Objective-C </p>

<p> WWDC  Swift  Swift  Cocoa API  Haskell  Objective-C API  Objective-C </p>

<p> Utrecht  (moandsapplicative functors ) </p>

<p> Objective-C  &#8211; </p>

<p></p>

<p>/</p>

<p></p>

<h2></h2>
<!-- more-->
<p> Swift  optionals Optionals  Objective-C  nil Optionals  nil nil</p>

<p> Objective-C </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="n">NSAttributedString</span> <span class="o">*</span><span class="p">)</span><span class="nf">attributedString:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">input</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">[[</span><span class="n">NSAttributedString</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithString:</span><span class="n">input</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>input</code>  nil, </p>

<p> Swift  API </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">extension</span> <span class="n">NSAttributedString</span> <span class="p">{</span>
</span><span class="line">    <span class="n">init</span><span class="p">(</span><span class="n">string</span> <span class="nl">str:</span> <span class="n">String</span><span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Objective-C Swift  <code>nil</code> API </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">extension</span> <span class="n">NSAttributedString</span> <span class="p">{</span>
</span><span class="line">    <span class="n">init</span><span class="p">(</span><span class="n">string</span> <span class="nl">str:</span> <span class="n">String</span><span class="o">?</span><span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> nil optionals </p>

<h2></h2>

<p> optionalsOptionals  API  optional  #00ff00  <code>nil</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">parseColorFromHexString</span><span class="p">(</span><span class="nl">input:</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UIColor</span><span class="o">?</span> <span class="p">{</span>
</span><span class="line">    <span class="c1">// ...</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>Either</code>  <code>Result</code>  ()<a href="http://nomothetis.svbtle.com/error-handling-in-swift">Error Handling in Swift</a> </p>

<h2 id="enums">Enums</h2>

<p>Enums  Swift  Objective-C  Objective-C  enums, </p>

<p> &#8211; true  false &#8211;  &#8211; <strong></strong> true  false </p>

<p> optionals <code>nil</code>  Swift  optional  enums optional enum </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">enum</span> <span class="n">Boolean</span> <span class="p">{</span>
</span><span class="line">    <span class="k">case</span> <span class="n">False</span>
</span><span class="line">    <span class="k">case</span> <span class="n">True</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">enum</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class="line">    <span class="k">case</span> <span class="n">Nil</span>
</span><span class="line">    <span class="k">case</span> <span class="n">Some</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> optional  <code>Nil</code>   <code>Either</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">enum</span> <span class="n">Either</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class="line">    <span class="k">case</span> <span class="n">Left</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span>
</span><span class="line">    <span class="k">case</span> <span class="n">Right</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>Either</code>  <code>Either&lt;Int, NSError&gt;</code> <code>Either&lt;Bool,String&gt;</code> </p>

<blockquote>
  <p> enums  <strong>sum </strong> <code>Either</code>  <code>A</code>  <code>B</code> Structs  tuples  <strong>product </strong><a href="http://en.wikipedia.org/wiki/Algebraic_data_type">algebraic data types.</a></p>
</blockquote>

<p> enums  ( <a href="http://objccn.io/issue-16-2">class  structs</a>)enum  Github API  wrapper enum  <code>/zen</code>  API </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">enum</span> <span class="n">Github</span> <span class="p">{</span>
</span><span class="line">    <span class="k">case</span> <span class="n">Zen</span>
</span><span class="line">    <span class="k">case</span> <span class="n">UserProfile</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
</span><span class="line">    <span class="k">case</span> <span class="n">Repositories</span><span class="p">(</span><span class="nl">username:</span> <span class="n">String</span><span class="p">,</span> <span class="nl">sortAscending:</span> <span class="n">Bool</span><span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> API  enum API  switch  enum </p>

<p> enum  <code>Bool</code>  <code>Optional</code>  &#8211;  </p>

<p> enum</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">enum</span> <span class="n">Currency</span> <span class="p">{</span>
</span><span class="line">    <span class="k">case</span> <span class="n">Eur</span>
</span><span class="line">    <span class="k">case</span> <span class="n">Usd</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">symbol</span><span class="p">(</span><span class="nl">input:</span> <span class="n">Currency</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="p">{</span>
</span><span class="line">    <span class="k">switch</span> <span class="n">input</span> <span class="p">{</span>
</span><span class="line">        <span class="k">case</span> <span class="p">.</span><span class="nl">Eur:</span> <span class="k">return</span> <span class="s">&quot;&quot;</span>
</span><span class="line">        <span class="k">case</span> <span class="p">.</span><span class="nl">Usd:</span> <span class="k">return</span> <span class="s">&quot;$&quot;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>symbol</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">format</span><span class="p">(</span><span class="nl">amount:</span> <span class="n">Double</span><span class="p">,</span> <span class="nl">currency:</span> <span class="n">Currency</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="p">{</span>
</span><span class="line">    <span class="n">let</span> <span class="n">formatter</span> <span class="o">=</span> <span class="n">NSNumberFormatter</span><span class="p">()</span>
</span><span class="line">    <span class="n">formatter</span><span class="p">.</span><span class="n">numberStyle</span> <span class="o">=</span> <span class="p">.</span><span class="n">CurrencyStyle</span>
</span><span class="line">    <span class="n">formatter</span><span class="p">.</span><span class="n">currencySymbol</span> <span class="o">=</span> <span class="n">symbol</span><span class="p">(</span><span class="n">currency</span><span class="p">)</span>
</span><span class="line">    <span class="k">return</span> <span class="n">formatter</span><span class="p">.</span><span class="n">stringFromNumber</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> API  Objective-C  Objective-C  Swift  <code>class</code>  <code>enum</code>  ( Objetive-C  Swift  protocol </p>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">protocol</span> <span class="n">CurrencySymbol</span> <span class="p">{</span>
</span><span class="line">    <span class="n">func</span> <span class="n">symbol</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">String</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>Currency</code>  <code>input</code>  self </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">extension</span> <span class="n">Currency</span> <span class="o">:</span> <span class="n">CurrencySymbol</span> <span class="p">{</span>
</span><span class="line">   <span class="n">func</span> <span class="n">symbol</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="p">{</span>
</span><span class="line">        <span class="k">switch</span> <span class="n">self</span> <span class="p">{</span>
</span><span class="line">            <span class="k">case</span> <span class="p">.</span><span class="nl">Eur:</span> <span class="k">return</span> <span class="s">&quot;&quot;</span>
</span><span class="line">            <span class="k">case</span> <span class="p">.</span><span class="nl">Usd:</span> <span class="k">return</span> <span class="s">&quot;$&quot;</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>format</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">format</span><span class="p">(</span><span class="nl">amount:</span> <span class="n">Double</span><span class="p">,</span> <span class="nl">currency:</span> <span class="n">CurrencySymbol</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="p">{</span>
</span><span class="line">    <span class="n">let</span> <span class="n">formatter</span> <span class="o">=</span> <span class="n">NSNumberFormatter</span><span class="p">()</span>
</span><span class="line">    <span class="n">formatter</span><span class="p">.</span><span class="n">numberStyle</span> <span class="o">=</span> <span class="p">.</span><span class="n">CurrencyStyle</span>
</span><span class="line">    <span class="n">formatter</span><span class="p">.</span><span class="n">currencySymbol</span> <span class="o">=</span> <span class="n">currency</span><span class="p">.</span><span class="n">symbol</span><span class="p">()</span>
</span><span class="line">    <span class="k">return</span> <span class="n">formatter</span><span class="p">.</span><span class="n">stringFromNumber</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> &#8211;  <code>CurrencySymbol</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">struct</span> <span class="n">Bitcoin</span> <span class="o">:</span> <span class="n">CurrencySymbol</span> <span class="p">{</span>
</span><span class="line">    <span class="n">func</span> <span class="n">symbol</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="p">{</span>
</span><span class="line">        <span class="k">return</span> <span class="s">&quot;B&quot;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> API  enum  API</p>

<h2></h2>

<p> Swift  optionals Swift  bug( <code>Either</code> )</p>

<p> <code>Double</code> 100.0  100 100  100 </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">struct</span> <span class="n">Money</span> <span class="p">{</span>
</span><span class="line">    <span class="n">let</span> <span class="n">amount</span> <span class="o">:</span> <span class="n">Double</span>
</span><span class="line">    <span class="n">let</span> <span class="nl">currency:</span> <span class="n">Currency</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">struct</span> <span class="n">Mass</span> <span class="p">{</span>
</span><span class="line">    <span class="n">let</span> <span class="nl">kilograms:</span> <span class="n">Double</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>Money</code>   <code>Mass</code>  <code>pounds</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">pounds</span><span class="p">(</span><span class="nl">input:</span> <span class="n">Double</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Double</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> ( pound)  ()</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">pounds</span><span class="p">(</span><span class="nl">input:</span> <span class="n">Mass</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Double</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>Money</code>  <code>Double</code></p>

<h2></h2>

<p>Swift  Cocoa  API <a href="http://nomothetis.svbtle.com/error-handling-in-swift">Error Handling in Swift</a>  Cocoa  (<code>NSString</code> vs. <code>NSMutableString</code><code>NSArray</code> vs. <code>NSMutableArray</code>)</p>

<p> Swifit </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">var</span> <span class="n">myString</span> <span class="o">=</span> <span class="s">&quot;Hello&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">let</span> <span class="n">myString</span> <span class="o">=</span> <span class="s">&quot;Hello&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> API  Swift </p>

<p> Objective-C  OS X  <code>CIFilter</code> <code>setDefaults</code> </p>

<p><code>map</code>  <code>T</code>  <code>T</code>  <code>U</code>  <code>U</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">U</span><span class="o">&gt;</span><span class="p">(</span><span class="nl">x:</span> <span class="n">T</span><span class="o">?</span><span class="p">,</span> <span class="nl">f:</span> <span class="n">T</span> <span class="o">-&gt;</span> <span class="n">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">U</span><span class="o">?</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>map</code>  <code>self</code> <code>T</code>  <code>U</code> <code>U</code> l</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">extension</span> <span class="n">Array</span> <span class="p">{</span>
</span><span class="line">    <span class="n">func</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="p">(</span><span class="nl">transform:</span> <span class="n">T</span> <span class="o">-&gt;</span> <span class="n">U</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">U</span><span class="p">]</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2></h2>

<p>Swift </p>

<p>Swift  Objective-C  Swift </p>

<hr />
<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SwiftAPI]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2014/09/18/swiftde-han-shu-shi-api/"/>
    <updated>2014-09-18T10:19:05+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2014/09/18/swiftde-han-shu-shi-api</id>
    <content type="html"><![CDATA[<p> API  FoundationCocoaCocoa Touch  API  Objective-C </p>

<p> Swift  API  Swift  Swift  Objective-C Swift  Swift  <a href="https://twitter.com/clattner_llvm">Chris Lattner</a> </p>

<blockquote>
  <p>Swift </p>
</blockquote>

<p> <code>Core Image</code>  API  API  <code>Core Image</code>  API  <code>Core Image</code>  API  -  (key-value)  API </p>

<h2></h2>

<p> API </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">let</span> <span class="n">myFilter</span> <span class="o">=</span> <span class="n">blur</span><span class="p">(</span><span class="n">blurRadius</span><span class="p">)</span> <span class="o">&gt;|&gt;</span> <span class="n">colorOverlay</span><span class="p">(</span><span class="n">overlayColor</span><span class="p">)</span>
</span><span class="line"><span class="n">let</span> <span class="n">result</span> <span class="o">=</span> <span class="n">myFilter</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> Swift  Github <a href="https://github.com/objcio/issue-16-functional-apis"></a></p>

<h2 id="filter">Filter </h2>

<p><code>CIFilter</code>  <code>Core Image</code>  <code>CIFilter</code>  ()  <code>kCIInputImageKey</code>  <code>kCIOutputImageKey</code> </p>

<p> API  (key-value)  API <code>Filter</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">typealias</span> <span class="n">Filter</span> <span class="o">=</span> <span class="n">CIImage</span> <span class="o">-&gt;</span> <span class="n">CIImage</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<!-- more-->
<p> <code>typealias</code>  <code>CIImage -&gt; CIImage</code> <code>CIImage</code>  <code>CIImage</code> </p>

<p> <code>Filter</code>  <code>FilterFunction</code>  <code>Filter</code> </p>

<h2></h2>

<p> <code>Filter</code>  <code>Filter</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">myFilter</span><span class="p">(</span><span class="cm">/* parameters */</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>Filter</code> </p>

<p> <code>CIFilter</code>  convenience </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">typealias</span> <span class="n">Parameters</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">AnyObject</span><span class="o">&gt;</span>
</span><span class="line">
</span><span class="line"><span class="n">extension</span> <span class="n">CIFilter</span> <span class="p">{</span>
</span><span class="line">
</span><span class="line">    <span class="n">convenience</span> <span class="n">init</span><span class="p">(</span><span class="nl">name:</span> <span class="n">String</span><span class="p">,</span> <span class="nl">parameters:</span> <span class="n">Parameters</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="n">self</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="nl">name:</span> <span class="n">name</span><span class="p">)</span>
</span><span class="line">        <span class="n">setDefaults</span><span class="p">()</span>
</span><span class="line">        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">:</span> <span class="n">AnyObject</span><span class="p">)</span> <span class="k">in</span> <span class="n">parameters</span> <span class="p">{</span>
</span><span class="line">            <span class="n">setValue</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nl">forKey:</span> <span class="n">key</span><span class="p">)</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">
</span><span class="line">    <span class="n">var</span> <span class="nl">outputImage:</span> <span class="n">CIImage</span> <span class="p">{</span> <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">valueForKey</span><span class="p">(</span><span class="n">kCIOutputImageKey</span><span class="p">)</span> <span class="n">as</span> <span class="n">CIImage</span> <span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> convenience  convenience  Swift </p>

<p> <code>outputImage</code>  <code>kCIOutputImageKey</code>  <code>CIImage</code>  API </p>

<h2></h2>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">blur</span><span class="p">(</span><span class="nl">radius:</span> <span class="n">Double</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">{</span> <span class="n">image</span> <span class="k">in</span>
</span><span class="line">        <span class="n">let</span> <span class="n">parameters</span> <span class="o">:</span> <span class="n">Parameters</span> <span class="o">=</span> <span class="p">[</span><span class="nl">kCIInputRadiusKey:</span> <span class="n">radius</span><span class="p">,</span> <span class="nl">kCIInputImageKey:</span> <span class="n">image</span><span class="p">]</span>
</span><span class="line">        <span class="n">let</span> <span class="n">filter</span> <span class="o">=</span> <span class="n">CIFilter</span><span class="p">(</span><span class="nl">name:</span><span class="s">&quot;CIGaussianBlur&quot;</span><span class="p">,</span> <span class="nl">parameters:</span><span class="n">parameters</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="n">filter</span><span class="p">.</span><span class="n">outputImage</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>CIImage</code>  (<code>filter.outputImage</code>)   <code>CIImage -&gt; CIImage</code>  <code>Filter</code> </p>

<p> <code>Core Image</code> </p>

<h2></h2>

<p> <code>Core Image</code> </p>

<p> (<code>CIConstantColorGenerator</code>) (<code>CISourceOverCompositing</code>)</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">colorGenerator</span><span class="p">(</span><span class="nl">color:</span> <span class="n">UIColor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
</span><span class="line">        <span class="n">let</span> <span class="n">filter</span> <span class="o">=</span> <span class="n">CIFilter</span><span class="p">(</span><span class="nl">name:</span><span class="s">&quot;CIConstantColorGenerator&quot;</span><span class="p">,</span> <span class="nl">parameters:</span> <span class="p">[</span><span class="nl">kCIInputColorKey:</span> <span class="n">color</span><span class="p">])</span>
</span><span class="line">        <span class="k">return</span> <span class="n">filter</span><span class="p">.</span><span class="n">outputImage</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>_</code>  filter </p>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">compositeSourceOver</span><span class="p">(</span><span class="nl">overlay:</span> <span class="n">CIImage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">{</span> <span class="n">image</span> <span class="k">in</span>
</span><span class="line">        <span class="n">let</span> <span class="n">parameters</span> <span class="o">:</span> <span class="n">Parameters</span> <span class="o">=</span> <span class="p">[</span>
</span><span class="line">            <span class="nl">kCIInputBackgroundImageKey:</span> <span class="n">image</span><span class="p">,</span>
</span><span class="line">            <span class="nl">kCIInputImageKey:</span> <span class="n">overlay</span>
</span><span class="line">        <span class="p">]</span>
</span><span class="line">        <span class="n">let</span> <span class="n">filter</span> <span class="o">=</span> <span class="n">CIFilter</span><span class="p">(</span><span class="nl">name:</span><span class="s">&quot;CISourceOverCompositing&quot;</span><span class="p">,</span> <span class="nl">parameters:</span> <span class="n">parameters</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="n">filter</span><span class="p">.</span><span class="n">outputImage</span><span class="p">.</span><span class="n">imageByCroppingToRect</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">extent</span><span class="p">())</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">colorOverlay</span><span class="p">(</span><span class="nl">color:</span> <span class="n">UIColor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">{</span> <span class="n">image</span> <span class="k">in</span>
</span><span class="line">        <span class="n">let</span> <span class="n">overlay</span> <span class="o">=</span> <span class="n">colorGenerator</span><span class="p">(</span><span class="n">color</span><span class="p">)(</span><span class="n">image</span><span class="p">)</span>
</span><span class="line">        <span class="k">return</span> <span class="n">compositeSourceOver</span><span class="p">(</span><span class="n">overlay</span><span class="p">)(</span><span class="n">image</span><span class="p">)</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><code>colorOverlay</code>  <code>colorGenerator</code> <code>colorGenerator</code>  <code>colorGenerator(color)</code>  <code>Filter</code>  <code>Filter</code>  <code>CIImage</code>  <code>CIImage</code>  <code>colorGenerator(color)</code>  <code>CIImage</code>  <code>CIImage</code>  <code>overlay</code>  <code>colorGenerator</code>  <code>compositeSourceOver(overlay)(image)</code>  <code>compositeSourceOver(overlay)</code>  <code>image</code> </p>

<h2></h2>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">let</span> <span class="n">url</span> <span class="o">=</span> <span class="n">NSURL</span><span class="p">(</span><span class="nl">string:</span> <span class="s">&quot;http://tinyurl.com/m74sldb&quot;</span><span class="p">);</span>
</span><span class="line"><span class="n">let</span> <span class="n">image</span> <span class="o">=</span> <span class="n">CIImage</span><span class="p">(</span><span class="nl">contentsOfURL:</span> <span class="n">url</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">let</span> <span class="n">blurRadius</span> <span class="o">=</span> <span class="mf">5.0</span>
</span><span class="line"><span class="n">let</span> <span class="n">overlayColor</span> <span class="o">=</span> <span class="n">UIColor</span><span class="p">.</span><span class="n">redColor</span><span class="p">().</span><span class="n">colorWithAlphaComponent</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span><span class="line"><span class="n">let</span> <span class="n">blurredImage</span> <span class="o">=</span> <span class="n">blur</span><span class="p">(</span><span class="n">blurRadius</span><span class="p">)(</span><span class="n">image</span><span class="p">)</span>
</span><span class="line"><span class="n">let</span> <span class="n">overlaidImage</span> <span class="o">=</span> <span class="n">colorOverlay</span><span class="p">(</span><span class="n">overlayColor</span><span class="p">)(</span><span class="n">blurredImage</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>blur(blurRadius)</code> </p>

<h2></h2>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">let</span> <span class="n">result</span> <span class="o">=</span> <span class="n">colorOverlay</span><span class="p">(</span><span class="n">overlayColor</span><span class="p">)(</span><span class="n">blur</span><span class="p">(</span><span class="n">blurRadius</span><span class="p">)(</span><span class="n">image</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="n">composeFilters</span><span class="p">(</span><span class="nl">filter1:</span> <span class="n">Filter</span><span class="p">,</span> <span class="nl">filter2:</span> <span class="n">Filter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">{</span> <span class="n">img</span> <span class="k">in</span> <span class="n">filter2</span><span class="p">(</span><span class="n">filter1</span><span class="p">(</span><span class="n">img</span><span class="p">))</span> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><code>composeFilters</code>  Filter  Filter  <code>CIImage</code>  <code>filter1</code>  <code>filter2</code>  <code>composeFilters</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">let</span> <span class="n">myFilter</span> <span class="o">=</span> <span class="n">composeFilters</span><span class="p">(</span><span class="n">blur</span><span class="p">(</span><span class="n">blurRadius</span><span class="p">),</span> <span class="n">colorOverlay</span><span class="p">(</span><span class="n">overlayColor</span><span class="p">))</span>
</span><span class="line"><span class="n">let</span> <span class="n">result</span> <span class="o">=</span> <span class="n">myFilter</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">infix</span> <span class="n">operator</span> <span class="o">&gt;|&gt;</span> <span class="p">{</span> <span class="n">associativity</span> <span class="n">left</span> <span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">func</span> <span class="o">&gt;|&gt;</span> <span class="p">(</span><span class="nl">filter1:</span> <span class="n">Filter</span><span class="p">,</span> <span class="nl">filter2:</span> <span class="n">Filter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">{</span> <span class="n">img</span> <span class="k">in</span> <span class="n">filter2</span><span class="p">(</span><span class="n">filter1</span><span class="p">(</span><span class="n">img</span><span class="p">))</span> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>infix</code>  <code></code>  <code></code> <code>associativity left</code> f1 &gt;|&gt; f2 &gt;|&gt; f3  (f1 &gt;|&gt; f2) &gt;|&gt; f3 Unix </p>

<p> <code>composeFilters</code>  <code>&gt;|&gt;</code></p>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">let</span> <span class="n">myFilter</span> <span class="o">=</span> <span class="n">blur</span><span class="p">(</span><span class="n">blurRadius</span><span class="p">)</span> <span class="o">&gt;|&gt;</span> <span class="n">colorOverlay</span><span class="p">(</span><span class="n">overlayColor</span><span class="p">)</span>
</span><span class="line"><span class="n">let</span> <span class="n">result</span> <span class="o">=</span> <span class="n">myFilter</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>1 + 2 + 3 + 4</code>  <code>add(add(add(1, 2), 3), 4)</code> </p>

<h2></h2>

<p> Objective-C  Swift  C++  () </p>

<p> <code>&gt;|&gt;</code> </p>

<p><a href="http://en.wikipedia.org/wiki/Function_composition_%28computer_science%29"></a> <code>f</code>  <code>g</code>  <code>f  g</code> <code>x</code>  <code>f(g(x))</code>  <code>&gt;|&gt;</code>  () </p>

<h2></h2>

<p> <code>&gt;|&gt;</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="o">&gt;|&gt;</span> <span class="p">(</span><span class="nl">filter1:</span> <span class="n">Filter</span><span class="p">,</span> <span class="nl">filter2:</span> <span class="n">Filter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Filter</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>Filter</code> </p>

<p> Swift </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="o">&gt;|&gt;</span> <span class="o">&lt;</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="o">&gt;</span><span class="p">(</span><span class="nl">lhs:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="p">,</span> <span class="nl">rhs:</span> <span class="n">B</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">C</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">{</span> <span class="n">x</span> <span class="k">in</span> <span class="n">rhs</span><span class="p">(</span><span class="n">lhs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> &#8211; </p>

<p>AB  C</p>

<p>lhs (left-hand side ) A -&gt; B  A Brhs (right-hand side ) B -&gt; C  lhs  rhs</p>

<p> <code>Filter</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">func</span> <span class="o">&gt;|&gt;</span> <span class="p">(</span><span class="nl">filter1:</span> <span class="n">CIImage</span> <span class="o">-&gt;</span> <span class="n">CIImage</span><span class="p">,</span> <span class="nl">filter2:</span> <span class="n">CIImage</span> <span class="o">-&gt;</span> <span class="n">CIImage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CIImage</span> <span class="o">-&gt;</span> <span class="n">CIImage</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> ABC  <code>CIImage</code></p>

<h2></h2>

<p> API  <code>Core Image</code> Objective-C  API  Swift</p>

<hr />
<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2014/08/04/ioshui-tu-xiang-xi-jie-xi/"/>
    <updated>2014-08-04T15:05:26+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2014/08/04/ioshui-tu-xiang-xi-jie-xi</id>
    <content type="html"><![CDATA[<div id="cnblogs_post_body"><p><span style="font-family: 'comic sans ms', sans-serif;"><a href="http://www.amazon.com/Programming-iOS-Fundamentals-iPhone-Development/dp/1449319343/ref=sr_1_3?ie=UTF8&amp;qid=1357784362&amp;sr=8-3&amp;keywords=ios" target="_blank">Programming iOS5</a>Drawing</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp; &nbsp; &nbsp; Core Graphics FrameworkCAPIQuartz2DPDF<a href="http://developer.apple.com/library/ios/samplecode/QuartzDemo/Introduction/Intro.html#//apple_ref/doc/uid/DTS40007531">example code</a><span><br />
</span></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp; &nbsp; &nbsp;iOSAPICore Graphics/QuartZ 2D OpenGL ESOpenGL ESAPIOpenGLQuartZ 2DAPICore Graphics FrameworkOpenGL ES<strong></strong>Open GL ESOpenGL ES</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp;Core Graphics API</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>UIGraphicsBeginImageContextWithOptions</strong><strong>UIGraphicsGetImageFromCurrentImageContext</strong>UIImage<strong>UIGraphicsEndImageContext</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">cocoaUIView<strong>drawRect</strong><strong>drawRect</strong>CocoaUIView</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<ul>
     <li><span style="font-family: 'comic sans ms', sans-serif;"><strong>UIGraphicsBeginImageContextWithOptions</strong></span></li>
     <li><span style="font-family: 'comic sans ms', sans-serif;"><strong>drawRect</strong>UIView</span></li>
     <li><span style="font-family: 'comic sans ms', sans-serif;">context</span></li>
</ul>
<p><span style="font-family: 'comic sans ms', sans-serif;">UIKitCore Graphics</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">UIKit</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">UIImageNSStringUIBezierPathUIColorUIKit</span></p>
<p>UiKit<span style="color: #ff0000;"></span></p>
<p><strong>UIGraphicsBeginImageContextWithOptions</strong><strong>drawRect</strong>UIKitcontextUIKit<strong>UIGraphicsPushContext</strong> context<strong>UIGraphicsPopContext</strong></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">Core Graphics</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">APIQuartZQuartZ 2DCore GraphicsiOSUIKit</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">Core GraphicsCGContextRefcontext<strong>UIGraphicsBeginImageContextWithOptions</strong><strong>drawRect</strong>Core Graphics<strong>UIGraphicsGetCurrentContext</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>drawRect:</strong><strong>drawRect: inContext:</strong><strong>UIGraphicsBeginImageContextWithOptions</strong><strong></strong>66UIKitCore Graphics</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">UIViewdrawRect<strong>UIKit</strong>Cocoa</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">drawRect:</span> <span class="p">(</span><span class="n">CGRect</span><span class="p">)</span> <span class="n">rect</span> <span class="p">{</span>
</span><span class="line">	<span class="n">UIBezierPath</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="nl">UIBezierPathbezierPathWithOvalInRect:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)];</span>
</span><span class="line">	<span class="p">[[</span><span class="n">UIColor</span> <span class="n">blueColor</span><span class="p">]</span> <span class="n">setFill</span><span class="p">];</span>
</span><span class="line">	<span class="p">[</span><span class="n">p</span> <span class="n">fill</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<!-- more-->
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp; &nbsp;Core Graphics</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">drawRect:</span> <span class="p">(</span><span class="n">CGRect</span><span class="p">)</span> <span class="n">rect</span> <span class="p">{</span>
</span><span class="line"><span class="n">CGContextRef</span> <span class="n">con</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line"><span class="n">CGContextAddEllipseInRect</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">));</span>
</span><span class="line"><span class="n">CGContextSetFillColorWithColor</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">blueColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextFillPath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp;UIView<strong>drawLayer:inContext</strong><strong></strong><strong>drawLayer:inContext</strong><strong></strong><strong>drawLayer:inContext</strong><strong></strong>UIViewUIViewMyView.h</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@interface</span> <span class="nc">MyLayerDelegate</span> : <span class="nc">NSObject</span>
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp; &nbsp; &nbsp; &nbsp; MyView.m</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@implementation</span> <span class="nc">MyLayerDelegate</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawLayer:</span><span class="p">(</span><span class="n">CALayer</span><span class="o">*</span><span class="p">)</span><span class="nv">layer</span> <span class="nf">inContext:</span><span class="p">(</span><span class="n">CGContextRef</span><span class="p">)</span><span class="nv">ctx</span> <span class="p">{</span>
</span><span class="line">  <span class="n">UIGraphicsPushContext</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
</span><span class="line">  <span class="n">UIBezierPath</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIBezierPath</span> <span class="nl">bezierPathWithOvalInRect:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)];</span>
</span><span class="line">  <span class="p">[[</span><span class="n">UIColor</span> <span class="n">blueColor</span><span class="p">]</span> <span class="n">setFill</span><span class="p">];</span>
</span><span class="line">  <span class="p">[</span><span class="n">p</span> <span class="n">fill</span><span class="p">];</span>
</span><span class="line">  <span class="n">UIGraphicsPopContext</span><span class="p">();</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;">MyView.m#importUIKit</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">assignMyLayerDelegateMyView.mstrong:</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@interface</span> <span class="nc">MyView</span> <span class="p">()</span> <span class="p">{</span>
</span><span class="line"><span class="n">MyLayerDelegate</span><span class="o">*</span> <span class="n">_layerDeleagete</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;"><span style="line-height: 18px;">&nbsp; &nbsp; </span></span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">MyView</span> <span class="o">*</span><span class="n">myView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">MyView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">480</span><span class="p">)];</span>
</span><span class="line"><span class="n">CALayer</span> <span class="o">*</span><span class="n">myLayer</span> <span class="o">=</span> <span class="p">[</span><span class="n">CALayer</span> <span class="n">layer</span><span class="p">];</span>
</span><span class="line"><span class="n">_layerDelegate</span> <span class="o">=</span> <span class="p">[[</span><span class="n">MyLayerDelegate</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class="line"><span class="n">myLayer</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">_layerDelegate</span><span class="p">;</span>
</span><span class="line"><span class="p">[</span><span class="n">myView</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addSublayer:</span><span class="n">myLayer</span><span class="p">];</span>
</span><span class="line"><span class="p">[</span><span class="n">myView</span> <span class="n">setNeedsDisplay</span><span class="p">];</span> <span class="c1">// drawLayer: inContext:</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;"> Core Graphics<strong>drawLayer:inContext</strong><strong></strong></span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawLayer:</span><span class="p">(</span><span class="n">CALayer</span><span class="o">*</span><span class="p">)</span><span class="nv">lay</span> <span class="nf">inContext:</span><span class="p">(</span><span class="n">CGContextRef</span><span class="p">)</span><span class="nv">con</span> <span class="p">{</span>
</span><span class="line">	<span class="n">CGContextAddEllipseInRect</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">));</span>
</span><span class="line">	<span class="n">CGContextSetFillColorWithColor</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">blueColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextFillPath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>UIGraphicsBeginImageContextWithOptions</strong>UIImageUIImage</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"> UIKit</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">UIGraphicsBeginImageContextWithOptions</span><span class="p">(</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">NO</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="n">UIBezierPath</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIBezierPath</span> <span class="nl">bezierPathWithOvalInRect:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)];</span>
</span><span class="line"><span class="p">[[</span><span class="n">UIColor</span> <span class="n">blueColor</span><span class="p">]</span> <span class="n">setFill</span><span class="p">];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="n">fill</span><span class="p">];</span>
</span><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">im</span> <span class="o">=</span> <span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">();</span>
</span><span class="line"><span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>UIGraphicsBeginImageContextWithOptions</strong>YESNOUIImagescale0</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">  Core Graphics</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">UIGraphicsBeginImageContextWithOptions</span><span class="p">(</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">NO</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextRef</span> <span class="n">con</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line"><span class="n">CGContextAddEllipseInRect</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">));</span>
</span><span class="line"><span class="n">CGContextSetFillColorWithColor</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">blueColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextFillPath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">im</span> <span class="o">=</span> <span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">();</span>
</span><span class="line"><span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;">UIKitCore GraphicsiOS 4.0UIKitUIGraphicsGetCurrentContextiOS4.0</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong>UIImage</strong><strong></strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">UIImage</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif; line-height: 1.5;"><strong></strong>UIImage</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">mars</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="err">@</span><span class="n">Mars</span><span class="p">.</span><span class="n">png</span><span class="err"></span><span class="p">];</span>
</span><span class="line"><span class="n">CGSize</span> <span class="n">sz</span> <span class="o">=</span> <span class="p">[</span><span class="n">mars</span> <span class="n">size</span><span class="p">];</span>
</span><span class="line"><span class="n">UIGraphicsBeginImageContextWithOptions</span><span class="p">(</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span> <span class="n">NO</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="p">[</span><span class="n">mars</span> <span class="nl">drawAtPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)];</span>
</span><span class="line"><span class="p">[</span><span class="n">mars</span> <span class="nl">drawAtPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="mi">0</span><span class="p">)];</span>
</span><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">im</span> <span class="o">=</span> <span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">();</span>
</span><span class="line"><span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span><span class="line"><span class="n">UIImageView</span><span class="o">*</span> <span class="n">iv</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIImageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage:</span><span class="n">im</span><span class="p">];</span>
</span><span class="line"><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span> <span class="n">iv</span><span class="p">];</span>
</span><span class="line"><span class="n">iv</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">center</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p style="text-align: center;"><span style="font-family: 'comic sans ms', sans-serif;"><img style="border: 1px solid black;" src="http://images.cnitblog.com/blog/429321/201212/23211637-5f8e8f19af4b47d49e43fe82084ff701.png" alt="" /></span></p>
<p align="center"><span style="font-family: 'comic sans ms', sans-serif;">1 UIImage</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong></strong>UIImage</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">mars</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="err">@</span><span class="n">Mars</span><span class="p">.</span><span class="n">png</span><span class="err"></span><span class="p">];</span>
</span><span class="line"><span class="n">CGSize</span> <span class="n">sz</span> <span class="o">=</span> <span class="p">[</span><span class="n">mars</span> <span class="n">size</span><span class="p">];</span>
</span><span class="line"><span class="n">UIGraphicsBeginImageContextWithOptions</span><span class="p">(</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="n">NO</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="p">[</span><span class="n">mars</span> <span class="nl">drawInRect:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="o">*</span><span class="mi">2</span><span class="p">)];</span>
</span><span class="line"><span class="p">[</span><span class="n">mars</span> <span class="nl">drawInRect:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">)</span> <span class="nl">blendMode:</span><span class="n">kCGBlendModeMultiply</span> <span class="nl">alpha:</span><span class="mf">1.0</span><span class="p">];</span>
</span><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">im</span> <span class="o">=</span> <span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">();</span>
</span><span class="line"><span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p style="text-align: center;"><span style="font-family: 'comic sans ms', sans-serif;"><img style="border: 1px solid black;" src="http://images.cnitblog.com/blog/429321/201212/23211917-efbb4cc54ca745a0b21539875527e763.png" alt="" /></span></p>
<p align="center"><span style="font-family: 'comic sans ms', sans-serif;">2 UIImage</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">UIImage</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong></strong></span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">mars</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="err">@</span><span class="n">Mars</span><span class="p">.</span><span class="n">png</span><span class="err"></span><span class="p">];</span>
</span><span class="line"><span class="n">CGSize</span> <span class="n">sz</span> <span class="o">=</span> <span class="p">[</span><span class="n">mars</span> <span class="n">size</span><span class="p">];</span>
</span><span class="line"><span class="n">UIGraphicsBeginImageContextWithOptions</span><span class="p">(</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span> <span class="n">NO</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="p">[</span><span class="n">mars</span> <span class="nl">drawAtPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="o">-</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)];</span>
</span><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">im</span> <span class="o">=</span> <span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">();</span>
</span><span class="line"><span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;">X</span></p>
<p style="text-align: center;"><span style="font-family: 'comic sans ms', sans-serif;"><img style="border: 1px solid black;" src="http://images.cnitblog.com/blog/429321/201212/24135912-e57ea08be2db4656b406d5657f1c7357.png" alt="" /></span></p>
<p align="center"><span style="font-family: 'comic sans ms', sans-serif;">3 UIImage</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGImage</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">UIImageCore GraphicsCGImageCGImageRef: UIImageCGImageQuartzCGImageUIImage<strong>imageWithCGImage:</strong><strong>initWithCGImage:</strong>UIImage</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">CGImageUIImage</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">mars</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="err">@</span><span class="n">Mars</span><span class="p">.</span><span class="n">png</span><span class="err"></span><span class="p">];</span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CGSize</span> <span class="n">sz</span> <span class="o">=</span> <span class="p">[</span><span class="n">mars</span> <span class="n">size</span><span class="p">];</span>
</span><span class="line"><span class="n">CGImageRef</span> <span class="n">marsLeft</span> <span class="o">=</span> <span class="n">CGImageCreateWithImageInRect</span><span class="p">([</span><span class="n">mars</span> <span class="n">CGImage</span><span class="p">],</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">));</span>
</span><span class="line"><span class="n">CGImageRef</span> <span class="n">marsRight</span> <span class="o">=</span> <span class="n">CGImageCreateWithImageInRect</span><span class="p">([</span><span class="n">mars</span> <span class="n">CGImage</span><span class="p">],</span><span class="n">CGRectMake</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">));</span>
</span><span class="line"><span class="c1">// CGImage</span>
</span><span class="line"><span class="n">UIGraphicsBeginImageContextWithOptions</span><span class="p">(</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span> <span class="n">NO</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextRef</span> <span class="n">con</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line"><span class="n">CGContextDrawImage</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span> <span class="n">marsLeft</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextDrawImage</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span> <span class="n">marsRight</span><span class="p">);</span>
</span><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">im</span> <span class="o">=</span> <span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">();</span>
</span><span class="line"><span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span><span class="line"><span class="c1">// ARC</span>
</span><span class="line"><span class="n">CGImageRelease</span><span class="p">(</span><span class="n">marsLeft</span><span class="p">);</span>
</span><span class="line"><span class="n">CGImageRelease</span><span class="p">(</span><span class="n">marsRight</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;">CGImage<strong>CGContextDrawImage</strong><strong>CGContextDrawImage</strong>CGImageUIImageUIImageCGImageCGImage<strong>CGContextDrawImage</strong></span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">CGImageRef</span> <span class="nf">flip</span> <span class="p">(</span><span class="n">CGImageRef</span> <span class="n">im</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="n">CGSize</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="n">CGImageGetWidth</span><span class="p">(</span><span class="n">im</span><span class="p">),</span> <span class="n">CGImageGetHeight</span><span class="p">(</span><span class="n">im</span><span class="p">));</span>
</span><span class="line">	<span class="n">UIGraphicsBeginImageContextWithOptions</span><span class="p">(</span><span class="n">sz</span><span class="p">,</span> <span class="n">NO</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextDrawImage</span><span class="p">(</span><span class="n">UIGraphicsGetCurrentContext</span><span class="p">(),</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span> <span class="n">im</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGImageRef</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">()</span> <span class="n">CGImage</span><span class="p">];</span>
</span><span class="line">	<span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span><span class="line">	<span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">CGContextDrawImage</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span> <span class="n">flip</span><span class="p">(</span><span class="n">marsLeft</span><span class="p">));</span>
</span><span class="line"><span class="n">CGContextDrawImage</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span> <span class="n">flip</span><span class="p">(</span><span class="n">marsRight</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">@2xUIImage<strong>imageNamed:</strong>UIImage<strong>scale</strong>CGImage<strong>scale</strong>UIImage<strong>CGImage</strong>CGImageUIImageUIImage<strong>size</strong>UIImageCGImageUIImageCGImage</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">mars</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="err">@</span><span class="n">Mars</span><span class="p">.</span><span class="n">png</span><span class="err"></span><span class="p">];</span>
</span><span class="line"><span class="n">CGSize</span> <span class="n">sz</span> <span class="o">=</span> <span class="p">[</span><span class="n">mars</span> <span class="n">size</span><span class="p">];</span>
</span><span class="line"><span class="c1">// CGImageCGImage</span>
</span><span class="line"><span class="n">CGImageRef</span> <span class="n">marsCG</span> <span class="o">=</span> <span class="p">[</span><span class="n">mars</span> <span class="n">CGImage</span><span class="p">];</span>
</span><span class="line"><span class="n">CGSize</span> <span class="n">szCG</span> <span class="o">=</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="n">CGImageGetWidth</span><span class="p">(</span><span class="n">marsCG</span><span class="p">),</span> <span class="n">CGImageGetHeight</span><span class="p">(</span><span class="n">marsCG</span><span class="p">));</span>
</span><span class="line"><span class="n">CGImageRef</span> <span class="n">marsLeft</span> <span class="o">=</span> <span class="n">CGImageCreateWithImageInRect</span><span class="p">(</span><span class="n">marsCG</span><span class="p">,</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">szCG</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">szCG</span><span class="p">.</span><span class="n">height</span><span class="p">));</span>
</span><span class="line"><span class="n">CGImageRef</span> <span class="n">marsRight</span> <span class="o">=</span> <span class="n">CGImageCreateWithImageInRect</span><span class="p">(</span><span class="n">marsCG</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="n">szCG</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">szCG</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">szCG</span><span class="p">.</span><span class="n">height</span><span class="p">));</span>
</span><span class="line"><span class="n">UIGraphicsBeginImageContextWithOptions</span><span class="p">(</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span> <span class="n">NO</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="c1">//</span>
</span><span class="line"><span class="n">CGContextRef</span> <span class="n">con</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line"><span class="n">CGContextDrawImage</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span><span class="n">flip</span><span class="p">(</span><span class="n">marsLeft</span><span class="p">));</span>
</span><span class="line"><span class="n">CGContextDrawImage</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span><span class="n">flip</span><span class="p">(</span><span class="n">marsRight</span><span class="p">));</span>
</span><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">im</span> <span class="o">=</span> <span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">();</span>
</span><span class="line"><span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span><span class="line"><span class="n">CGImageRelease</span><span class="p">(</span><span class="n">marsLeft</span><span class="p">);</span>
</span><span class="line"><span class="n">CGImageRelease</span><span class="p">(</span><span class="n">marsRight</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong>flip</strong>CGImageUIImage</span></p>
<ul>
     <li><span style="font-family: 'comic sans ms', sans-serif;">UIImage</span></li>
     <li><span style="font-family: 'comic sans ms', sans-serif;">CGImageUimageimageWithCGImage:scale:orientation:CGImage</span></li>
</ul>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">mars</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="err">@</span><span class="n">Mars</span><span class="p">.</span><span class="n">png</span><span class="err"></span><span class="p">];</span>
</span><span class="line"><span class="n">CGSize</span> <span class="n">sz</span> <span class="o">=</span> <span class="p">[</span><span class="n">mars</span> <span class="n">size</span><span class="p">];</span>
</span><span class="line"><span class="n">CGImageRef</span> <span class="n">marsCG</span> <span class="o">=</span> <span class="p">[</span><span class="n">mars</span> <span class="n">CGImage</span><span class="p">];</span>
</span><span class="line"><span class="n">CGSize</span> <span class="n">szCG</span> <span class="o">=</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="n">CGImageGetWidth</span><span class="p">(</span><span class="n">marsCG</span><span class="p">),</span> <span class="n">CGImageGetHeight</span><span class="p">(</span><span class="n">marsCG</span><span class="p">));</span>
</span><span class="line"><span class="n">CGImageRef</span> <span class="n">marsLeft</span> <span class="o">=</span> <span class="n">CGImageCreateWithImageInRect</span><span class="p">(</span><span class="n">marsCG</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">szCG</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">szCG</span><span class="p">.</span><span class="n">height</span><span class="p">));</span>
</span><span class="line"><span class="n">CGImageRef</span> <span class="n">marsRight</span> <span class="o">=</span> <span class="n">CGImageCreateWithImageInRect</span><span class="p">(</span><span class="n">marsCG</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="n">szCG</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">szCG</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="n">szCG</span><span class="p">.</span><span class="n">height</span><span class="p">));</span>
</span><span class="line"><span class="n">UIGraphicsBeginImageContextWithOptions</span><span class="p">(</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span> <span class="n">NO</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="p">[[</span><span class="n">UIImage</span> <span class="nl">imageWithCGImage:</span><span class="n">marsLeft</span> <span class="nl">scale:</span><span class="p">[</span><span class="n">mars</span> <span class="n">scale</span><span class="p">]</span> <span class="nl">orientation:</span><span class="n">UIImageOrientationUp</span><span class="p">]</span> <span class="nl">drawAtPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)];</span>
</span><span class="line"><span class="p">[[</span><span class="n">UIImage</span> <span class="nl">imageWithCGImage:</span><span class="n">marsRight</span> <span class="nl">scale:</span><span class="p">[</span><span class="n">mars</span> <span class="n">scale</span><span class="p">]</span> <span class="nl">orientation:</span><span class="n">UIImageOrientationUp</span><span class="p">]</span> <span class="nl">drawAtPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="mi">0</span><span class="p">)];</span>
</span><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">im</span> <span class="o">=</span> <span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">();</span>
</span><span class="line"><span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span><span class="line"><span class="n">CGImageRelease</span><span class="p">(</span><span class="n">marsLeft</span><span class="p">);</span>
</span><span class="line"><span class="n">CGImageRelease</span><span class="p">(</span><span class="n">marsRight</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">CGImage</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong></strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">Core GraphicsMac OS XMac OS XyiOSyCGImage&nbsp;</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>CIFilter</strong><strong></strong><strong>CIImage</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">CIFilterCIImageiOS 5MAX OS X&#8220;CI&#8221;Core ImageiOSPhotoshopCore Image<em>CoreImage.framework</em>target</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">CIFilter</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">CIImageCIImage</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">Photoshop</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp;CIFilterCIFilterCIImageCIFilter<a href="https://developer.apple.com/library/mac/#documentation/graphicsimaging/reference/CoreImageFilterReference/Reference/reference.html"><em>Core Image Filter Reference</em></a>CIFilter<strong>filterNamesInCategories</strong><strong></strong>nil<strong>setValue</strong><strong></strong><strong>forKey</strong><strong></strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp; &nbsp; &nbsp;CIImage<strong>initWithCGImage</strong><strong></strong>CIImageCGImage<strong>initWithCGImage</strong><strong></strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp; CGImage<strong>contextWithOptions</strong><strong></strong><strong>createCGImage: fromRect:</strong>CIContextCIImageframeboundsextent<strong>createCGImage: fromRect:</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp; &nbsp;Core Image100CIDarkenBlendModeCIDarkenBlendMode</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">moi</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="err">@</span><span class="n">Mars</span><span class="p">.</span><span class="n">jpeg</span><span class="err"></span><span class="p">];</span>
</span><span class="line"><span class="n">CIImage</span><span class="o">*</span> <span class="n">moi2</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CIImage</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithCGImage:</span><span class="n">moi</span><span class="p">.</span><span class="n">CGImage</span><span class="p">];</span>
</span><span class="line"><span class="n">CIFilter</span><span class="o">*</span> <span class="n">grad</span> <span class="o">=</span> <span class="p">[</span><span class="n">CIFilter</span> <span class="nl">filterWithName:</span><span class="err">@</span><span class="n">CIRadialGradient</span><span class="err"></span><span class="p">];</span>
</span><span class="line"><span class="n">CIVector</span><span class="o">*</span> <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="n">CIVector</span> <span class="nl">vectorWithX:</span><span class="n">moi</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="nl">Y:</span><span class="n">moi</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">];</span>
</span><span class="line"><span class="c1">// setValueforKey</span>
</span><span class="line"><span class="p">[</span><span class="n">grad</span> <span class="nl">setValue:</span><span class="n">center</span> <span class="nl">forKey:</span><span class="err">@</span><span class="n">inputCenter</span><span class="err"></span><span class="p">];</span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CIFilter</span><span class="o">*</span> <span class="n">dark</span> <span class="o">=</span> <span class="p">[</span><span class="n">CIFilter</span> <span class="nl">filterWithName:</span><span class="err">@</span><span class="n">CIDarkenBlendMode</span><span class="err"></span> <span class="nl">keysAndValues:</span><span class="err">@</span><span class="n">inputImage</span><span class="err"></span><span class="p">,</span> <span class="n">grad</span><span class="p">.</span><span class="n">outputImage</span><span class="p">,</span> <span class="err">@</span><span class="n">inputBackgroundImage</span><span class="err"></span><span class="p">,</span> <span class="n">moi2</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span><span class="line"><span class="n">CIContext</span><span class="o">*</span> <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">CIContext</span> <span class="nl">contextWithOptions:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class="line"><span class="n">CGImageRef</span> <span class="n">moi3</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="nl">createCGImage:</span><span class="n">dark</span><span class="p">.</span><span class="n">outputImage</span> <span class="nl">fromRect:</span><span class="n">moi2</span><span class="p">.</span><span class="n">extent</span><span class="p">];</span>
</span><span class="line"><span class="n">UIImage</span><span class="o">*</span> <span class="n">moi4</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageWithCGImage:</span><span class="n">moi3</span> <span class="nl">scale:</span><span class="n">moi</span><span class="p">.</span><span class="n">scale</span> <span class="nl">orientation:</span><span class="n">moi</span><span class="p">.</span><span class="n">imageOrientation</span><span class="p">];</span>
</span><span class="line"><span class="n">CGImageRelease</span><span class="p">(</span><span class="n">moi3</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;"><img style="border: 1px solid black; display: block; margin-left: auto; margin-right: auto;" src="http://images.cnitblog.com/blog/429321/201212/27103647-2fcd19d1ca1e4a0d9f42e2c79687e881.png" alt="" width="693" height="199" /></span></p>
<p style="text-align: center;">&nbsp;<span style="font-family: 'comic sans ms', sans-serif; text-align: left; line-height: 1.5;">&nbsp;4 </span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">Core GraphicsCore ImageGPUCore GraphicsCore ImageCore ImageCore GraphicsCore Image</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong></strong><strong>UIView</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">UIVIewUIViewUIViewUIVIew <strong>drawRect</strong>:<strong>drawRect</strong><strong></strong>Core GraphicsUIKit</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>drawRect</strong><strong></strong><strong>drawRect</strong><strong>setNeedsDisplay</strong><strong>drawRect</strong><strong>drawRect</strong><strong></strong>UIImageView<strong>drawRect</strong><strong></strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UIView<strong>drawRect</strong><strong></strong>superUIView<strong>drawRect</strong><strong></strong><strong>setNeedsDisplayInRect</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iOS<strong>drawRect</strong><strong></strong><strong>setNeedsDisplay</strong>(<em>bitmap backing store</em>)<strong>drawRect</strong><strong></strong><strong>drawRect</strong><strong></strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>backgroundColor</strong>nil<strong>opaque</strong>YES</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>Core Graphics</strong><strong></strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">,UIKitCore Graphics</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSaveGState</strong><strong>CGContextRestoreGState</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSaveGState</strong><strong>CGContextRestoreGState</strong><strong>CGContextSaveGState</strong><strong>CGContextRestoreGState</strong></span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawRect:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">rect</span> <span class="p">{</span>
</span><span class="line">	<span class="n">CGContextRef</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line">	<span class="n">CGContextSaveGState</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
</span><span class="line">	<span class="p">{</span>
</span><span class="line">		<span class="c1">// </span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line">	
</span><span class="line">	<span class="n">CGContextRestoreGState</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span> <span class="err"></span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">Core GraphicsUIKit</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSetLineWidth</strong><strong>CGContextSetLineDash</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSetLineCap</strong><strong></strong><strong>CGContextSetLineJoin</strong><strong></strong><strong>CGContextSetMiterLimit</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSetStrokeColorWithColor</strong><strong></strong><strong>CGContextSetStrokePattern</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSetRGBStrokeColor</strong><strong></strong><strong>CGContextSetGrayStrokeColor</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong style="line-height: 1.5;">CGContextSetRGBFillColor,CGContextSetGrayFillColor</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong style="line-height: 1.5;">CGContextSetFillColorWithColor, CGContextSetFillPattern</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSetShadow</strong><strong></strong><strong>CGContextSetShadowWithColor</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSetBlendMode</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSetAlpha</strong>alpha</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><strong>CGContextSelectFont</strong><strong></strong><strong>CGContextSetFont</strong><strong>

<p><strong>CGContextSetFontSize</strong><strong></strong><strong>CGContextSetTextDrawingMode</strong><strong></strong><strong>CGContextSetCharacterSpacing</strong>
</p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSetShouldAntialias</strong><strong></strong><strong>CGContextSetShouldSmoothFonts</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">:</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&#8220;CTM&#8220;):&nbsp;</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong></strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; </span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; </span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; <strong>CGContextMoveToPoint</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; </span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; <strong>CGContextAddLineToPoint</strong><strong></strong><strong>CGContextAddLines</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; </span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; <strong>CGContextAddRect</strong><strong></strong><strong>CGContextAddRects</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; </span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; <strong>CGContextAddEllipseInRect</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; </span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; <strong>CGContextAddArcToPoint</strong><strong></strong><strong>CGContextAddArc</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; </span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong>&nbsp;&nbsp;&nbsp; CGContextAddQuadCurveToPoint</strong><strong></strong><strong>CGContextAddCurveToPoint</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; </span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; <strong>CGContextClosePath</strong> </span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; </span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; <strong>CGContextStrokePath</strong><strong></strong><strong>CGContextFillPath</strong><strong></strong><strong>CGContextEOFillPath</strong><strong></strong><strong>CGContextDrawPath</strong><span style="color: #ff0000;"></span><strong>CGContextDrawPath</strong><strong>CGContextStrokePath</strong></span></p>
<p><strong>CGContextStrokeLineSegments</strong><strong></strong><strong>CGContextStrokeRect</strong><strong></strong><strong>CGContextStrokeRectWithWidth</strong><strong>
<p><strong>CGContextFillRect</strong><strong></strong><strong>CGContextFillRects</strong><strong></strong><strong>CGContextStrokeEllipseInRect</strong><strong></strong><strong>CGContextFillEllipseInRect</strong></p>

<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; <strong>CGContextBeginPath</strong><strong>CGContextMoveToPoint</strong><strong>CGContextBeginPath</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; <strong>CGContextClearRect</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; <strong>CGContextClearRect</strong><strong>UIGraphicsBeginImageContextWithOptions</strong>NO<strong>CGContextClearRect</strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; <strong>drawRect</strong><strong>drawLayerinContext</strong>nilCGContextClearRect<strong>CGContextClearRect</strong></span></p>
<p style="text-align: center;"><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;<img style="border: 1px solid black;" src="http://images.cnitblog.com/blog/429321/201301/04135105-c4e1981ec5e84cbfaba3e2dd641f7411.png" alt="" /></span></p>
<p style="text-align: center;"><span style="font-family: 'comic sans ms', sans-serif;">5 CGContextClearRect</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; 5UIViewnib</span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">CGContextClearRectUIViewdrawRect</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">CGContextRef</span> <span class="n">con</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line"><span class="n">CGContextSetFillColorWithColor</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">blueColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextFillRect</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">rect</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextClearRect</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p align="center"><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;<img style="border: 1px solid black;" src="http://images.cnitblog.com/blog/429321/201301/03223022-6cc72c828292475eb6f9915454403b4d.png" alt="" /></span></p>
<p align="center"><span style="font-family: 'comic sans ms', sans-serif;">6 </span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">CGContextRef</span> <span class="n">con</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CGContextMoveToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">19</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextSetLineWidth</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextStrokePath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CGContextSetFillColorWithColor</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">[[</span><span class="n">UIColor</span> <span class="n">redColor</span><span class="p">]</span> <span class="n">CGColor</span><span class="p">]);</span>
</span><span class="line"><span class="n">CGContextMoveToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextFillPath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CGContextMoveToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">101</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">90</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">101</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextSetBlendMode</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">kCGBlendModeClear</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextFillPath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSaveGState</strong><strong>CGContextRestoreGState</strong>drawRect</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">CGPathCGPathRefCGMutablePathRefCGPathCGContextCopyPathCGPath<strong>CGPathCreateWithRectCGPathCreateWithEllipseInRect</strong><strong>CGPathCreateCopyByStrokingPathCGPathCreateCopyDashingPathCGPathCreateCopyByTransformingPath</strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">UIKitUIBezierPathCGPathUIColor</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">UIBezierPath</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIBezierPath</span> <span class="n">bezierPath</span><span class="p">];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="nl">moveToPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="nl">addLineToPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">19</span><span class="p">)];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="nl">setLineWidth:</span><span class="mi">20</span><span class="p">];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="n">stroke</span><span class="p">];</span>
</span><span class="line"><span class="p">[[</span><span class="n">UIColor</span> <span class="n">redColor</span><span class="p">]</span> <span class="n">set</span><span class="p">];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="n">removeAllPoints</span><span class="p">];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="nl">moveToPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="mi">25</span><span class="p">)];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="nl">addLineToPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">)];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="nl">addLineToPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">25</span><span class="p">)];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="n">fill</span><span class="p">];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="n">removeAllPoints</span><span class="p">];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="nl">moveToPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span><span class="mi">101</span><span class="p">)];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="nl">addLineToPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">90</span><span class="p">)];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="nl">addLineToPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="mi">101</span><span class="p">)];</span>
</span><span class="line"><span class="p">[</span><span class="n">p</span> <span class="nl">fillWithBlendMode:</span><span class="n">kCGBlendModeClear</span> <span class="nl">alpha:</span><span class="mf">1.0</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">UIBezierPathUIBezierPath<strong>bezierPathWithRoundedRect</strong><strong></strong><strong>cornerRadius</strong><strong></strong>Core Graphics</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawRect:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">rect</span> <span class="p">{</span>
</span><span class="line">  <span class="n">CGContextRef</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line">  <span class="n">CGContextSetStrokeColorWithColor</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">blackColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">);</span>
</span><span class="line">  <span class="n">CGContextSetLineWidth</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span><span class="line">  <span class="n">UIBezierPath</span> <span class="o">*</span><span class="n">path</span><span class="p">;</span>
</span><span class="line">  <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIBezierPath</span> <span class="nl">bezierPathWithRoundedRect:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="nl">byRoundingCorners:</span><span class="p">(</span><span class="n">UIRectCornerTopLeft</span> <span class="o">|</span><span class="n">UIRectCornerTopRight</span><span class="p">)</span> <span class="nl">cornerRadii:</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)];</span>
</span><span class="line">  <span class="p">[</span><span class="n">path</span> <span class="n">stroke</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p style="text-align: center;" align="left"><span style="font-family: 'comic sans ms', sans-serif;"><img style="border: 1px solid black;" src="http://images.cnitblog.com/blog/429321/201301/10164554-8b950cf0971d44788736463119e4eaf5.png" alt="" /></span></p>
<p style="text-align: center;" align="left"><span style="font-family: 'comic sans ms', sans-serif;">7 </span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong style="line-height: 1.5;"></strong></span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;"><span style="color: #ff0000;"></span></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSaveGState</strong><strong>CGContextRestoreGState</strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; </span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; </span></p>
<p><span style="font-family: 'comic sans ms', sans-serif;">Winding rule</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">CGContextEOCllip<span style="color: #ff0000;"><a style="line-height: 1.5; font-family: 'comic sans ms', sans-serif;" href="http://disanji.net/2010/12/05/5-ways-to-draw-2d-shape-with-hole-in-html/"><span style="color: #ff0000;">2d</span></a></span></span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">CGContextRef</span> <span class="n">con</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CGContextMoveToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">90</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextClosePath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddRect</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGContextGetClipBoundingBox</span><span class="p">(</span><span class="n">con</span><span class="p">));</span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CGContextEOClip</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CGContextMoveToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">19</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextSetLineWidth</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextStrokePath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CGContextSetFillColorWithColor</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">[[</span><span class="n">UIColor</span> <span class="n">redColor</span><span class="p">]</span> <span class="n">CGColor</span><span class="p">]);</span>
</span><span class="line"><span class="n">CGContextMoveToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextFillPath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong></strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong></strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">7</span></p>
<p style="text-align: center;" align="left"><span style="font-family: 'comic sans ms', sans-serif;"><img style="border: 1px solid black;" src="http://images.cnitblog.com/blog/429321/201301/07162647-645fc1f5a9d2469b83ef7577f6d1a461.png" alt="" />&nbsp;</span></p>
<p style="text-align: center;" align="left"><span style="font-family: 'comic sans ms', sans-serif;">8 </span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">CGContextRef</span> <span class="n">con</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line"><span class="n">CGContextSaveGState</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CGContextMoveToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">90</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextClosePath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddRect</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGContextGetClipBoundingBox</span><span class="p">(</span><span class="n">con</span><span class="p">));</span>
</span><span class="line"><span class="n">CGContextEOClip</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line"><span class="c1">//</span>
</span><span class="line"><span class="n">CGContextMoveToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">19</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextSetLineWidth</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CGContextReplacePathWithStrokedPath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CGContextClip</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CGFloat</span> <span class="n">locs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">};</span>
</span><span class="line"><span class="n">CGFloat</span> <span class="n">colors</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line"><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span> <span class="c1">// </span>
</span><span class="line"><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span> <span class="c1">// </span>
</span><span class="line"><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.8</span> <span class="c1">// </span>
</span><span class="line"><span class="p">};</span>
</span><span class="line"><span class="n">CGColorSpaceRef</span> <span class="n">sp</span> <span class="o">=</span> <span class="n">CGColorSpaceCreateDeviceGray</span><span class="p">();</span>
</span><span class="line"><span class="n">CGGradientRef</span> <span class="n">grad</span> <span class="o">=</span> <span class="n">CGGradientCreateWithColorComponents</span> <span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">locs</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextDrawLinearGradient</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="mi">89</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="n">CGColorSpaceRelease</span><span class="p">(</span><span class="n">sp</span><span class="p">);</span>
</span><span class="line"><span class="n">CGGradientRelease</span><span class="p">(</span><span class="n">grad</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextRestoreGState</span><span class="p">(</span><span class="n">con</span><span class="p">);</span> <span class="c1">// </span>
</span><span class="line"><span class="c1">// </span>
</span><span class="line"><span class="n">CGContextSetFillColorWithColor</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">[[</span><span class="n">UIColor</span> <span class="n">redColor</span><span class="p">]</span> <span class="n">CGColor</span><span class="p">]);</span>
</span><span class="line"><span class="n">CGContextMoveToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextFillPath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextReplacePathWithStrokedPath</strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">0.01.00.5</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong></strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong></strong>iOSCGColorCGColorRefUIColorcolorWithCGColorCGColorbridged castUIColor</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">iOSCGPatternCGPatternRef</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">CGContextSetFillColorWithColorcon [UIColor redColor].CGColor</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">CGColorSpaceRef</span> <span class="n">sp2</span> <span class="o">=</span> <span class="n">CGColorSpaceCreatePattern</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextSetFillColorSpace</span> <span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">sp2</span><span class="p">);</span>
</span><span class="line"><span class="n">CGColorSpaceRelease</span> <span class="p">(</span><span class="n">sp2</span><span class="p">);</span>
</span><span class="line"><span class="n">CGPatternCallbacks</span> <span class="n">callback</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">drawStripes</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>
</span><span class="line"><span class="n">CGAffineTransform</span> <span class="n">tr</span> <span class="o">=</span> <span class="n">CGAffineTransformIdentity</span><span class="p">;</span>
</span><span class="line"><span class="n">CGPatternRef</span> <span class="n">patt</span> <span class="o">=</span> <span class="n">CGPatternCreate</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">tr</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">kCGPatternTilingConstantSpacingMinimalDistortion</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">callback</span><span class="p">);</span>
</span><span class="line"><span class="n">CGFloat</span> <span class="n">alph</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</span><span class="line"><span class="n">CGContextSetFillPattern</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">patt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">alph</span><span class="p">);</span>
</span><span class="line"><span class="n">CGPatternRelease</span><span class="p">(</span><span class="n">patt</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p align="left"><span style="line-height: 1.5; font-family: 'comic sans ms', sans-serif;">: <strong>CGContextSetFillPattern</strong>CGFloatCGFloatCGPatternRefCGPatternRef</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">CGPatternCreate4*4stenciltrueCGPatternCallbacks0</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSetFillPattern</strong><strong>CGContextSetFillPattern</strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">&amp;drawStripes</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="kt">void</span> <span class="nf">drawStripes</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="n">CGContextRef</span> <span class="n">con</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line"><span class="c1">// assume 4 x 4 cell</span>
</span><span class="line"><span class="n">CGContextSetFillColorWithColor</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">[[</span><span class="n">UIColor</span> <span class="n">redColor</span><span class="p">]</span> <span class="n">CGColor</span><span class="p">]);</span>
</span><span class="line"><span class="n">CGContextFillRect</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">));</span>
</span><span class="line"><span class="n">CGContextSetFillColorWithColor</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">[[</span><span class="n">UIColor</span> <span class="n">blueColor</span><span class="p">]</span> <span class="n">CGColor</span><span class="p">]);</span>
</span><span class="line"><span class="n">CGContextFillRect</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p style="text-align: center;"><span style="font-family: 'comic sans ms', sans-serif;"><img style="border: 1px solid black;" src="http://images.cnitblog.com/blog/429321/201301/07163055-71996ba36a4f4a44bca579b8d6210dd4.png" alt="" /></span></p>
<p align="center"><span style="font-family: 'comic sans ms', sans-serif;">9 &nbsp;</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGPatternCreate</strong>4*48</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong>CGContextSaveGState</strong><strong>CGContextRestoreGState</strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">8<strong>CGContextSetPatternPhase</strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong></strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">UIViewCTM&#8220;&#8220;current transformation matrix</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">CTMCGContextConcatCTMCGAffineTransform&nbsp;</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">CGContextSaveGStateCGContextRestoreGState&nbsp;</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">{800}x80{00}</span></p>
<p class="MsoNormal" align="left" style="margin: 6pt 0cm; text-indent: 40pt; line-height: 15.75pt; background-color: #d9d9d9; background-position: initial initial; background-repeat: initial initial;"><span lang="EN-US" style="font-size: 10pt; font-family: Consolas;">CGContextTranslateCTM</span><span style="font-size: 10pt; font-family: ;"></span><span lang="EN-US" style="font-size: 10pt; font-family: Consolas;">con, 80, 0</span><span style="font-size: 10pt; font-family: ;"></span><span lang="EN-US" style="font-size: 10pt; font-family: Consolas;">;&nbsp;</span><span style="text-indent: 0px; line-height: 15.75pt; font-size: 10pt; font-family: Consolas;">//</span><span style="text-indent: 0px; line-height: 15.75pt; font-size: 10pt; font-family: ;"></span><span style="text-indent: 0px; line-height: 15.75pt; font-size: 10pt; font-family: Consolas;">{0,0}</span><span style="text-indent: 0px; line-height: 15.75pt; font-size: 10pt; font-family: ;"></span></p>
<p style="margin-top:3.75pt;margin-right:0cm;margin-bottom:3.75pt;margin-left: 0cm;line-height:15.75pt"><span style="font-size: 10.5pt; font-family: 'Comic Sans MS';">&nbsp; &nbsp; &nbsp; &nbsp;</span><span style="font-size: 10.5pt;"></span></p>
<p style="margin: 3.75pt 0cm; line-height: 15.75pt;"><span style="font-size: 10.5pt;"></span><span style="font-size: 10.5pt; font-family: 'Comic Sans MS';">UIImage</span><span style="font-size: 10.5pt;"></span><span style="font-size: 10.5pt; font-family: 'Comic Sans MS';">UIImage</span><span style="font-size: 10.5pt;"></span></p>
<p style="margin: 3.75pt 0cm; line-height: 15.75pt;"><span style="font-size: 10.5pt;"></span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawRect:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">rect</span> <span class="p">{</span>
</span><span class="line">	<span class="n">UIGraphicsBeginImageContextWithOptions</span><span class="p">(</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">NO</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextRef</span> <span class="n">con</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line">	<span class="n">CGContextSaveGState</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextMoveToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">110</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextMoveToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">110</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextClosePath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextAddRect</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGContextGetClipBoundingBox</span><span class="p">(</span><span class="n">con</span><span class="p">));</span>
</span><span class="line">	<span class="n">CGContextEOClip</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextMoveToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">19</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextSetLineWidth</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextReplacePathWithStrokedPath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextClip</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGFloat</span> <span class="n">locs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">};</span>
</span><span class="line">	<span class="n">CGFloat</span> <span class="n">colors</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">			<span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span>
</span><span class="line">			<span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span>
</span><span class="line">			<span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.8</span>
</span><span class="line">		<span class="p">};</span>
</span><span class="line">	<span class="n">CGColorSpaceRef</span> <span class="n">sp</span> <span class="o">=</span> <span class="n">CGColorSpaceCreateDeviceGray</span><span class="p">();</span>
</span><span class="line">	<span class="n">CGGradientRef</span> <span class="n">grad</span> <span class="o">=</span> <span class="n">CGGradientCreateWithColorComponents</span> <span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">locs</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextDrawLinearGradient</span> <span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="mi">89</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="mi">111</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGColorSpaceRelease</span><span class="p">(</span><span class="n">sp</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGGradientRelease</span><span class="p">(</span><span class="n">grad</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextRestoreGState</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGColorSpaceRef</span> <span class="n">sp2</span> <span class="o">=</span> <span class="n">CGColorSpaceCreatePattern</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextSetFillColorSpace</span> <span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">sp2</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGColorSpaceRelease</span> <span class="p">(</span><span class="n">sp2</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGPatternCallbacks</span> <span class="n">callback</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">drawStripes</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>
</span><span class="line">	<span class="n">CGAffineTransform</span> <span class="n">tr</span> <span class="o">=</span> <span class="n">CGAffineTransformIdentity</span><span class="p">;</span>
</span><span class="line">	<span class="n">CGPatternRef</span> <span class="n">patt</span> <span class="o">=</span> <span class="n">CGPatternCreate</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">tr</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="err"></span><span class="n">kCGPatternTilingConstantSpacingMinimalDistortion</span><span class="p">,</span><span class="n">true</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">callback</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGFloat</span> <span class="n">alph</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</span><span class="line">	<span class="n">CGContextSetFillPattern</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">patt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">alph</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGPatternRelease</span><span class="p">(</span><span class="n">patt</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextMoveToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">80</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextAddLineToPoint</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">120</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextFillPath</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span><span class="line">	<span class="n">UIImage</span><span class="o">*</span> <span class="n">im</span> <span class="o">=</span> <span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">();</span>
</span><span class="line">	<span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span><span class="line">	<span class="n">con</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line">	<span class="p">[</span><span class="n">im</span> <span class="nl">drawAtPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)];</span>
</span><span class="line">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">		<span class="n">CGContextTranslateCTM</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line">		<span class="n">CGContextRotateCTM</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">M_PI</span><span class="o">/</span><span class="mf">180.0</span><span class="p">);</span>
</span><span class="line">		<span class="n">CGContextTranslateCTM</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">);</span>
</span><span class="line">		<span class="p">[</span><span class="n">im</span> <span class="nl">drawAtPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)];</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p style="text-align: center;"><span style="font-family: 'comic sans ms', sans-serif;"><img style="border: 1px solid black;" src="http://images.cnitblog.com/blog/429321/201301/07163256-346e34bf3956474f9df5a94c73593174.png" alt="" /></span></p>
<p align="center"><span style="font-family: 'comic sans ms', sans-serif;">10 CTM</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">CGContextDrawImage&#8220;&#8221;y-1y</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">CGContextTranslateCTM</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">theHeight</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextScaleCTM</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp;&nbsp; </span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">CGContextTranslateCTM</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">);</span> <span class="c1">// sz[mars size]</span>
</span><span class="line"><span class="n">CGContextScaleCTM</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextDrawImage</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span> <span class="n">marsLeft</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextDrawImage</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="o">-</span><span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">sz</span><span class="p">.</span><span class="n">height</span><span class="p">),</span><span class="n">marsRight</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><span style="font-family: 'comic sans ms', sans-serif;"><strong></strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">CGSizeCGSize1299</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;&nbsp;&nbsp; 9</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">con</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line"><span class="n">CGContextSetShadow</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="mi">12</span><span class="p">);</span>
</span><span class="line"><span class="p">[</span><span class="n">im</span> <span class="nl">drawAtPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"></span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">con</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
</span><span class="line"><span class="n">CGContextSetShadow</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="mi">12</span><span class="p">);</span>
</span><span class="line"><span class="n">CGContextBeginTransparencyLayer</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class="line"><span class="p">[</span><span class="n">im</span> <span class="nl">drawAtPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)];</span>
</span><span class="line"><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="n">CGContextTranslateCTM</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextRotateCTM</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">M_PI</span><span class="o">/</span><span class="mf">180.0</span><span class="p">);</span>
</span><span class="line">	<span class="n">CGContextTranslateCTM</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">);</span>
</span><span class="line">	<span class="p">[</span><span class="n">im</span> <span class="nl">drawAtPoint:</span><span class="n">CGPointMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="c1">// CGContextEndTransparencyLayer</span>
</span><span class="line"><span class="c1">// alpha</span>
</span><span class="line"><span class="n">CGContextEndTransparencyLayer</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p style="text-align: center;"><span style="font-family: 'comic sans ms', sans-serif;"><span style="text-align: center; line-height: 1.5;">&nbsp;</span><img style="border: 1px solid black;" src="http://images.cnitblog.com/blog/429321/201301/09171900-f4e5eee50a41417498caf7b95a9ae3da.png" alt="" /></span></p>
<p style="text-align: center;" align="left"><span style="font-family: 'comic sans ms', sans-serif;">11 </span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong></strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">xyCore GraphicsCTM</span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">12px</span></p>
<p style="text-align: center;" align="left"><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;<img style="border: 1px solid black;" src="http://images.cnitblog.com/blog/429321/201301/10092953-804dd8b8a43f4dd1a5c5621e33aa5414.png" alt="" width="693" height="298" /></span></p>
<p style="text-align: center;" align="left"><span style="font-family: 'comic sans ms', sans-serif; line-height: 1.5;">12 0.5</span></p>
<p style="text-align: left;" align="center"><span style="font-family: 'comic sans ms', sans-serif; line-height: 1.5;">&nbsp; &nbsp; &nbsp; &nbsp;0.511UIViewcontentScaleFactor1.02.0UIView1px</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">CGContextFillRect</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.0</span><span class="o">/</span><span class="n">self</span><span class="p">.</span><span class="n">contentScaleFactor</span><span class="p">,</span><span class="mi">100</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong></strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong>contentMode</strong><strong>contentMode</strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong>drawRect</strong>MyViewwindowMyViewwindow</span></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span> <span class="p">{</span>
</span><span class="line">  <span class="n">self</span><span class="p">.</span><span class="n">window</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIWindow</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">]];</span>
</span><span class="line">  <span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIViewController</span> <span class="n">new</span><span class="p">];</span>
</span><span class="line">  <span class="n">MyView</span><span class="o">*</span> <span class="n">mv</span> <span class="o">=</span><span class="p">[[</span><span class="n">MyView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">)];</span>
</span><span class="line">  <span class="n">mv</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">center</span><span class="p">;</span>
</span><span class="line">  <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span> <span class="n">mv</span><span class="p">];</span>
</span><span class="line">  <span class="n">mv</span><span class="p">.</span><span class="n">opaque</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class="line">  <span class="n">mv</span><span class="p">.</span><span class="n">tag</span> <span class="o">=</span> <span class="mi">111</span><span class="p">;</span> <span class="c1">// so I can get a reference to this view later</span>
</span><span class="line">  <span class="p">[</span><span class="n">self</span> <span class="nl">performSelector:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">resize:</span><span class="p">)</span> <span class="nl">withObject:</span><span class="nb">nil</span> <span class="nl">afterDelay:</span><span class="mf">0.1</span><span class="p">];</span>
</span><span class="line">  <span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">whiteColor</span><span class="p">];</span>
</span><span class="line">  <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">window</span> <span class="n">makeKeyAndVisible</span><span class="p">];</span>
</span><span class="line">  <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">2drawRectdrawRect912</span></p>
<p style="text-align: center;" align="left"><span style="font-family: 'comic sans ms', sans-serif;">&nbsp;<img style="border: 1px solid black;" src="http://images.cnitblog.com/blog/429321/201301/09172048-10bd46b975944316bca85b7f3451b54d.png" alt="" /></span></p>
<p align="center"><span style="font-family: 'comic sans ms', sans-serif;">13 </span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;">drawRect<strong>drawRect</strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong>contentMode</strong><strong>drawRect</strong><strong>contentMode</strong><strong>UIViewContentModeTopLeft</strong><strong>contentMode</strong><strong>UIVIewContentModeRedraw</strong><strong>setNeedsDisplay</strong><strong>drawRect</strong></span></p>
<p align="left"><span style="font-family: 'comic sans ms', sans-serif;"><strong>contentMode</strong><strong>UIViewContentModeScaleToFill</strong></span>&nbsp;</p>
<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
</strong></p></strong></p></span></p></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[UIKitAPPKit]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2014/08/04/cong-uikitdao-appkit/"/>
    <updated>2014-08-04T10:03:56+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2014/08/04/cong-uikitdao-appkit</id>
    <content type="html"><![CDATA[<p>Mac <em></em> <a href="http://decksetapp.com">Mac </a> iOS  Mac  Mac </p>

<p> OS X Yosemite  iOS  OS X OS X  Yosemite</p>

<h2></h2>

<p> iOS  OS X IDE</p>

<p>OS X  iOS  FoundationCore Data  Core AnimationApple  Mac  iOS  Multipeer Connectivity APICore GraphicsCore Textlibdispatch </p>

<p> UI   AppKit  NeXT  UIKit  AppKit Apple  iPhone  AppKit </p>

<p> Apple iOS  <a href="https://twitter.com/nitinganatra">Nitin Ganatra</a> <a href="http://www.imore.com/debug-39-nitin-ganatra-episode-i-system-7-carbon">System 7 to Carbon</a><a href="http://www.imore.com/debug-40-nitin-ganatra-episode-ii-os-x-ios">OS X to iOS</a> <a href="http://www.imore.com/debug-41-nitin-ganatra-episode-iii-iphone-ipad">iPhone to iPad</a></p>

<p> UIKit  AppKit UI  window  view  iOS <code>UIView</code>  <code>NSView</code><code>UIControl</code>  <code>NSControl</code><code>UIImage</code>  <code>NSImage</code><code>UIViewController</code>  <code>NSViewController</code><code>UITextView</code>  <code>NSTextView</code>&#8230;</p>

<p> <code>UI</code>  <code>NS</code>  iOS   </p>

<p></p>

<h2></h2>

<h3 id="windowwindowcontroller">Window  Window Controller</h3>
<!-- more -->
<p> iOS  window window  Mac  Mac  window window  iOS  view controller, AppKit  <code>NSWindowController</code> iOS  view controller view controller  AppKit  actionview controller  UIKit </p>

<p> AppKit  Mac  window OS X 10.10 Yosemite <code>NSViewController</code>  <code>UIViewController</code>  Mac  OS X 10.9 Mac  window controller  iOS  view controller <a href="https://www.mikeash.com/pyblog/friday-qa-2013-04-05-windows-and-window-controllers.html">Mike Ash </a> Mac  nib  window controller</p>

<p><code>NSWindow</code>  <code>UIWindow</code>  view  window  <code>contentView</code>  view </p>

<h3></h3>

<p> OS X 10.9  view controller  window  window controller view controller <a href="http://www.cocoawithlove.com/2008/07/better-integration-for-nsviewcontroller.html"></a></p>

<p>AppKit  action  action </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">performAction:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> iOS  sender  event  OS X  NSControl  AppKit  target  action iOS  <code>addTarget:action:forControlEvents:</code>  target-action </p>

<h3 id="view">View</h3>

<p>Mac  iOS iOS  view  Core Animation layer  AppKit  Core Animation  Apple  AppKit  GPU  CPU </p>

<p> Mac  Apple  <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/CocoaViewsGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40002978">Introduction to View Programming Guide for Cocoa</a> WWDC session<a href="https://developer.apple.com/videos/wwdc/2012/#217">Layer-Backed Views: AppKit + Core Animation</a>  <a href="https://developer.apple.com/videos/wwdc/2013/#215">Optimizing Drawing and Scrolling</a></p>

<h4 id="layerbackedview">Layer-Backed View</h4>

<p>AppKit  view  Core Animation layer AppKit  layer-backing  iOS  AppKit  UIKit AppKit  layer-backed view  layer-hosting view layer backing</p>

<p> contentView  <code>wantsLayer</code>  <code>YES</code>  layer backing  window  view  layer backing view  wantsLayer  Interface Builder  View Effects Inspector </p>

<p> iOS  Mac  backing layer  layer  AppKit  layer  iOS </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">self</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">redColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>objc</p>

<p> AppKit layer layer  <code>NSView</code>  <code>wantsUpdateLayer</code>  <code>YES</code> layer AppKit  view  <code>drawRect:</code>  <code>updateLayer</code>  Layer view </p>

<p> view<code>NSView</code>  <code>backgroundColor</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@interface</span> <span class="nc">ColoredView</span>: <span class="nc">NSView</span>
</span><span class="line">
</span><span class="line"><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSColor</span> <span class="o">*</span><span class="n">backgroundColor</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">@end</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">@implementation</span> <span class="nc">ColoredView</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">wantsUpdateLayer</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">updateLayer</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">self</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">backgroundColor</span><span class="p">.</span><span class="n">CGColor</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setBackgroundColor:</span><span class="p">(</span><span class="n">NSColor</span> <span class="o">*</span><span class="p">)</span><span class="nv">backgroundColor</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">_backgroundColor</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span> <span class="nl">setNeedsDisplay:</span><span class="n">YES</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> view  view  layer backing <code>drawRect:</code> </p>

<h5 id="layer"> Layer</h5>

<p> layer-backed view  layer  backing store view  backing store  layer  OS X 10.9  <code>canDrawSubviewsIntoLayer</code>  AppKit  layer  layer view  view </p>

<p> layer-backed  view view  <code>wantsLayer = YES</code> layer <code>wantsLayer</code>  <code>YES</code>  view  backing layer  <code>wantsUpdateLayer</code>  <code>drawRect:</code> </p>

<h5 id="layer">Layer </h5>

<p>layer-backed view  <code>NSViewLayerContentsRedrawDuringViewResize</code> layer-backed view </p>

<p> <code>layerContentsRedrawPolicy</code>  <code>NSViewLayerContentsRedrawOnSetNeedsDisplay</code>  layer  <code>-setNeedsDisplay:</code> </p>

<p> view  layer  <code>contentGravity</code>  <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/occ/instm/NSView/layerContentsPlacement"><code>layerContentsPlacement</code></a>  layer  layer </p>

<h4 id="layerhostingview">Layer-Hosting View</h4>

<p><code>NSView</code>  layer  Core Animation layer   layer-hosting view layer-hosting view  layer  layer  view  viewlayer-hosting view </p>

<p> layer-hosting view view  <code>layer</code>  layer  <code>wantsLayer</code>  <code>YES</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithFrame:</span><span class="p">(</span><span class="n">NSRect</span><span class="p">)</span><span class="nv">frame</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nl">initWithFrame:</span><span class="n">frame</span><span class="p">];</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="n">self</span><span class="p">.</span><span class="n">layer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CALayer</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class="line">        <span class="n">self</span><span class="p">.</span><span class="n">wantsLayer</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> layer <em></em> <code>wantsLayer</code> </p>

<h4 id="view"> View </h4>

<p>Mac  iOS  <code>isFlipped</code>  <code>YES</code> </p>

<p> AppKit  view  <code>[NSColor clearColor]</code>  <code>NSView</code>  <code>NSTextView</code>  <code>NSScrollView</code>  <code>drawsBackground</code>  view  <code>NO</code></p>

<p> view  view  <code>NSView</code>  <code>updateTrackingAreas</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">updateTrackingAreas</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span> <span class="nl">removeTrackingArea:</span><span class="n">self</span><span class="p">.</span><span class="n">trackingArea</span><span class="p">];</span>
</span><span class="line">    <span class="n">self</span><span class="p">.</span><span class="n">trackingArea</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSTrackingArea</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithRect:</span><span class="n">CGRectZero</span>
</span><span class="line">                                                     <span class="nl">options:</span><span class="n">NSTrackingMouseEnteredAndExited</span><span class="o">|</span><span class="n">NSTrackingInVisibleRect</span><span class="o">|</span><span class="n">NSTrackingActiveInActiveApp</span>
</span><span class="line">                                                       <span class="nl">owner:</span><span class="n">self</span>
</span><span class="line">                                                    <span class="nl">userInfo:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span> <span class="nl">addTrackingArea:</span><span class="n">self</span><span class="p">.</span><span class="n">trackingArea</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>AppKit  <code>NSCell</code>  cell  UIKit  table view  cell  collection view  cellAppKit  view  cell  - view  view  cell </p>

<p>Apple  <code>NSButton</code> <em></em> <code>NSButtonCell</code> cell  <code>+[NSControl cellClass]</code>  cell </p>

<p> <code>drawRect:</code>  Core Graphics  <code>NSGraphicsContext</code>  <code>graphicsPort</code>  <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/CocoaDrawingGuide/">Cocoa Drawing Guide</a></p>

<h3></h3>

<p> Mac  WWDC session<a href="https://developer.apple.com/videos/wwdc/2013/#213">Best Practices for Cocoa Animation</a></p>

<p> view  layer  CPU  window-backing store  layer-backed view </p>

<p> AppKit  layer-backed view  layer ( <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/CoreAnimation_guide/CreatingBasicAnimations/CreatingBasicAnimations.html#//apple_ref/doc/uid/TP40004514-CH3-SW18">Core Animation Programming Guide</a>  Rules for Modifying Layers in OS X  layer  AppKit  iOS view  layer  AppKit  view  layer</p>

<p> view  <a href="file:///Users/florian/Library/Developer/Shared/Documentation/DocSets/com.apple.adc.documentation.AppleOSX10.9.CoreReference.docset/Contents/Resources/Documents/documentation/Cocoa/Reference/NSAnimatablePropertyContainer_protocol/Introduction/Introduction.html#//apple_ref/occ/intfm/NSAnimatablePropertyContainer/animator">animator proxy</a></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">view</span><span class="p">.</span><span class="n">animator</span><span class="p">.</span><span class="n">alphaValue</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> layer  layer </p>

<p> <a href="https://developer.apple.com/library/mac/documentation/cocoa/reference/NSAnimationContext_class/Introduction/Introduction.html">animation context</a> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="p">[</span><span class="n">NSAnimationContext</span> <span class="nl">runAnimationGroup:</span><span class="o">^</span><span class="p">(</span><span class="n">NSAnimationContext</span> <span class="o">*</span><span class="n">context</span><span class="p">){</span>
</span><span class="line">    <span class="n">view</span><span class="p">.</span><span class="n">animator</span><span class="p">.</span><span class="n">alphaValue</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span> <span class="nl">completionHandler:</span><span class="o">^</span><span class="p">{</span>
</span><span class="line">    <span class="c1">// ...</span>
</span><span class="line"><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="p">[</span><span class="n">NSAnimationContext</span> <span class="nl">runAnimationGroup:</span><span class="o">^</span><span class="p">(</span><span class="n">NSAnimationContext</span> <span class="o">*</span><span class="n">context</span><span class="p">){</span>
</span><span class="line">    <span class="n">context</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line">    <span class="n">context</span><span class="p">.</span><span class="n">timingFunction</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAMediaTimingFunction</span> <span class="nl">functionWithName:</span><span class="n">kCAMediaTimingFunctionEaseIn</span><span class="p">];</span>
</span><span class="line">    <span class="n">view</span><span class="p">.</span><span class="n">animator</span><span class="p">.</span><span class="n">alphaValue</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span> <span class="nl">completionHandler:</span><span class="o">^</span><span class="p">{</span>
</span><span class="line">    <span class="c1">// ...</span>
</span><span class="line"><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="p">[</span><span class="n">NSAnimationContext</span> <span class="n">currentContext</span><span class="p">].</span><span class="n">duration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="n">view</span><span class="p">.</span><span class="n">animator</span><span class="p">.</span><span class="n">alphaValue</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> animator proxy </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="p">[</span><span class="n">NSAnimationContext</span> <span class="n">currentContext</span><span class="p">].</span><span class="n">allowsImplicitAnimations</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class="line"><span class="n">view</span><span class="p">.</span><span class="n">alphaValue</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> <code>CAAnimation</code>  iOS  layer  layer  <a href="https://developer.apple.com/library/mac/documentation/cocoa/reference/NSAnimatablePropertyContainer_protocol/Introduction/Introduction.html"><code>NSAnimatablePropertyContainer</code></a>  API<code>NSView</code>  <code>NSWindow</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">CAKeyframeAnimation</span> <span class="o">*</span><span class="n">animation</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAKeyframeAnimation</span> <span class="n">animation</span><span class="p">];</span>
</span><span class="line"><span class="n">animation</span><span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="err">@</span><span class="mi">1</span><span class="p">,</span> <span class="err">@</span><span class="mf">.9</span><span class="p">,</span> <span class="err">@</span><span class="mf">.8</span><span class="p">,</span> <span class="err">@</span><span class="mf">.7</span><span class="p">,</span> <span class="err">@</span><span class="mf">.6</span><span class="p">];</span>
</span><span class="line"><span class="n">view</span><span class="p">.</span><span class="n">animations</span> <span class="o">=</span> <span class="err">@</span><span class="p">{</span><span class="s">@&quot;alphaValue&quot;</span><span class="o">:</span> <span class="n">animation</span><span class="p">};</span>
</span><span class="line"><span class="n">view</span><span class="p">.</span><span class="n">animator</span><span class="p">.</span><span class="n">alphaValue</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><code></code> view  <code>layerContentsRedrawPolicy</code>  <code>NSViewLayerContentsRedrawOnSetNeedsDisplay</code>  view </p>

<p><code>NSView</code>  Core Animation layer <code>transform</code>  <a href="https://twitter.com/willing">Jonathan Willings</a> <a href="http://jwilling.com/osx-animations"></a></p>

<p> <em>layer-backed</em> view <em>layer-hosting</em> view  view  layer  layer  <code>CAAnimations</code></p>

<h3 id="collectionview">Collection View</h3>

<p> AppKit  <code>NSCollectionView</code>  UIKit  <code>UICollectionView</code>  iOS  UI AppKit  iOS </p>

<h3></h3>

<p> iOS  <code>UIImage</code> AppKit  <code>NSImage</code> <code>NSImage</code>  <code>UIImage</code> Apple  <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/CocoaDrawingGuide/Images/Images.html#//apple_ref/doc/uid/TP40003290-CH208-BCIBBFGJ">Cocoa Drawing Guide</a>  AppKit </p>

<p> <code>NSImage</code> image representation<a href="http://baike.baidu.com/view/4301255.htm"></a> AppKit  <code>NSImageRep</code>  <code>NSBitmapImageRep</code><code>NSPDFImageRep</code>  <code>NSEPSImageRep</code> <code>NSImage</code>  PDF </p>

<p>Mac <code>size</code><code>pixelsWide</code>  <code>pixelsHigh</code>size  pixelsWide  pixelsHigh <strong></strong><strong></strong></p>

<p> <code>UIImage</code>  <code>NSImage</code>  <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/ApplicationKit/Classes/NSImage_Class/Reference/Reference.html#//apple_ref/occ/instm/NSImage/cacheMode"><code>cacheMode</code></a>  <code>recache</code> </p>

<p> Mac  iOS <code>NSImage</code>  iOS  <code>CGImage</code> CGImage  <code>UIImage</code>  <code>NSImage</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="p">[</span><span class="n">NSImage</span> <span class="nl">imageWithSize:</span><span class="p">(</span><span class="n">NSSize</span><span class="p">)</span><span class="n">size</span>
</span><span class="line">            <span class="nl">flipped:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="n">drawingHandlerShouldBeCalledWithFlippedContext</span>
</span><span class="line">     <span class="nl">drawingHandler:</span><span class="o">^</span><span class="kt">BOOL</span> <span class="p">(</span><span class="n">NSRect</span> <span class="n">dstRect</span><span class="p">)</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="c1">// your drawing commands here...</span>
</span><span class="line"><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3></h3>

<p>Mac  color-calibrated  Apple  <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/DrawColor/DrawColor.html#//apple_ref/doc/uid/10000082-SW1">Introduction to Color Programming Topics for Cocoa</a>  <a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Conceptual/csintro/csintro_intro/csintro_intro.html#//apple_ref/doc/uid/TP30001148">Introduction to Color Management</a></p>

<p> device-independent sRGB  <code>+[NSColor colorWithSRGBRed:green:blue:alpha:]</code> </p>

<p><img src="http://img.objccn.io/issue-14/color-picker.png" alt="" /></p>

<h3></h3>

<p> <a href="http://objccn.io/issue-5-1/">TextKit</a>iOS 7  Mac  <a href="https://developer.apple.com/library/mac/documentation/TextFonts/Conceptual/CocoaTextArchitecture/TextSystemArchitecture/ArchitectureOverview.html">Cocoa Text System</a>  Apple  Mac  iOSApple </p>

<p>AppKit  <code>NSTypesetter</code>  <code>NSGlyphGenerator</code>iOS  <code>NSLayoutManagerDelegate</code> </p>

<p> iOS  Mac </p>

<h3></h3>

<p> Mac  Mac App Store  iOS  Mac </p>

<p>Mac  iOS 8 iOS  Mac </p>

<p> <a href="http://decksetapp.com">Deckset</a>   Markdown    Markdown </p>

<p> Markdown  Markdown  UI  Markdown </p>

<p> Apple  <a href="https://developer.apple.com/app-sandboxing/">sandboxing guides</a> </p>

<h2></h2>

<p> Mac <a href="http://objccn.io/issue-14-4/"></a><a href="http://objccn.io/issue-14-1/"> Mac </a>, <a href="http://objccn.io/issue-14-2/"></a>, <a href="http://objccn.io/issue-14-3/"></a></p>

<p> Mac  iOS 8  app Drag and DropPrintingBindingsOpenCL </p>

<hr />
<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2014/07/04/bi-bao-%2Cni-liao-jie-duo-shao-%3F/"/>
    <updated>2014-07-04T14:48:57+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2014/07/04/bi-bao-,ni-liao-jie-duo-shao-?</id>
    <content type="html"><![CDATA[<p>ClosureLexical Closure
60SchemeMLLISP
 (upvalue)
</p>

<p>
Scheme</p>

<p></p>

<p>Scheme</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="scheme"><span class="line"><span class="c1">; Return a list  of all books with at least THRESHOLD copies sold.</span>
</span><span class="line"><span class="p">(</span><span class="k">define </span> <span class="p">(</span><span class="nf">best-selling-books</span>  <span class="nv">threshold</span><span class="p">)</span>
</span><span class="line">   <span class="p">(</span><span class="nf">filter</span>
</span><span class="line">    <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">book</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">book-sales</span> <span class="nv">book</span><span class="p">)</span>  <span class="nv">threshold</span><span class="p">))</span>
</span><span class="line">    <span class="nv">book-list</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>lambda(lambda (book) (&gt;= (book-sales book) threshold))best-selling-bookslambdaSchemethresholdthresholdlambda
filterthresholdfilterfilter
<!-- more --></p>
<p>ECMAScript (JavaScript)</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// Return a  list of all books with at least &#39;threshold&#39; copies sold.</span>
</span><span class="line"><span class="kd">function</span>  <span class="nx">bestSellingBooks</span><span class="p">(</span><span class="nx">threshold</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">  <span class="k">return</span> <span class="nx">bookList</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span>
</span><span class="line">      <span class="kd">function</span>  <span class="p">(</span><span class="nx">book</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">book</span><span class="p">.</span><span class="nx">sales</span> <span class="o">&gt;=</span> <span class="nx">threshold</span><span class="p">;</span> <span class="p">}</span>
</span><span class="line">    <span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>functionlambdaArray.filter[5]filter</p>

<p>javascript</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="c1">// Return a  function that approximates the derivative of f</span>
</span><span class="line"><span class="c1">// using an interval  of dx, which should be appropriately small.</span>
</span><span class="line"><span class="kd">function</span> <span class="nx">derivative</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span>  <span class="nx">dx</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">  <span class="k">return</span>  <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">)</span> <span class="o">-</span> <span class="nx">f</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="o">/</span> <span class="nx">dx</span><span class="p">;</span>
</span><span class="line">  <span class="p">};</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>fdxderivative</p>

<p></p>

<ul>
  <li>Smalltalk(if/then/else)(whilefor)</li>
  <li>Scheme</li>
</ul>

<p />
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="scheme"><span class="line"><span class="p">(</span><span class="k">define </span><span class="nv">foo</span> <span class="no">#f</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="k">define </span> <span class="nv">bar</span> <span class="no">#f</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">secret-message</span> <span class="s">&quot;none&quot;</span><span class="p">))</span>
</span><span class="line">  <span class="p">(</span><span class="k">set! </span><span class="nv">foo</span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">msg</span><span class="p">)</span> <span class="p">(</span><span class="k">set! </span><span class="nv">secret-message</span> <span class="nv">msg</span><span class="p">)))</span>
</span><span class="line">  <span class="p">(</span><span class="k">set! </span><span class="nv">bar</span> <span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="nv">secret-message</span><span class="p">)))</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nb">display </span> <span class="p">(</span><span class="nf">bar</span><span class="p">))</span> <span class="c1">; prints &quot;none&quot;</span>
</span><span class="line"><span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nf">foo</span> <span class="s">&quot;meet me by the docks at midnight&quot;</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">bar</span><span class="p">))</span> <span class="c1">; prints &quot;meet me by the docks at midnight&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<ul>
  <li></li>
</ul>

<p>
nonlocal
lambda lifting</p>

<p>CCvoid*gccCgccC</p>
<p>CBlocksC (LLVMGCC)__blockObjective-CC++</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">^</span><span class="n">IntBlock</span><span class="p">)();</span>
</span><span class="line">
</span><span class="line"><span class="n">IntBlock</span> <span class="nf">downCounter</span><span class="p">(</span><span class="kt">int</span> <span class="n">start</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	 <span class="n">__block</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span><span class="line">	 <span class="k">return</span> <span class="n">Block_copy</span><span class="p">(</span> <span class="o">^</span><span class="kt">int</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">		 <span class="k">return</span> <span class="n">i</span><span class="o">--</span><span class="p">;</span>
</span><span class="line">	 <span class="p">});</span>
</span><span class="line"> <span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">IntBlock</span> <span class="n">f</span> <span class="o">=</span> <span class="n">downCounter</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span class="line"><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">());</span>
</span><span class="line"><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">());</span>
</span><span class="line"><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">());</span>
</span><span class="line"><span class="n">Block_release</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>C++C++operator()
C++11lambdaC++nonlocalunwindingundefined behaviorC++</p>
<p></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="kt">void</span> <span class="n">foo</span><span class="p">(</span><span class="n">string</span> <span class="n">myname</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="k">typedef</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">names</span><span class="p">;</span>
</span><span class="line">	<span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
</span><span class="line">	<span class="n">names</span> <span class="n">n</span><span class="p">;</span>
</span><span class="line">	<span class="c1">// ...</span>
</span><span class="line">	<span class="n">names</span><span class="o">::</span><span class="n">iterator</span> <span class="n">i</span> <span class="o">=</span>
</span><span class="line">	 <span class="n">find_if</span><span class="p">(</span><span class="n">n</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">n</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">){</span><span class="k">return</span> <span class="n">s</span> <span class="o">!=</span> <span class="n">myname</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">;});</span>
</span><span class="line">	<span class="c1">// &#39;i&#39; is now either &#39;n.end()&#39; or points to the first string in &#39;n&#39;</span>
</span><span class="line">	<span class="c1">// &#39;i&#39; &#39;n.end()&#39;&#39;n&#39;</span>
</span><span class="line">	<span class="c1">// &#39;myname&#39;&#39;y&#39;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS 8 ]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2014/07/02/ios-8-ti-yan-tui-song/"/>
    <updated>2014-07-02T11:55:11+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2014/07/02/ios-8-ti-yan-tui-song</id>
    <content type="html"><![CDATA[<p> iOS8iOS8iOS8
</p>
<p><img src="http://ww3.sinaimg.cn/large/626e5d69gw1ehyeq298goj21kw0sadmt.jpg" alt="" /></p>

<h2></h2>
<p>,</p>
<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span> <span class="p">{</span>
</span><span class="line">    <span class="c1">// Override point for customization after application launch.</span>
</span><span class="line">    <span class="n">UIUserNotificationType</span>  <span class="n">types</span> <span class="o">=</span> <span class="n">UIUserNotificationTypeBadge</span> <span class="o">|</span> <span class="n">UIUserNotificationTypeSound</span> <span class="o">|</span> <span class="n">UIUserNotificationTypeAlert</span> <span class="p">;</span>
</span><span class="line">    <span class="n">UIUserNotificationSettings</span>  <span class="o">*</span><span class="n">mySettings</span>  <span class="o">=</span> <span class="p">[</span><span class="n">UIUserNotificationSettings</span> <span class="nl">settingsForTypes:</span><span class="n">types</span> <span class="nl">categories:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class="line">    <span class="p">[[</span><span class="n">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="nl">registerUserNotificationSettings:</span><span class="n">mySettings</span><span class="p">];</span>
</span><span class="line">    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didRegisterUserNotificationSettings:</span><span class="p">(</span><span class="n">UIUserNotificationSettings</span> <span class="o">*</span><span class="p">)</span><span class="nv">notificationSettings</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">UIUserNotificationType</span> <span class="n">allowTypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">notificationSettings</span> <span class="n">types</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">getReadyForNotification</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">UIUserNotificationSettings</span> <span class="o">*</span><span class="n">currentNotificationSettings</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="n">currentUserNotificationSettings</span><span class="p">];</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span> <span class="nl">checkSetting:</span><span class="n">currentNotificationSettings</span><span class="p">];</span>
</span><span class="line">
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>
<p><img src="http://ww4.sinaimg.cn/large/626e5d69gw1ehyeumz8inj21f80d40up.jpg" alt="" /></p>

<p>iOS8</p>
<p><img src="http://ww1.sinaimg.cn/large/626e5d69gw1ehyeyi825mj21aa12ggoc.jpg" alt="" /></p>
<p></p>
<p></p>
<!-- more -->
<li>Actions</li>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">UIMutableUserNotificationAction</span> <span class="o">*</span><span class="n">acceptAction</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIMutableUserNotificationAction</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class="line"><span class="n">acceptAction</span><span class="p">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="s">@&quot;RickAction&quot;</span><span class="p">;</span>
</span><span class="line"><span class="n">acceptAction</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">@&quot;Accept&quot;</span><span class="p">;</span>
</span><span class="line"><span class="n">acceptAction</span><span class="p">.</span><span class="n">activationMode</span> <span class="o">=</span> <span class="n">UIUserNotificationActivationModeBackground</span><span class="p">;</span>
</span><span class="line"><span class="n">acceptAction</span><span class="p">.</span><span class="n">destructive</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span><span class="line"><span class="n">acceptAction</span><span class="p">.</span><span class="n">authenticationRequired</span> <span class="o">=</span> <span class="n">NO</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<li>Categories</li>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">UIMutableUserNotificationCategory</span> <span class="o">*</span><span class="n">inviteCategory</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIMutableUserNotificationCategory</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class="line"><span class="n">inviteCategory</span><span class="p">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="s">@&quot;INVITE_CATEGORY&quot;</span><span class="p">;</span>
</span><span class="line"><span class="p">[</span><span class="n">inviteCategory</span> <span class="nl">setActions:</span><span class="err">@</span><span class="p">[</span><span class="n">acceptAction</span><span class="p">]</span> <span class="nl">forContext:</span><span class="n">UIUserNotificationActionContextDefault</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><code>UIUserNotificationActionContextDefault</code>,MaybeAccept</p>
<p><img src="http://ww1.sinaimg.cn/large/626e5d69gw1ehyf4bfhvrj20q80zytaw.jpg" alt="MaybeAccept" /></p>
<p><code>UIUserNotificationActionContextMinimal</code>DeclineAccept</p>
<p><img src="http://ww3.sinaimg.cn/large/626e5d69gw1ehyf61ypo0j20q010476h.jpg" alt="DeclineAccept" /></p>

<li>Settings</li>
<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="n">NSSet</span> <span class="o">*</span><span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSSet</span> <span class="nl">setWithObjects:</span><span class="n">inviteCategory</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span><span class="line"><span class="n">UIUserNotificationType</span>  <span class="n">types</span> <span class="o">=</span> <span class="n">UIUserNotificationTypeBadge</span> <span class="o">|</span> <span class="n">UIUserNotificationTypeSound</span> <span class="o">|</span> <span class="n">UIUserNotificationTypeAlert</span> <span class="p">;</span>
</span><span class="line"><span class="n">UIUserNotificationSettings</span>  <span class="o">*</span><span class="n">mySettings</span>  <span class="o">=</span> <span class="p">[</span><span class="n">UIUserNotificationSettings</span> <span class="nl">settingsForTypes:</span><span class="n">types</span> <span class="nl">categories:</span><span class="n">categories</span><span class="p">];</span>
</span><span class="line"><span class="p">[[</span><span class="n">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="nl">registerUserNotificationSettings:</span><span class="n">mySettings</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<h2></h2>
<p>2KB,json</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="json"><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="err">aps:</span> <span class="err">{</span>
</span><span class="line">        <span class="nt">&quot;content-available&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class="line">        <span class="nt">&quot;alert&quot;</span><span class="p">:</span> <span class="s2">&quot;This is the alert text&quot;</span><span class="p">,</span>
</span><span class="line">        <span class="nt">&quot;badge&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class="line">        <span class="nt">&quot;sound&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="err">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><code>registerUserNotificationSettings</code>;<code>info.plist</code><code>UIBackgroundModes</code></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="p">[[</span><span class="n">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="n">registerForRemoteNotifications</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<blockquote>
	<p></p>
</blockquote>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didRegisterForRemoteNotificationsWithDeviceToken:</span><span class="p">(</span><span class="n">NSData</span> <span class="o">*</span><span class="p">)</span><span class="nv">deviceToken</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFailToRegisterForRemoteNotificationsWithError:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>iOS7</p>
<p><img src="http://ww4.sinaimg.cn/large/626e5d69gw1ehyfq2omeij21kw0zc456.jpg" alt="iOS6" /></p>
<p></p>
<p><img src="http://ww4.sinaimg.cn/large/626e5d69gw1ehyfvjws4ej21kw0uxn20.jpg" alt="" /></p>
<p>iOS8</p>
<p><img src="http://ww4.sinaimg.cn/large/626e5d69gw1ehyfws0hdfj210g0oyq6d.jpg" alt="iOS 8" /></p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">handleActionWithIdentifier:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">identifier</span> <span class="nf">forLocalNotification:</span><span class="p">(</span><span class="n">UILocalNotification</span> <span class="o">*</span><span class="p">)</span><span class="nv">notification</span> <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="nv">completionHandler</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">handleActionWithIdentifier:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">identifier</span> <span class="nf">forRemoteNotification:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">userInfo</span> <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="nv">completionHandler</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">handleActionWithIdentifier:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">identifier</span> <span class="nf">forLocalNotification:</span><span class="p">(</span><span class="n">UILocalNotification</span> <span class="o">*</span><span class="p">)</span><span class="nv">notification</span> <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="nv">completionHandler</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">([</span><span class="n">identifier</span> <span class="nl">isEqualToString:</span><span class="s">@&quot;RickAction&quot;</span><span class="p">])</span> <span class="p">{</span>
</span><span class="line">        <span class="p">[</span><span class="n">self</span> <span class="nl">handleAcceptActionWithNotification:</span><span class="n">notification</span><span class="p">];</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="n">completionHandler</span><span class="p">();</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">handleAcceptActionWithNotification:</span><span class="p">(</span><span class="n">UILocalNotification</span><span class="o">*</span><span class="p">)</span><span class="nv">notification</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<h2></h2>
<p>API,CLLocation</p>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="c1">//Location Notification</span>
</span><span class="line">    <span class="n">CLLocationManager</span> <span class="o">*</span><span class="n">locMan</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CLLocationManager</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class="line">    <span class="n">locMan</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class="line">    <span class="p">[</span><span class="n">locMan</span> <span class="n">requestWhenInUseAuthorization</span><span class="p">];</span>
</span><span class="line">
</span><span class="line"><span class="cp">#pragma mark - CLLocationManager</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">locationManager:</span><span class="p">(</span><span class="n">CLLocationManager</span> <span class="o">*</span><span class="p">)</span><span class="nv">manager</span> <span class="nf">didChangeAuthorizationStatus:</span><span class="p">(</span><span class="n">CLAuthorizationStatus</span><span class="p">)</span><span class="nv">status</span>
</span><span class="line">
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="kt">BOOL</span> <span class="n">canUseLocationNotifications</span> <span class="o">=</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="n">kCLAuthorizationStatusAuthorizedWhenInUse</span><span class="p">);</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="n">canUseLocationNotifications</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="p">[</span><span class="n">self</span> <span class="n">startShowLocationNotification</span><span class="p">];</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didReceiveLocalNotification:</span><span class="p">(</span><span class="n">UILocalNotification</span> <span class="o">*</span><span class="p">)</span><span class="nv">notification</span>
</span><span class="line">
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">CLRegion</span> <span class="o">*</span><span class="n">region</span> <span class="o">=</span> <span class="n">notification</span><span class="p">.</span><span class="n">region</span><span class="p">;</span>
</span><span class="line">    <span class="k">if</span> <span class="p">(</span><span class="n">region</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">startShowLocationNotification</span>
</span><span class="line">
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">CLLocationCoordinate2D</span> <span class="n">local2D</span> <span class="p">;</span>
</span><span class="line">    <span class="n">local2D</span><span class="p">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="mf">123.0</span><span class="p">;</span>
</span><span class="line">    <span class="n">local2D</span><span class="p">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="mf">223.0</span><span class="p">;</span>
</span><span class="line">    <span class="n">UILocalNotification</span> <span class="o">*</span><span class="n">locNotification</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UILocalNotification</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class="line">    <span class="n">locNotification</span><span class="p">.</span><span class="n">alertBody</span> <span class="o">=</span> <span class="s">@&quot;&quot;</span><span class="p">;</span>
</span><span class="line">    <span class="n">locNotification</span><span class="p">.</span><span class="n">regionTriggersOnce</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class="line">    <span class="n">locNotification</span><span class="p">.</span><span class="n">region</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CLCircularRegion</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithCenter:</span><span class="n">local2D</span> <span class="nl">radius:</span><span class="mi">45</span> <span class="nl">identifier:</span><span class="s">@&quot;local-identity&quot;</span><span class="p">];</span>
</span><span class="line">    <span class="p">[[</span><span class="n">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="nl">scheduleLocalNotification:</span><span class="n">locNotification</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<blockquote>
	<p>Core Location didReceiveLocalNotification</p>
</blockquote>

<p></p>
<p><img src="http://ww2.sinaimg.cn/large/626e5d69gw1ehyg8u1o51j21ea0qkmz1.jpg" alt="" /></p>

<hr />
<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[VIPERiOS]]></title>
    <link href="http://ITMonkeyLife.github.io/Blog/blog/2014/06/20/shi-yong-vipergou-jian-iosying-yong/"/>
    <updated>2014-06-20T09:00:36+08:00</updated>
    <id>http://ITMonkeyLife.github.io/Blog/blog/2014/06/20/shi-yong-vipergou-jian-iosying-yong</id>
    <content type="html"><![CDATA[<script type="text/javascript">
    var wumiiPermaLink = ""; //
    var wumiiTitle = ""; //
    var wumiiTags = ""; //"1,2"
    var wumiiCategories = []; // JSONArray : ["1", "2"]
    var wumiiSitePrefix = "http://itmonkeylife.github.io/Blog/";
    var wumiiParams = "&num=5&mode=3&pf=JAVASCRIPT";
</script>

<script type="text/javascript" src="http://widget.wumii.cn/ext/relatedItemsWidget"></script>

<p><a href="http://www.wumii.com/widget/relatedItems" style="border:0;">
    <img src="http://static.wumii.cn/images/pixel.png" alt="" style="border:0;padding:0;margin:0;" />
</a></p>

<p></p>

<p></p>
<!-- more -->
<p> <a href="http://mutualmobile.github.io/blog/2013/12/04/viper-introduction/">VIPER</a>  iOS VIPER  (to-do app)  VIPER  <a href="https://github.com/objcio/issue-13-viper">GitHub</a> </p>

<p><video style="display:block;max-width:316px;height:auto;border:0;" poster="/issue-13/2014-06-07-viper-screenshot.png" controls="1"> <br />
  <source src="http://img.objccn.io//issue-13/2014-06-07-viper-preview.mp4" />
</video></p>

<h2 id="viper"> VIPER</h2>

<p> iOS  (<a href="https://github.com/mutualmobile/">Mutual Mobile</a>)  iOS  VIPER</p>

<p>VIPER  iOS <a href="http://blog.8thlight.com/uncle-bob/2012/08/13/the-clean-architecture.html"></a>VIPER  (View) (Interactor) (Presenter) (Entity)  (Routing)  ()</p>

<p><img alt="VIPER stands for View Interactor Presenter Entity Routing." src="http://img.objccn.io/issue-13/2014-06-07-viper-intro.jpg" /></p>

<p> iOS  MVC  MVC <a href="https://twitter.com/Colin_Campbell/status/293167951132098560"></a><a href="http://www.objc.io/issue-1/lighter-view-controllers.html"></a> iOS </p>

<p>VIPER  VIPER </p>

<h2></h2>

<p></p>

<p> VIPER VIPER </p>

<p></p>

<h2 id="viper">VIPER </h2>

<p>VIPER </p>

<ul>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>

<p><a href="http://www.objectmentor.com/resources/articles/srp.pdf"></a></p>

<p></p>

<p><img alt="VIPER breaks down an app into different components based around use cases, including components that create the user interface and the logic that powers it." src="http://img.objccn.io/issue-13/2014-06-07-viper-wireframe.png" /></p>

<p> VIPER  &#8211; </p>

<h3></h3>

<p> iOS  OS X </p>

<p> PONSO (Plain Old <code>NSObject</code> <code>NSObject</code>) TDD </p>

<p></p>

<p> VTDListInteractor </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">findUpcomingItems</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">__weak</span> <span class="n">typeof</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="n">welf</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class="line">    <span class="n">NSDate</span><span class="o">*</span> <span class="n">today</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">clock</span> <span class="n">today</span><span class="p">];</span>
</span><span class="line">    <span class="n">NSDate</span><span class="o">*</span> <span class="n">endOfNextWeek</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSCalendar</span> <span class="n">currentCalendar</span><span class="p">]</span> <span class="nl">dateForEndOfFollowingWeekWithDate:</span><span class="n">today</span><span class="p">];</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">dataManager</span> <span class="nl">todoItemsBetweenStartDate:</span><span class="n">today</span> <span class="nl">endDate:</span><span class="n">endOfNextWeek</span> <span class="nl">completionBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">NSArray</span><span class="o">*</span> <span class="n">todoItems</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="p">[</span><span class="n">welf</span><span class="p">.</span><span class="n">output</span> <span class="nl">foundUpcomingItems:</span><span class="p">[</span><span class="n">welf</span> <span class="nl">upcomingItemsFromToDoItems:</span><span class="n">todoItems</span><span class="p">]];</span>
</span><span class="line">    <span class="p">}];</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3></h3>

<p> ()</p>

<p> PONSOs Core Data NSManageObjects </p>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@interface</span> <span class="nc">VTDTodoItem</span> : <span class="nc">NSObject</span>
</span><span class="line">
</span><span class="line"><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span>   <span class="n">NSDate</span><span class="o">*</span>     <span class="n">dueDate</span><span class="p">;</span>
</span><span class="line"><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span>     <span class="n">NSString</span><span class="o">*</span>   <span class="n">name</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">+</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">todoItemWithDueDate:</span><span class="p">(</span><span class="n">NSDate</span><span class="o">*</span><span class="p">)</span><span class="nv">dueDate</span> <span class="nf">name:</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">name</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<h3></h3>

<p> PONSO</p>

<p> + <code>addNewEntry</code>  <code>wireframe</code> </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">addNewEntry</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">listWireframe</span> <span class="n">presentAddInterface</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">foundUpcomingItems:</span><span class="p">(</span><span class="n">NSArray</span><span class="o">*</span><span class="p">)</span><span class="nv">upcomingItems</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">if</span> <span class="p">([</span><span class="n">upcomingItems</span> <span class="n">count</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">userInterface</span> <span class="n">showNoContentMessage</span><span class="p">];</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">else</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="p">[</span><span class="n">self</span> <span class="nl">updateUserInterfaceWithUpcomingItems:</span><span class="n">upcomingItems</span><span class="p">];</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<h3></h3>

<p> <code>UILabel</code><code>UIButton</code> </p>

<p> (Interface) Objective-C  <code>UIViewController</code>   </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@protocol</span> <span class="nc">VTDAddViewInterface</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
</span><span class="line">
</span><span class="line"><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">setEntryName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">name</span><span class="p">;</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setEntryDueDate:</span><span class="p">(</span><span class="n">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="nv">date</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<p>Add View Controller </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@protocol</span> <span class="nc">VTDAddModuleInterface</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
</span><span class="line">
</span><span class="line"><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">cancelAddAction</span><span class="p">;</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">saveAddActionWithName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">name</span> <span class="nf">dueDate:</span><span class="p">(</span><span class="n">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="nv">dueDate</span>
</span><span class="line">
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> add view controller </p>

<p> <a href="https://github.com/ReactiveCocoa/ReactiveCocoa">ReactiveCocoa</a> </p>

<h3></h3>

<p> (wireframes)  VIPER  <code>UIWindow</code><code>UINavigationController</code><code>UIViewController</code> /</p>

<p></p>

<p> add wireframe </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@implementation</span> <span class="nc">VTDAddWireframe</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">presentAddInterfaceFromViewController:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">VTDAddViewController</span> <span class="o">*</span><span class="n">addViewController</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">addViewController</span><span class="p">];</span>
</span><span class="line">    <span class="n">addViewController</span><span class="p">.</span><span class="n">eventHandler</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">addPresenter</span><span class="p">;</span>
</span><span class="line">    <span class="n">addViewController</span><span class="p">.</span><span class="n">modalPresentationStyle</span> <span class="o">=</span> <span class="n">UIModalPresentationCustom</span><span class="p">;</span>
</span><span class="line">    <span class="n">addViewController</span><span class="p">.</span><span class="n">transitioningDelegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">    <span class="p">[</span><span class="n">viewController</span> <span class="nl">presentViewController:</span><span class="n">addViewController</span> <span class="nl">animated:</span><span class="n">YES</span> <span class="nl">completion:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="n">self</span><span class="p">.</span><span class="n">presentedViewController</span> <span class="o">=</span> <span class="n">viewController</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="cp">#pragma mark - UIViewControllerTransitioningDelegate Methods</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">UIViewControllerAnimatedTransitioning</span><span class="o">&gt;</span><span class="p">)</span><span class="nf">animationControllerForDismissedController:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">dismissed</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">[[</span><span class="n">VTDAddDismissalTransition</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">UIViewControllerAnimatedTransitioning</span><span class="o">&gt;</span><span class="p">)</span><span class="nf">animationControllerForPresentedController:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">presented</span>
</span><span class="line">                                                                  <span class="nf">presentingController:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">presenting</span>
</span><span class="line">                                                                      <span class="nf">sourceController:</span><span class="p">(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">source</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">[[</span><span class="n">VTDAddPresentationTransition</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> add view controller add view controller </p>

<h2 id="viper"> VIPER </h2>

<p>iOS  UIKit  Cocoa Touch </p>

<p>iOS  <code>UIViewController</code> MVC  iOS 7 </p>

<p> VIPER  add view controller </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@implementation</span> <span class="nc">VTDAddViewController</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidAppear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="p">[</span><span class="n">super</span> <span class="nl">viewDidAppear:</span><span class="n">animated</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="n">UITapGestureRecognizer</span> <span class="o">*</span><span class="n">gestureRecognizer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITapGestureRecognizer</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTarget:</span><span class="n">self</span>
</span><span class="line">                                                                                        <span class="nl">action:</span><span class="k">@selector</span><span class="p">(</span><span class="n">dismiss</span><span class="p">)];</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">transitioningBackgroundView</span> <span class="nl">addGestureRecognizer:</span><span class="n">gestureRecognizer</span><span class="p">];</span>
</span><span class="line">    <span class="n">self</span><span class="p">.</span><span class="n">transitioningBackgroundView</span><span class="p">.</span><span class="n">userInteractionEnabled</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">dismiss</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">eventHandler</span> <span class="n">cancelAddAction</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setEntryName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">name</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">self</span><span class="p">.</span><span class="n">nameTextField</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setEntryDueDate:</span><span class="p">(</span><span class="n">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="nv">date</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">datePicker</span> <span class="nl">setDate:</span><span class="n">date</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">save:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">eventHandler</span> <span class="nl">saveAddActionWithName:</span><span class="n">self</span><span class="p">.</span><span class="n">nameTextField</span><span class="p">.</span><span class="n">text</span>
</span><span class="line">                                     <span class="nl">dueDate:</span><span class="n">self</span><span class="p">.</span><span class="n">datePicker</span><span class="p">.</span><span class="n">date</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">cancel:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">eventHandler</span> <span class="n">cancelAddAction</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="cp">#pragma mark - UITextFieldDelegate Methods</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">textFieldShouldReturn:</span><span class="p">(</span><span class="n">UITextField</span> <span class="o">*</span><span class="p">)</span><span class="nv">textField</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="p">[</span><span class="n">textField</span> <span class="n">resignFirstResponder</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> network manager  API client </p>

<p></p>

<p> data manager Data manager  data manager  Core Data data manager </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@interface</span> <span class="nc">VTDListDataManager</span> : <span class="nc">NSObject</span>
</span><span class="line">
</span><span class="line"><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">VTDCoreDataStore</span> <span class="o">*</span><span class="n">dataStore</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">todoItemsBetweenStartDate:</span><span class="p">(</span><span class="n">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="nv">startDate</span> <span class="nf">endDate:</span><span class="p">(</span><span class="n">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="nv">endDate</span> <span class="nf">completionBlock:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSArray</span> <span class="o">*</span><span class="n">todoItems</span><span class="p">))</span><span class="nv">completionBlock</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> TDD </p>

<p> SQLite  Core Data</p>

<p> iOS  Core Data  VIPER  Core Data  Core Data Core Data  <code>NSManagedObjectContext</code>  VIPER  Core Data </p>

<p> Core Data Core Data  data managerData manager  NSManagedObject  PONSO  Core Data (stale)  NSManagedObjects </p>

<p> Core Data data manager </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@implementation</span> <span class="nc">VTDListDataManager</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">todoItemsBetweenStartDate:</span><span class="p">(</span><span class="n">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="nv">startDate</span> <span class="nf">endDate:</span><span class="p">(</span><span class="n">NSDate</span><span class="o">*</span><span class="p">)</span><span class="nv">endDate</span> <span class="nf">completionBlock:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSArray</span> <span class="o">*</span><span class="n">todoItems</span><span class="p">))</span><span class="nv">completionBlock</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">NSCalendar</span> <span class="o">*</span><span class="n">calendar</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSCalendar</span> <span class="n">autoupdatingCurrentCalendar</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="n">NSPredicate</span> <span class="o">*</span><span class="n">predicate</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSPredicate</span> <span class="nl">predicateWithFormat:</span><span class="s">@&quot;(date &gt;= %@) AND (date &lt;= %@)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">calendar</span> <span class="nl">dateForBeginningOfDay:</span><span class="n">startDate</span><span class="p">],</span> <span class="p">[</span><span class="n">calendar</span> <span class="nl">dateForEndOfDay:</span><span class="n">endDate</span><span class="p">]];</span>
</span><span class="line">    <span class="n">NSArray</span> <span class="o">*</span><span class="n">sortDescriptors</span> <span class="o">=</span> <span class="err">@</span><span class="p">[];</span>
</span><span class="line">
</span><span class="line">    <span class="n">__weak</span> <span class="n">typeof</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="n">welf</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">dataStore</span>
</span><span class="line">     <span class="nl">fetchEntriesWithPredicate:</span><span class="n">predicate</span>
</span><span class="line">     <span class="nl">sortDescriptors:</span><span class="n">sortDescriptors</span>
</span><span class="line">     <span class="nl">completionBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">NSArray</span><span class="o">*</span> <span class="n">entries</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">         <span class="k">if</span> <span class="p">(</span><span class="n">completionBlock</span><span class="p">)</span>
</span><span class="line">         <span class="p">{</span>
</span><span class="line">             <span class="n">completionBlock</span><span class="p">([</span><span class="n">welf</span> <span class="nl">todoItemsFromDataStoreEntries:</span><span class="n">entries</span><span class="p">]);</span>
</span><span class="line">         <span class="p">}</span>
</span><span class="line">     <span class="p">}];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="n">NSArray</span><span class="o">*</span><span class="p">)</span><span class="nf">todoItemsFromDataStoreEntries:</span><span class="p">(</span><span class="n">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nv">entries</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="p">[</span><span class="n">entries</span> <span class="nl">arrayFromObjectsCollectedWithBlock:</span><span class="o">^</span><span class="kt">id</span><span class="p">(</span><span class="n">VTDManagedTodoItem</span> <span class="o">*</span><span class="n">todo</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="k">return</span> <span class="p">[</span><span class="n">VTDTodoItem</span> <span class="nl">todoItemWithDueDate:</span><span class="n">todo</span><span class="p">.</span><span class="n">date</span> <span class="nl">name:</span><span class="n">todo</span><span class="p">.</span><span class="n">name</span><span class="p">];</span>
</span><span class="line">    <span class="p">}];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> Core Data  UI  VIPER </p>

<p> segues  segues  segues  UI  prepareForSegue  segues</p>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">ListViewControllerIdentifier</span> <span class="o">=</span> <span class="s">@&quot;VTDListViewController&quot;</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">@implementation</span> <span class="nc">VTDListWireframe</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">presentListInterfaceFromWindow:</span><span class="p">(</span><span class="n">UIWindow</span> <span class="o">*</span><span class="p">)</span><span class="nv">window</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">VTDListViewController</span> <span class="o">*</span><span class="n">listViewController</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">listViewControllerFromStoryboard</span><span class="p">];</span>
</span><span class="line">    <span class="n">listViewController</span><span class="p">.</span><span class="n">eventHandler</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">listPresenter</span><span class="p">;</span>
</span><span class="line">    <span class="n">self</span><span class="p">.</span><span class="n">listPresenter</span><span class="p">.</span><span class="n">userInterface</span> <span class="o">=</span> <span class="n">listViewController</span><span class="p">;</span>
</span><span class="line">    <span class="n">self</span><span class="p">.</span><span class="n">listViewController</span> <span class="o">=</span> <span class="n">listViewController</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">rootWireframe</span> <span class="nl">showRootViewController:</span><span class="n">listViewController</span>
</span><span class="line">                                      <span class="nl">inWindow:</span><span class="n">window</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="n">VTDListViewController</span> <span class="o">*</span><span class="p">)</span><span class="nf">listViewControllerFromStoryboard</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">UIStoryboard</span> <span class="o">*</span><span class="n">storyboard</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">mainStoryboard</span><span class="p">];</span>
</span><span class="line">    <span class="n">VTDListViewController</span> <span class="o">*</span><span class="n">viewController</span> <span class="o">=</span> <span class="p">[</span><span class="n">storyboard</span> <span class="nl">instantiateViewControllerWithIdentifier:</span><span class="n">ListViewControllerIdentifier</span><span class="p">];</span>
</span><span class="line">    <span class="k">return</span> <span class="n">viewController</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="n">UIStoryboard</span> <span class="o">*</span><span class="p">)</span><span class="nf">mainStoryboard</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">UIStoryboard</span> <span class="o">*</span><span class="n">storyboard</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIStoryboard</span> <span class="nl">storyboardWithName:</span><span class="s">@&quot;Main&quot;</span>
</span><span class="line">                                                         <span class="nl">bundle:</span><span class="p">[</span><span class="n">NSBundle</span> <span class="n">mainBundle</span><span class="p">]];</span>
</span><span class="line">    <span class="k">return</span> <span class="n">storyboard</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="viper"> VIPER </h2>

<p> VIPER </p>

<p></p>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">@protocol</span> <span class="nc">VTDAddModuleInterface</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
</span><span class="line">
</span><span class="line"><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">cancelAddAction</span><span class="p">;</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">saveAddActionWithName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">name</span> <span class="nf">dueDate:</span><span class="p">(</span><span class="n">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="nv">dueDate</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">@end</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">@protocol</span> <span class="nc">VTDAddModuleDelegate</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
</span><span class="line">
</span><span class="line"><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">addModuleDidCancelAddAction</span><span class="p">;</span>
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">addModuleDidSaveAddAction</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<p></p>

<p> Xcode  group</p>

<p> VIPER  Mac </p>

<p>iPad  iPhone iPad  super  iPhone </p>

<h2 id="viper"> VIPER </h2>

<p>VIPER  TDD  UI  UIKit </p>

<p> TDD  API </p>

<p></p>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testFindingUpcomingItemsRequestsAllToDoItemsFromTodayThroughEndOfNextWeek</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">dataManager</span> <span class="n">expect</span><span class="p">]</span> <span class="nl">todoItemsBetweenStartDate:</span><span class="n">self</span><span class="p">.</span><span class="n">today</span> <span class="nl">endDate:</span><span class="n">self</span><span class="p">.</span><span class="n">endOfNextWeek</span> <span class="nl">completionBlock:</span><span class="n">OCMOCK_ANY</span><span class="p">];</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">interactor</span> <span class="n">findUpcomingItems</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testFindingUpcomingItemsWithOneItemDueTodayReturnsOneUpcomingItemsForToday</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">NSArray</span> <span class="o">*</span><span class="n">todoItems</span> <span class="o">=</span> <span class="err">@</span><span class="p">[[</span><span class="n">VTDTodoItem</span> <span class="nl">todoItemWithDueDate:</span><span class="n">self</span><span class="p">.</span><span class="n">today</span> <span class="nl">name:</span><span class="s">@&quot;Item 1&quot;</span><span class="p">]];</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span> <span class="nl">dataStoreWillReturnToDoItems:</span><span class="n">todoItems</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="n">NSArray</span> <span class="o">*</span><span class="n">upcomingItems</span> <span class="o">=</span> <span class="err">@</span><span class="p">[[</span><span class="n">VTDUpcomingItem</span> <span class="nl">upcomingItemWithDateRelation:</span><span class="n">VTDNearTermDateRelationToday</span> <span class="nl">dueDate:</span><span class="n">self</span><span class="p">.</span><span class="n">today</span> <span class="nl">title:</span><span class="s">@&quot;Item 1&quot;</span><span class="p">]];</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span> <span class="nl">expectUpcomingItems:</span><span class="n">upcomingItems</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">interactor</span> <span class="n">findUpcomingItems</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> API </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testFoundZeroUpcomingItemsDisplaysNoContentMessage</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">ui</span> <span class="n">expect</span><span class="p">]</span> <span class="n">showNoContentMessage</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">presenter</span> <span class="nl">foundUpcomingItems:</span><span class="err">@</span><span class="p">[]];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testFoundUpcomingItemForTodayDisplaysUpcomingDataWithNoDay</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">VTDUpcomingDisplayData</span> <span class="o">*</span><span class="n">displayData</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">displayDataWithSectionName:</span><span class="s">@&quot;Today&quot;</span>
</span><span class="line">                                                          <span class="nl">sectionImageName:</span><span class="s">@&quot;check&quot;</span>
</span><span class="line">                                                                 <span class="nl">itemTitle:</span><span class="s">@&quot;Get a haircut&quot;</span>
</span><span class="line">                                                                <span class="nl">itemDueDay:</span><span class="s">@&quot;&quot;</span><span class="p">];</span>
</span><span class="line">    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">ui</span> <span class="n">expect</span><span class="p">]</span> <span class="nl">showUpcomingDisplayData:</span><span class="n">displayData</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="n">NSCalendar</span> <span class="o">*</span><span class="n">calendar</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSCalendar</span> <span class="n">gregorianCalendar</span><span class="p">];</span>
</span><span class="line">    <span class="n">NSDate</span> <span class="o">*</span><span class="n">dueDate</span> <span class="o">=</span> <span class="p">[</span><span class="n">calendar</span> <span class="nl">dateWithYear:</span><span class="mi">2014</span> <span class="nl">month:</span><span class="mi">5</span> <span class="nl">day:</span><span class="mi">29</span><span class="p">];</span>
</span><span class="line">    <span class="n">VTDUpcomingItem</span> <span class="o">*</span><span class="n">haircut</span> <span class="o">=</span> <span class="p">[</span><span class="n">VTDUpcomingItem</span> <span class="nl">upcomingItemWithDateRelation:</span><span class="n">VTDNearTermDateRelationToday</span> <span class="nl">dueDate:</span><span class="n">dueDate</span> <span class="nl">title:</span><span class="s">@&quot;Get a haircut&quot;</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">presenter</span> <span class="nl">foundUpcomingItems:</span><span class="err">@</span><span class="p">[</span><span class="n">haircut</span><span class="p">]];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testFoundUpcomingItemForTomorrowDisplaysUpcomingDataWithDay</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="n">VTDUpcomingDisplayData</span> <span class="o">*</span><span class="n">displayData</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">displayDataWithSectionName:</span><span class="s">@&quot;Tomorrow&quot;</span>
</span><span class="line">                                                          <span class="nl">sectionImageName:</span><span class="s">@&quot;alarm&quot;</span>
</span><span class="line">                                                                 <span class="nl">itemTitle:</span><span class="s">@&quot;Buy groceries&quot;</span>
</span><span class="line">                                                                <span class="nl">itemDueDay:</span><span class="s">@&quot;Thursday&quot;</span><span class="p">];</span>
</span><span class="line">    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">ui</span> <span class="n">expect</span><span class="p">]</span> <span class="nl">showUpcomingDisplayData:</span><span class="n">displayData</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="n">NSCalendar</span> <span class="o">*</span><span class="n">calendar</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSCalendar</span> <span class="n">gregorianCalendar</span><span class="p">];</span>
</span><span class="line">    <span class="n">NSDate</span> <span class="o">*</span><span class="n">dueDate</span> <span class="o">=</span> <span class="p">[</span><span class="n">calendar</span> <span class="nl">dateWithYear:</span><span class="mi">2014</span> <span class="nl">month:</span><span class="mi">5</span> <span class="nl">day:</span><span class="mi">29</span><span class="p">];</span>
</span><span class="line">    <span class="n">VTDUpcomingItem</span> <span class="o">*</span><span class="n">groceries</span> <span class="o">=</span> <span class="p">[</span><span class="n">VTDUpcomingItem</span> <span class="nl">upcomingItemWithDateRelation:</span><span class="n">VTDNearTermDateRelationTomorrow</span> <span class="nl">dueDate:</span><span class="n">dueDate</span> <span class="nl">title:</span><span class="s">@&quot;Buy groceries&quot;</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">presenter</span> <span class="nl">foundUpcomingItems:</span><span class="err">@</span><span class="p">[</span><span class="n">groceries</span><span class="p">]];</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testAddNewToDoItemActionPresentsAddToDoUI</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="p">[[</span><span class="n">self</span><span class="p">.</span><span class="n">wireframe</span> <span class="n">expect</span><span class="p">]</span> <span class="n">presentAddInterface</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">presenter</span> <span class="n">addNewEntry</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testShowingNoContentMessageShowsNoContentView</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="n">showNoContentMessage</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="n">XCTAssertEqualObjects</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">view</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">noContentView</span><span class="p">,</span> <span class="s">@&quot;the no content view should be the view&quot;</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testShowingUpcomingItemsShowsTableView</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">showUpcomingDisplayData:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">    <span class="n">XCTAssertEqualObjects</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">view</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">tableView</span><span class="p">,</span> <span class="s">@&quot;the table view should be the view&quot;</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p> TDD </p>

<h2></h2>

<p> VIPER  VIPER </p>

<p> VIPER  VIPER  VIPER </p>

<p> VIPER  <a href="http://inessential.com/2014/03/16/smaller_please">&#8216;bunny&#8217;</a>  segues VIPER VIPER <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle"></a></p>

<p> VIPER  VIPER  VIPER </p>

<p> VIPER</p>

<h2 id="swifit">Swifit </h2>

<p> WWDC  <a href="https://developer.apple.com/swift/">Swift</a>  Cocoa  Cocoa Touch  Swift  <a href="https://github.com/objcio/issue-13-viper-swift">Swift </a> VIPER Swift </p>

<h3></h3>

<p> VIPER  model  PONSOs Swift  VIPER Swift == </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
</pre></td><td class="code"><pre><code class="objc"><span class="line"><span class="k">struct</span> <span class="n">UpcomingDisplayItem</span> <span class="o">:</span> <span class="n">Equatable</span><span class="p">,</span> <span class="n">Printable</span> <span class="p">{</span>
</span><span class="line">    <span class="n">let</span> <span class="n">title</span> <span class="o">:</span> <span class="n">String</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</span><span class="line">    <span class="n">let</span> <span class="n">dueDate</span> <span class="o">:</span> <span class="n">String</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="n">var</span> <span class="n">description</span> <span class="o">:</span> <span class="n">String</span> <span class="p">{</span> <span class="n">get</span> <span class="p">{</span>
</span><span class="line">        <span class="k">return</span> <span class="s">&quot;\(title) -- \(dueDate)&quot;</span>
</span><span class="line">    <span class="p">}}</span>
</span><span class="line">
</span><span class="line">    <span class="n">init</span><span class="p">(</span><span class="nl">title:</span> <span class="n">String</span><span class="p">,</span> <span class="nl">dueDate:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="n">self</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
</span><span class="line">        <span class="n">self</span><span class="p">.</span><span class="n">dueDate</span> <span class="o">=</span> <span class="n">dueDate</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="n">func</span> <span class="o">==</span> <span class="p">(</span><span class="nl">leftSide:</span> <span class="n">UpcomingDisplayItem</span><span class="p">,</span> <span class="nl">rightSide:</span> <span class="n">UpcomingDisplayItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="p">{</span>
</span><span class="line">    <span class="n">var</span> <span class="n">hasEqualSections</span> <span class="o">=</span> <span class="n">false</span>
</span><span class="line">    <span class="n">hasEqualSections</span> <span class="o">=</span> <span class="n">rightSide</span><span class="p">.</span><span class="n">title</span> <span class="o">==</span> <span class="n">leftSide</span><span class="p">.</span><span class="n">title</span>
</span><span class="line">
</span><span class="line">    <span class="k">if</span> <span class="n">hasEqualSections</span> <span class="o">==</span> <span class="n">false</span> <span class="p">{</span>
</span><span class="line">        <span class="k">return</span> <span class="n">false</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">
</span><span class="line">    <span class="n">hasEqualSections</span> <span class="o">=</span> <span class="n">rightSide</span><span class="p">.</span><span class="n">dueDate</span> <span class="o">==</span> <span class="n">rightSide</span><span class="p">.</span><span class="n">dueDate</span>
</span><span class="line">
</span><span class="line">    <span class="k">return</span> <span class="n">hasEqualSections</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3></h3>

<p> Objective-C  Swift  Objective-C  Swift  VIPER  </p>

<h2></h2>

<ul>
<li><a href="https://github.com/objcio/issue-13-viper">VIPER TODO, </a></li>
<li><a href="https://github.com/objcio/issue-13-viper-swift">VIPER SWIFT,  Swift </a></li>
<li><a href="https://github.com/mutualmobile/Counter"></a></li>
<li><a href="http://mutualmobile.github.io/blog/2013/12/04/viper-introduction/">Mutual Mobile  VIPER </a></li>
<li><a href="http://blog.8thlight.com/uncle-bob/2011/11/22/Clean-Architecture.html"></a></li>
<li><a href="http://objccn.io/issue-1-1/"> View Controllers</a></li>
<li><a href="http://objccn.io/issue-1-3/"> View Controllers</a></li>
<li><a href="http://inessential.com/2014/03/16/smaller_please">Bunnies</a></li>
</ul>

<script type="text/javascript" id="wumiiRelatedItems"></script>

<hr />
<p class="post-footer">
                        written by <a href="http://ITMonkeyLife.github.io/Blog">Rick</a>&nbsp;posted at <a href="http://ITMonkeyLife.github.io/Blog">http://ITMonkeyLife.github.io/Blog</a></p>
]]></content>
  </entry>
  
</feed>
